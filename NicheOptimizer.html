<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer & Niche AI Hub V10.1 - Mini Assistant Fixe</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* --- VARIABLES CSS (Bas√©es sur V7.2/V9.0) --- */
        :root {
            --color-bg-dark: #0d0d0d;
            --color-bg-medium: #1a1a1a;
            --color-bg-light: #111;
            --color-primary-pink: #ff0099;
            --color-secondary-blue: #22c7ef;
            --color-ai-niche: #59d682; /* Vert pour la niche */
            --color-ai-repurpose: #9933ff; /* Violet pour le repurposing */
            --color-ai-growth: #ffcc00; /* Jaune pour la croissance/alertes */
            --color-ai-action: #e34a64; /* Rouge/Corail pour l'action/export */
            --color-text-dimmed: #9aa3a8;
            --color-border-dark: #2e2e2e;
            --color-border-medium: #333;
        }

        /* Styles Globaux */
        body { background-color: var(--color-bg-dark); color: #fff; font-family: 'Inter', Arial, sans-serif; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .btn-primary { background: var(--color-primary-pink); color: white; padding: 10px 20px; border-radius: 6px; font-weight: 700; transition: background-color 0.2s; }
        .btn-primary:hover { background-color: #e60088; }
        .btn-secondary { background: var(--color-secondary-blue); color: var(--color-bg-dark); padding: 8px 15px; border-radius: 6px; font-weight: 700; transition: background-color 0.2s; }
        .btn-secondary:hover { background-color: #00bfff; }
        .action-input { background-color: var(--color-bg-light); border: 1px solid var(--color-border-dark); padding: 10px; border-radius: 6px; color: #fff; width: 100%; }

        /* --- MINI ASSISTANT CSS (Correction des bulles) --- */
        .assistant-btn { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: linear-gradient(135deg, var(--color-secondary-blue), #0066cc); 
            color: white; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(34, 199, 239, 0.4); 
            z-index: 1000; 
            transition: transform 0.2s; 
            border: none; 
        }
        .assistant-btn:hover { 
            transform: scale(1.1); 
        }
        .assistant-panel { 
            position: fixed; 
            bottom: 90px; /* Positionnement au-dessus du bouton */
            right: 20px; 
            width: 350px; 
            height: 500px; 
            background: var(--color-bg-medium); 
            border: 1px solid var(--color-secondary-blue); 
            border-radius: 12px; 
            display: none; /* Masqu√© par d√©faut */
            flex-direction: column; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            z-index: 1000; 
            overflow: hidden; 
        }
        .assistant-header { 
            padding: 15px; 
            background: rgba(34, 199, 239, 0.1); 
            border-bottom: 1px solid var(--color-border-dark); 
            font-family: 'Orbitron', sans-serif; 
            font-size: 14px; 
            color: var(--color-secondary-blue); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .assistant-messages { 
            flex: 1; /* Prend tout l'espace vertical disponible */
            padding: 15px; 
            overflow-y: auto; 
            display: flex; 
            flex-direction: column; /* ESSENTIEL pour l'alignement des bulles */
            gap: 10px; 
        }
        /* Style de base de la bulle */
        .msg { 
            padding: 10px 14px; 
            border-radius: 8px; 
            font-size: 13px; 
            line-height: 1.4; 
            max-width: 85%; 
            color: #fff; 
        }
        /* Style de la bulle Utilisateur */
        .msg.user { 
            align-self: flex-end; /* Align√© √† droite */
            background: var(--color-primary-pink); 
            border-bottom-right-radius: 0; /* Cr√©e la pointe en bas √† droite */
        }
        /* Style de la bulle Bot */
        .msg.bot { 
            align-self: flex-start; /* Align√© √† gauche */
            background: var(--color-bg-light); 
            border: 1px solid var(--color-border-medium); 
            color: #fff; /* S'assurer de la couleur du texte */
            border-bottom-left-radius: 0; /* Cr√©e la pointe en bas √† gauche */
        }
        .msg.bot ul { 
            list-style-type: disc; 
            padding-left: 20px; 
            margin-top: 5px; 
        }
        .assistant-input-area { 
            padding: 10px; 
            border-top: 1px solid var(--color-border-dark); 
            display: flex; 
            gap: 8px; 
        }

        @media (max-width: 768px) {
            .assistant-panel { width: calc(100% - 40px); bottom: 90px; right: 20px; height: 400px; }
        }
    </style>
</head>
<body class="p-4">

    <header class="text-center mb-6">
        <h1 class="text-3xl font-bold font-['Orbitron'] text-white">NicheOptimizer <span class="text-red-500">V10.1</span></h1>
        <p class="text-sm text-gray-400">Hub IA pour Streamers</p>
    </header>

    <main class="container grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="lg:col-span-2 bg-gray-900 p-4 rounded-lg shadow-xl">
            <h2 class="text-xl font-bold mb-3 text-white">Zone de Travail</h2>
            <div id="player-container" class="aspect-video bg-black flex items-center justify-center rounded mb-4">
                <p class="text-gray-500">Lecteur/Streamer (Placeholder)</p>
            </div>
            <div class="mt-4 p-3 bg-gray-800 rounded">
                <p class="text-sm text-gray-300">Cette section contient les onglets et les outils d'analyse/repurposing.</p>
            </div>
        </div>

        <div class="bg-gray-900 p-4 rounded-lg shadow-xl">
            <h2 class="text-xl font-bold mb-3 text-white">Statistiques & Actions IA</h2>
            <div id="result-box" class="bg-gray-800 p-3 rounded h-32 overflow-auto mb-4 text-sm text-gray-300">
                Messages IA...
            </div>
            <button class="btn-primary w-full" disabled>Lancer l'Analyse (Placeholder)</button>
        </div>
    </main>

    <button id="assistant-toggle" class="assistant-btn" onclick="toggleAssistant()">ü§ñ</button>
    <div id="assistant-panel" class="assistant-panel">
        <div class="assistant-header">
            <span>ASSISTANT IA</span>
            <span style="cursor:pointer;" onclick="toggleAssistant()">‚úñ</span>
        </div>
        <div id="assistant-messages" class="assistant-messages">
            <div class="msg bot">Salut ! Je suis ton assistant de poche. Pose-moi une question sur ton stream, un titre ou une id√©e de clip !</div>
        </div>
        <form id="assistant-form" class="assistant-input-area">
            <input id="assistant-input" type="text" placeholder="Ta question..." class="action-input" autocomplete="off">
            <button type="submit" class="btn-secondary">></button>
        </form>
    </div>

<script>
    // Variables globales
    const API_BASE = 'https://ton-api.com/v1'; // Remplacer par l'URL de votre API
    const DEFAULT_CHANNEL = 'user_default'; // Cha√Æne par d√©faut

    // --- 1. Logique du Mini Assistant ---
    function toggleAssistant() {
        const panel = document.getElementById('assistant-panel');
        if (panel.style.display === 'flex') {
            panel.style.display = 'none';
        } else {
            panel.style.display = 'flex';
            // Scroll en bas lors de l'ouverture
            const assistantMsgs = document.getElementById('assistant-messages');
            assistantMsgs.scrollTop = assistantMsgs.scrollHeight;
        }
    }

    document.getElementById('assistant-form').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const assistantMsgs = document.getElementById('assistant-messages');
        const input = document.getElementById('assistant-input');
        const q = input.value.trim();
        const currentChannel = localStorage.getItem('activeChannel') || DEFAULT_CHANNEL;

        if (!q) return;

        // Message utilisateur (Bulle utilisateur)
        assistantMsgs.innerHTML += `<div class="msg user">${q}</div>`;
        input.value = '';
        assistantMsgs.scrollTop = assistantMsgs.scrollHeight;

        // Affichage du loader (Bulle bot)
        const loaderId = 'loader-' + Date.now();
        assistantMsgs.innerHTML += `<div id="${loaderId}" class="msg bot">...</div>`;
        assistantMsgs.scrollTop = assistantMsgs.scrollHeight;
        
        try {
            const res = await fetch(`${API_BASE}/mini_assistant`, { 
                method: 'POST', 
                headers: {'Content-Type': 'application/json'}, 
                body: JSON.stringify({ q, context: currentChannel }) 
            });
            const data = await res.json();
            
            // Suppression du loader
            document.getElementById(loaderId)?.remove();
            
            // Affichage de la r√©ponse du bot (Bulle bot)
            // L'API est cens√©e renvoyer data.html_response pour une int√©gration directe
            assistantMsgs.innerHTML += `<div class="msg bot">${data.html_response || "D√©sol√©, probl√®me IA ou r√©ponse bloqu√©e."}</div>`;
        } catch(err) { 
            document.getElementById(loaderId)?.remove();
            assistantMsgs.innerHTML += `<div class="msg bot" style="color:red;">Erreur connexion serveur.</div>`;
        }
        
        // Scroll en bas apr√®s la r√©ponse
        assistantMsgs.scrollTop = assistantMsgs.scrollHeight;
    });


    // --- 2. Initialisation au chargement de la page (Fonctions Placeholders) ---
    function initializePlayer() { console.log("Player Initialis√©"); }
    function openTab(tabName) { console.log(`Ouverture de l'onglet : ${tabName}`); }
    function checkAuth() { console.log("V√©rification de l'authentification..."); }


    document.addEventListener('DOMContentLoaded', function() {
        // Logique d'initialisation de la page
        initializePlayer(); 
        const savedTab = localStorage.getItem('activeTab') || 'tab-followed';
        openTab(savedTab);
        checkAuth();
    });
</script>
</body>
</html>
