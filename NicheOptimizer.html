<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niche Optimizer - Streamer AI Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ===== HEADER ===== */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* ===== FIREBASE HUB STATUS STYLES ===== */
        .hub-status-container {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #ffcc00;
            animation: pulse 2s infinite;
            display: block;
        }

        .status-text {
            font-size: 12px;
            color: #ffffff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* ===== MAIN CONTENT ===== */
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .card h2 {
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card p {
            opacity: 0.8;
            margin-bottom: 12px;
            line-height: 1.6;
        }

        /* ===== FORM STYLES ===== */
        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.4);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        /* ===== BUTTON STYLES ===== */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 100%;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ===== BEST TIME TOOL STYLES ===== */
        .best-time-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 24px;
            margin: 20px 0;
            color: white;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border-left: 4px solid #ffd700;
        }

        .best-time-section h3 {
            margin-top: 0;
            font-size: 20px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .best-time-section > p {
            opacity: 0.9;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .best-time-section .form-group {
            margin-bottom: 16px;
        }

        .best-time-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 6px;
            font-size: 13px;
        }

        .best-time-section .input-field {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .best-time-section .input-field:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .best-time-section .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .best-time-section .btn-primary {
            background: #ffffff;
            color: #667eea;
            font-weight: bold;
        }

        .best-time-section .btn-primary:hover:not(:disabled) {
            background: #f0f0f0;
            transform: translateY(-2px);
        }

        .best-time-section .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        #best-time-content {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            border-left: 4px solid #ffd700;
            font-size: 13px;
            line-height: 1.6;
        }

        #best-time-content h4 {
            margin-top: 0;
            margin-bottom: 10px;
            color: #ffd700;
        }

        #best-time-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        #best-time-content li {
            margin-bottom: 8px;
        }

        #best-time-loading {
            text-align: center;
            color: #ffd700;
            font-weight: bold;
            margin-top: 20px;
        }

        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffd700;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ===== RESULTS SECTION ===== */
        .results-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 24px;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .results-container h3 {
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .result-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #667eea;
        }

        .result-item h4 {
            margin-bottom: 8px;
            color: #667eea;
        }

        .result-item p {
            opacity: 0.8;
            margin: 0;
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }

            header {
                flex-direction: column;
                gap: 15px;
            }

            header h1 {
                font-size: 20px;
            }

            .hub-status-container {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ===== HEADER ===== -->
        <header>
            <h1>üéÆ Niche Optimizer - Streamer AI Hub</h1>
            <div class="hub-status-container">
                <span class="status-dot" id="hub-status-dot"></span>
                <span class="status-text" id="hub-status">CONNECTING...</span>
            </div>
        </header>

        <!-- ===== MAIN CONTENT ===== -->
        <div class="content">
            <!-- ===== CARD 1: SCAN TARGET ===== -->
            <div class="card">
                <h2>üîç Scan Target</h2>
                <p>Analysez une cha√Æne Twitch ou un jeu pour obtenir des insights complets.</p>
                
                <div class="form-group">
                    <label for="scan-input">Cha√Æne ou Jeu :</label>
                    <input 
                        type="text" 
                        id="scan-input" 
                        placeholder="Ex: xQcOW ou League of Legends"
                    />
                </div>
                
                <button class="btn btn-primary" onclick="scanTarget()">
                    ‚ö° Scanner
                </button>
                
                <div id="scan-results" style="margin-top: 20px; display: none;">
                    <div id="scan-content"></div>
                </div>
            </div>

            <!-- ===== CARD 2: START RAID ===== -->
            <div class="card">
                <h2>‚öîÔ∏è Start Raid</h2>
                <p>Trouvez les meilleures cha√Ænes √† raidir selon le jeu et la taille d'audience.</p>
                
                <div class="form-group">
                    <label for="raid-game">Jeu :</label>
                    <input 
                        type="text" 
                        id="raid-game" 
                        placeholder="Ex: Valorant, Fortnite..."
                    />
                </div>
                
                <div class="form-group">
                    <label for="raid-viewers">Max Viewers :</label>
                    <input 
                        type="number" 
                        id="raid-viewers" 
                        placeholder="500" 
                        value="500"
                    />
                </div>
                
                <button class="btn btn-primary" onclick="startRaid()">
                    üéØ Trouver Target
                </button>
                
                <div id="raid-results" style="margin-top: 20px; display: none;">
                    <div id="raid-content"></div>
                </div>
            </div>

            <!-- ===== CARD 3: STREAM STATS ===== -->
            <div class="card">
                <h2>üìä Stream Stats</h2>
                <p>Consultez les statistiques globales de Twitch en temps r√©el.</p>
                
                <button class="btn btn-primary" onclick="loadStats()">
                    üìà Charger Stats
                </button>
                
                <div id="stats-results" style="margin-top: 20px; display: none;">
                    <div id="stats-content"></div>
                </div>
            </div>

            <!-- ===== CARD 4: BOOST STREAM ===== -->
            <div class="card">
                <h2>‚ö° Boost Stream</h2>
                <p>Activez un boost de 15 minutes pour votre cha√Æne (Firebase).</p>
                
                <div class="form-group">
                    <label for="boost-channel">Votre Cha√Æne :</label>
                    <input 
                        type="text" 
                        id="boost-channel" 
                        placeholder="Ex: votrechannel"
                    />
                </div>
                
                <button class="btn btn-primary" onclick="boostStream()">
                    ‚ú® Activer Boost
                </button>
                
                <div id="boost-results" style="margin-top: 20px; display: none;">
                    <div id="boost-content"></div>
                </div>
            </div>
        </div>

        <!-- ===== BEST TIME TOOL SECTION ===== -->
        <div class="best-time-section">
            <h3>üéØ Best Time to Stream</h3>
            <p>Trouvez le meilleur moment pour streamer un jeu en analysant la concurrence et le ratio pr√©sence/viewers</p>
            
            <div class="form-group">
                <label for="best-time-game">Nom du Jeu :</label>
                <input 
                    type="text" 
                    id="best-time-game" 
                    placeholder="Ex: League of Legends, Valorant, Fortnite..." 
                    class="input-field"
                />
            </div>
            
            <button 
                id="analyze-schedule-btn" 
                class="btn-primary"
                onclick="analyzeBestTime()"
            >
                ‚öôÔ∏è Analyser les meilleurs cr√©neaux
            </button>
            
            <div id="best-time-results" style="margin-top: 20px; display: none;">
                <div id="best-time-content"></div>
            </div>
            
            <div id="best-time-loading" style="margin-top: 20px; display: none;">
                <span class="spinner"></span>
                <p>Analyse en cours...</p>
            </div>
        </div>

        <!-- ===== CRITIQUE IA SECTION ===== -->
        <div class="card" style="margin-top: 20px;">
            <h2>ü§ñ Critique IA</h2>
            <p>Obtenez une analyse IA ou des id√©es de clips pour un niche/jeu.</p>
            
            <div class="form-group">
                <label for="critique-query">Query :</label>
                <input 
                    type="text" 
                    id="critique-query" 
                    placeholder="Ex: League of Legends"
                />
            </div>
            
            <div class="form-group">
                <label for="critique-type">Type :</label>
                <select id="critique-type">
                    <option value="niche">Audit Niche</option>
                    <option value="clips">Id√©es Clips</option>
                </select>
            </div>
            
            <button class="btn btn-primary" onclick="runCritique()">
                ‚ú® Analyser
            </button>
            
            <div id="critique-results" style="margin-top: 20px; display: none;">
                <div id="critique-content"></div>
            </div>
        </div>
    </div>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
        // ========== FIREBASE STATUS LISTENER ==========
        let firebaseStatusCheckInterval = null;

        async function initFirebaseStatusListener() {
            try {
                const response = await fetch('/firebase_status');
                const data = await response.json();
                
                const statusElement = document.getElementById('hub-status');
                const dotElement = document.getElementById('hub-status-dot');
                
                if (statusElement && dotElement) {
                    if (data.connected) {
                        statusElement.textContent = 'CONNECTED';
                        statusElement.style.color = '#00ff00';
                        dotElement.style.backgroundColor = '#00ff00';
                        dotElement.style.boxShadow = '0 0 10px rgba(0, 255, 0, 0.6)';
                    } else {
                        statusElement.textContent = 'DISCONNECTED';
                        statusElement.style.color = '#ff0000';
                        dotElement.style.backgroundColor = '#ff0000';
                        dotElement.style.boxShadow = '0 0 10px rgba(255, 0, 0, 0.6)';
                    }
                }
            } catch (error) {
                console.error('‚ùå Firebase status check failed:', error);
                const statusElement = document.getElementById('hub-status');
                if (statusElement) {
                    statusElement.textContent = 'ERROR';
                    statusElement.style.color = '#ff6600';
                }
            }
        }

        // ========== SCAN TARGET ==========
        async function scanTarget() {
            const query = document.getElementById('scan-input').value.trim();
            if (!query) {
                alert('Veuillez entrer une cha√Æne ou un jeu');
                return;
            }

            const resultsDiv = document.getElementById('scan-results');
            const contentDiv = document.getElementById('scan-content');
            
            try {
                const response = await fetch('/scan_target', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const data = await response.json();
                
                if (data.success) {
                    if (data.type === 'user') {
                        const u = data.user_data;
                        contentDiv.innerHTML = `
                            <div class="result-item">
                                <h4>${u.display_name}</h4>
                                <p><strong>Login:</strong> ${u.login}</p>
                                <p><strong>Jeu:</strong> ${u.game_name}</p>
                                <p><strong>Titre:</strong> ${u.title}</p>
                                <p><strong>Live:</strong> ${u.is_live ? '‚úÖ OUI' : '‚ùå NON'}</p>
                                <p><strong>Viewers:</strong> ${u.viewer_count}</p>
                                <p><strong>Score:</strong> ${u.ai_calculated_niche_score}</p>
                            </div>
                        `;
                    } else {
                        const g = data.game_data;
                        contentDiv.innerHTML = `
                            <div class="result-item">
                                <h4>${g.name}</h4>
                                <p><strong>Total Viewers:</strong> ${g.total_viewers}</p>
                                <p><strong>Score:</strong> ${g.ai_calculated_niche_score}/5</p>
                            </div>
                        `;
                    }
                    resultsDiv.style.display = 'block';
                } else {
                    contentDiv.innerHTML = '<p style="color:red;">‚ùå Non trouv√©</p>';
                    resultsDiv.style.display = 'block';
                }
            } catch (error) {
                console.error('Error:', error);
                contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur r√©seau</p>';
                resultsDiv.style.display = 'block';
            }
        }

        // ========== START RAID ==========
        async function startRaid() {
            const game = document.getElementById('raid-game').value.trim();
            const max_viewers = document.getElementById('raid-viewers').value;
            
            if (!game) {
                alert('Veuillez entrer un jeu');
                return;
            }

            const resultsDiv = document.getElementById('raid-results');
            const contentDiv = document.getElementById('raid-content');
            
            try {
                const response = await fetch('/start_raid', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ game, max_viewers })
                });
                const data = await response.json();
                
                if (data.success && data.target) {
                    const t = data.target;
                    contentDiv.innerHTML = `
                        <div class="result-item">
                            <h4>${t.name}</h4>
                            <p><strong>Jeu:</strong> ${t.game}</p>
                            <p><strong>Viewers:</strong> ${t.viewers}</p>
                            <img src="${t.thumbnail_url}" style="width:100%; border-radius:6px; margin-top:12px;">
                        </div>
                    `;
                } else {
                    contentDiv.innerHTML = '<p style="color:red;">‚ùå Aucune cha√Æne trouv√©e</p>';
                }
                resultsDiv.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur r√©seau</p>';
                resultsDiv.style.display = 'block';
            }
        }

        // ========== LOAD STATS ==========
        async function loadStats() {
            const resultsDiv = document.getElementById('stats-results');
            const contentDiv = document.getElementById('stats-content');
            
            try {
                const response = await fetch('/api/stats/global');
                const data = await response.json();
                
                if (data.success) {
                    contentDiv.innerHTML = `
                        <div class="result-item">
                            <h4>Statistiques Globales Twitch</h4>
                            <p><strong>Viewers Totaux (estim√©s):</strong> ${data.total_viewers.toLocaleString()}</p>
                            <p><strong>Cha√Ænes:</strong> ${data.total_channels}</p>
                            <p><strong>Top Jeu:</strong> ${data.top_game_name}</p>
                        </div>
                    `;
                } else {
                    contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur chargement</p>';
                }
                resultsDiv.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur r√©seau</p>';
                resultsDiv.style.display = 'block';
            }
        }

        // ========== BOOST STREAM ==========
        async function boostStream() {
            const channel = document.getElementById('boost-channel').value.trim();
            
            if (!channel) {
                alert('Veuillez entrer le nom de votre cha√Æne');
                return;
            }

            const resultsDiv = document.getElementById('boost-results');
            const contentDiv = document.getElementById('boost-content');
            
            try {
                const response = await fetch('/stream_boost', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ channel })
                });
                const data = await response.json();
                
                if (data.success) {
                    contentDiv.innerHTML = data.html_response || '<p style="color:green;">‚úÖ Boost activ√©!</p>';
                } else {
                    contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur</p>';
                }
                resultsDiv.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur r√©seau</p>';
                resultsDiv.style.display = 'block';
            }
        }

        // ========== BEST TIME TOOL ==========
        async function analyzeBestTime() {
            const gameInput = document.getElementById('best-time-game').value.trim();
            
            if (!gameInput) {
                alert('üéÆ Veuillez entrer un nom de jeu');
                return;
            }
            
            const btn = document.getElementById('analyze-schedule-btn');
            const loading = document.getElementById('best-time-loading');
            const results = document.getElementById('best-time-results');
            const content = document.getElementById('best-time-content');
            
            btn.disabled = true;
            loading.style.display = 'block';
            results.style.display = 'none';
            
            try {
                const response = await fetch('/analyze_schedule', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ game: gameInput })
                });
                
                const data = await response.json();
                
                if (data.html_response) {
                    content.innerHTML = data.html_response;
                    results.style.display = 'block';
                } else {
                    content.innerHTML = '<p style="color:red;">‚ùå Erreur lors de l\'analyse. Veuillez r√©essayer.</p>';
                    results.style.display = 'block';
                }
            } catch (error) {
                console.error('‚ùå Error:', error);
                content.innerHTML = '<p style="color:red;">‚ùå Erreur r√©seau. V√©rifiez votre connexion.</p>';
                results.style.display = 'block';
            } finally {
                btn.disabled = false;
                loading.style.display = 'none';
            }
        }

        // ========== RUN CRITIQUE ==========
        async function runCritique() {
            const query = document.getElementById('critique-query').value.trim();
            const type = document.getElementById('critique-type').value;
            
            if (!query) {
                alert('Veuillez entrer une query');
                return;
            }

            const resultsDiv = document.getElementById('critique-results');
            const contentDiv = document.getElementById('critique-content');
            
            try {
                const response = await fetch('/critique_ia', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ type, query })
                });
                const data = await response.json();
                
                if (data.html_response) {
                    contentDiv.innerHTML = data.html_response;
                } else {
                    contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur IA</p>';
                }
                resultsDiv.style.display = 'block';
            } catch (error) {
                console.error('Error:', error);
                contentDiv.innerHTML = '<p style="color:red;">‚ùå Erreur r√©seau</p>';
                resultsDiv.style.display = 'block';
            }
        }

        // ========== INITIALISATION AU CHARGEMENT ==========
        document.addEventListener('DOMContentLoaded', () => {
            // Initialiser le statut Firebase
            initFirebaseStatusListener();
            
            // V√©rifier le statut toutes les 5 secondes
            firebaseStatusCheckInterval = setInterval(initFirebaseStatusListener, 5000);
            
            // Permettre Entr√©e dans les champs
            const inputs = ['scan-input', 'raid-game', 'best-time-game', 'critique-query'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            if (id === 'scan-input') scanTarget();
                            else if (id === 'raid-game') startRaid();
                            else if (id === 'best-time-game') analyzeBestTime();
                            else if (id === 'critique-query') runCritique();
                        }
                    });
                }
            });
        });

        // Nettoyer les intervalles √† la fermeture
        window.addEventListener('beforeunload', () => {
            if (firebaseStatusCheckInterval) {
                clearInterval(firebaseStatusCheckInterval);
            }
        });
    </script>
</body>
</html>
