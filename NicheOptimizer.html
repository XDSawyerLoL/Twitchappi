<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer & Niche AI Hub V10.2 - Full Features</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* --- VARIABLES CSS (Ajout des ombres n√©on) --- */
        :root {
            --color-bg-dark: #0d0d0d;
            --color-bg-medium: #1a1a1a;
            --color-bg-light: #111;
            --color-primary-pink: #ff0099;
            --color-secondary-blue: #22c7ef;
            --color-ai-niche: #59d682;
            --color-ai-repurpose: #9933ff;
            --color-ai-growth: #ffcc00;
            --color-ai-action: #e34a64; 
            --color-text-dimmed: #9aa3a8;
            --color-border-dark: #2e2e2e;
            --color-border-medium: #333;
            
            /* ‚úÖ NOUVELLES VARIABLES D'OMBRES N√âON */
            --shadow-pink: 0 0 15px rgba(255, 0, 153, 0.4);
            --shadow-blue: 0 0 15px rgba(34, 199, 239, 0.4);
            --shadow-niche: 0 0 15px rgba(89, 214, 130, 0.4);
            --shadow-repurpose: 0 0 15px rgba(153, 51, 255, 0.4);
            --shadow-action: 0 0 15px rgba(227, 74, 100, 0.4);
            --shadow-growth: 0 0 15px rgba(255, 204, 0, 0.4);
        }

        /* Styles Globaux */
        body { background-color: var(--color-bg-dark); color: #fff; font-family: 'Inter', Arial, sans-serif; margin: 0; padding: 0; }
        #twitch-lucky-main { all: initial; display: block; max-width: 1200px; margin: 20px auto; padding: 10px; font-family: 'Inter', sans-serif; color: #fff; }
        
        /* ‚úÖ TITRE H1 ET SOUS-TITRE AM√âLIOR√âS */
        h1 { 
            font-family: 'Orbitron', sans-serif; 
            font-size: 28px; 
            color: var(--color-primary-pink); 
            margin-bottom: 5px; 
            text-align: center; 
            text-shadow: 0 0 5px var(--color-primary-pink), 0 0 15px rgba(255, 0, 153, 0.5); /* Effet N√©on */
        }
        .h1-blue-accent { color: var(--color-secondary-blue); }
        .subtitle-center { 
            color: var(--color-text-dimmed); 
            font-size: 12px; 
            margin-bottom: 25px; 
            text-align: center; 
            letter-spacing: 1px; /* Espacement pour look tech */
        }
        
        /* Lecteur */
        .player-wrapper { 
            margin-bottom: 20px; 
            padding: 15px; 
            background: var(--color-bg-medium); 
            border-radius: 12px; 
            border: 1px solid var(--color-border-dark); 
            box-shadow: var(--shadow-blue); /* Lueur autour du lecteur */
        }
        .player-wrapper h2 { 
            font-family: 'Orbitron', sans-serif; 
            font-size: 20px; 
            color: var(--color-secondary-blue); 
            margin: 0 0 10px; 
            display: flex; 
            align-items: center; 
            text-shadow: 0 0 4px var(--color-secondary-blue); /* N√©on H2 */
        }
        #player-channel-status { font-size: 12px; color: var(--color-text-dimmed); margin-left: auto; font-weight: normal; font-family: 'Inter', sans-serif; }
        #twitch-embed { width: 100%; height: 550px; border-radius: 8px; box-shadow: 0 0 15px rgba(34, 199, 239, 0.3); overflow: hidden; }
        #form-channel-player { display: flex; gap: 8px; margin-bottom: 15px; }
        
        /* Inputs & Boutons */
        .action-input { 
            width: 100%; 
            padding: 10px; 
            border-radius: 6px; 
            border: 1px solid var(--color-border-medium); 
            background: var(--color-bg-dark); 
            color: #fff; 
            font-size: 13px; 
            transition: border-color 0.3s, box-shadow 0.3s; /* Transition fluide */
        }
        .action-input:focus {
            border-color: var(--color-primary-pink);
            box-shadow: 0 0 8px rgba(255, 0, 153, 0.5); /* Focus n√©on rose */
            outline: none;
        }

        .btn-primary { background: var(--color-primary-pink); color: #fff; border: 0; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; text-transform: uppercase; font-size: 12px; box-shadow: 0 0 6px rgba(255,0,153,.4); transition: all 0.2s; }
        .btn-primary:hover:not(:disabled) { background: #E6008A; transform: scale(1.02); }
        .btn-secondary { background: var(--color-secondary-blue); color: var(--color-bg-dark); border: 0; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 600; text-transform: uppercase; font-size: 12px; box-shadow: 0 0 6px rgba(34,199,239,.4); transition: all 0.2s; }
        .btn-secondary:hover:not(:disabled) { background: #1eafdd; transform: scale(1.02); }
        
        /* R√©sultats IA */
        .ai-result-box { 
            background: #0a0a0a; 
            border: 1px solid var(--color-border-dark); 
            border-radius: 6px; 
            padding: 15px; 
            margin-top: 15px; 
            color: #ffffff; 
            transition: box-shadow 0.3s; /* Transition pour le changement de lueur */
        }
        .ai-result-box p { margin-bottom: 12px; line-height: 1.6; font-size: 13px; }
        .ai-result-box h4 { font-family: 'Orbitron', sans-serif; font-size: 16px; margin-top: 20px; margin-bottom: 10px; border-bottom: 2px solid var(--color-primary-pink); padding-bottom: 5px; color: var(--color-secondary-blue); }
        .ai-result-box strong { font-weight: 700; }
        
        /* Style des listes IA */
        .ai-result-box ul { margin-left: 0; padding-left: 0; list-style-type: none; margin-bottom: 15px; font-size: 13px; line-height: 1.5; }
        .ai-result-box li { margin-bottom: 8px; padding-left: 1.5em; position: relative; }
        
        /* Ic√¥nes par d√©faut (‚ö°) */
        .ai-result-box li:before {
            content: "‚ö°";
            color: var(--color-primary-pink);
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1.5em;
            position: absolute;
        }

        /* Couleurs IA sp√©cifiques pour les ic√¥nes */
        #niche-result-container li:before { content: "‚úÖ"; color: var(--color-ai-niche); }
        #repurpose-result-container li:before { content: "‚úÇÔ∏è"; color: var(--color-ai-repurpose); }
        .game-item li:before, #ai-trend-critique-container li:before { content: "üíé"; color: var(--color-ai-growth); }
        #auto-action-results li:before { content: "üî•"; color: var(--color-ai-action); } /* ACTION */


        /* ‚úÖ LUEURS SP√âCIFIQUES DES BO√éTES DE R√âSULTAT IA */
        #scan-result { border-color: var(--color-secondary-blue); box-shadow: var(--shadow-blue); }
        #niche-result-container { border-color: var(--color-ai-niche); box-shadow: var(--shadow-niche); }
        #repurpose-result-container { border-color: var(--color-ai-repurpose); box-shadow: var(--shadow-repurpose); }
        #ai-trend-critique-container { border-color: var(--color-ai-growth); box-shadow: var(--shadow-growth); }
        #boost-results { border-color: var(--color-primary-pink); box-shadow: var(--shadow-pink); }
        #auto-action-results, #action-report-box { border-color: var(--color-ai-action); box-shadow: var(--shadow-action); } /* ACTION */
        
        #niche-result-container h4 { color: var(--color-ai-niche); border-color: var(--color-ai-niche); }
        #repurpose-result-container h4 { color: var(--color-ai-repurpose); border-color: var(--color-ai-repurpose); }
        #ai-trend-critique-container h4 { color: var(--color-ai-growth); border-color: var(--color-ai-growth); }
        
        /* Style pour la zone de Repurposing visuel */
        #repurpose-vod-preview {
            background: var(--color-bg-light);
            border: 1px solid var(--color-ai-repurpose);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: none; 
            align-items: flex-start;
            gap: 15px;
            box-shadow: 0 0 10px rgba(153, 51, 255, 0.4);
        }
        #vod-title-display {
            font-size: 14px;
            font-weight: 600;
            color: var(--color-ai-repurpose);
            margin-bottom: 5px;
            line-height: 1.4;
        }
        .timestamp-link {
            background: var(--color-ai-repurpose);
            color: var(--color-bg-dark);
            padding: 3px 8px;
            border:none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
            margin-left: 5px;
            display: inline-block;
            text-transform: uppercase;
        }
        
        /* Onglets */
        .tab-btn { 
            font-family: 'Orbitron', sans-serif; 
            padding: 12px 15px; 
            background: var(--color-bg-light); 
            border: 1px solid var(--color-border-medium); 
            border-bottom: none; 
            color: var(--color-text-dimmed); 
            cursor: pointer; 
            border-radius: 8px 8px 0 0; 
            transition: all 0.3s; 
            flex: 1; 
            text-align: center; 
            font-size: 12px; 
            white-space: nowrap; 
        }
        .tab-btn:hover {
            color: #fff;
            background: #232323; 
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.15); /* Effet de survol l√©ger */
        }
        .tab-btn.active { 
            background: var(--color-bg-medium); 
            color: #fff; 
            border-top: 3px solid var(--color-primary-pink); 
            font-weight: bold;
            box-shadow: var(--shadow-pink); /* Glow pour l'onglet actif */
            z-index: 10; /* Pour s'assurer qu'il recouvre la bordure inf√©rieure */
            border-bottom: 1px solid var(--color-bg-medium); /* Pour que le contenu se fonde */
        }
        /* Correction de l'onglet Action pour garder la couleur */
        .tab-btn[data-tab-id="tab-action"].active {
            border-top: 3px solid var(--color-ai-action) !important;
            box-shadow: var(--shadow-action);
        }

        .tab-content { display: none; background: var(--color-bg-medium); border: 1px solid var(--color-border-dark); border-top: none; border-radius: 0 0 10px 10px; padding: 20px; }
        .tab-content.active { display: block; }
        .tab-heading { font-family:'Orbitron',sans-serif; margin-bottom:15px; font-size:16px; }
        .login-box { padding:15px; background:var(--color-bg-light); border-radius:8px; margin-bottom:20px; border: 1px solid #444; }

        /* Liste Streams & Jeux */
        #followed-streams-list, #trending-games-list { display: flex; flex-wrap: wrap; gap: 15px; padding: 0; margin: 0; }
        .followed-stream-item { 
            display: flex; 
            flex-direction: column; 
            width: calc(33.333% - 10px); 
            min-width: 180px; 
            padding: 10px; 
            background: var(--color-bg-light); 
            border-radius: 8px; 
            border: 1px solid var(--color-border-dark); 
            cursor: pointer; 
            transition: all 0.3s ease; /* Transition plus douce */
            transform: scale(1); /* Point de d√©part */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        .followed-stream-item:hover {
            background: #232323; /* L√©g√®rement plus clair */
            transform: translateY(-3px) scale(1.02); /* Soul√®vement et zoom */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7), var(--shadow-pink); /* Ombre intense avec glow rose */
        }
        
        /* Mini Assistant CSS (Fixe la bulle) */
        .assistant-btn { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: linear-gradient(135deg, var(--color-secondary-blue), #0066cc); 
            color: white; 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 24px; 
            cursor: pointer; 
            box-shadow: 0 4px 15px rgba(34, 199, 239, 0.4), 0 0 20px var(--color-secondary-blue); /* Lueur plus forte */
            z-index: 1000; 
            transition: transform 0.2s, box-shadow 0.3s; 
            border: none; 
        }
        .assistant-btn:hover {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 4px 20px rgba(34, 199, 239, 0.6), 0 0 30px var(--color-secondary-blue);
        }
        .assistant-panel { position: fixed; bottom: 90px; right: 20px; width: 350px; height: 500px; background: var(--color-bg-medium); border: 1px solid var(--color-secondary-blue); border-radius: 12px; display: none; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5), var(--shadow-blue); z-index: 1000; overflow: hidden; }
        .assistant-header { padding: 15px; background: rgba(34, 199, 239, 0.1); border-bottom: 1px solid var(--color-border-dark); font-family: 'Orbitron', sans-serif; font-size: 14px; color: var(--color-secondary-blue); display: flex; justify-content: space-between; align-items: center; text-shadow: 0 0 2px var(--color-secondary-blue); }
        .assistant-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 14px; border-radius: 8px; font-size: 13px; line-height: 1.4; max-width: 85%; color: #fff; }
        .msg.user { align-self: flex-end; background: var(--color-primary-pink); border-bottom-right-radius: 0; } 
        .msg.bot { align-self: flex-start; background: var(--color-bg-light); border: 1px solid var(--color-border-medium); color: #fff; border-bottom-left-radius: 0; }
        
        @media (max-width: 768px) {
            .followed-stream-item { width: 100%; min-width: unset; }
            #twitch-embed { height: 350px; }
            .tab-btn { flex-basis: 50%; max-width: 50%; }
            .assistant-panel { width: calc(100% - 40px); bottom: 90px; right: 20px; height: 400px; }
        }
    </style>
</head>
<body>

<div id="twitch-lucky-main">
    <h1 class="text-3xl"><span class="h1-blue-accent">STREAMER</span> HUB V10.2</h1>
    <div class="subtitle-center">Lecteur ‚Ä¢ Scan & IA ‚Ä¢ Niche ‚Ä¢ Repurposing ‚Ä¢ Croissance ‚Ä¢ Action</div>

    <div class="player-wrapper">
        <h2>
            <span style="margin-right:6px;" id="player-icon">üé¨</span> LECTEUR & CHAT
            <span id="player-channel-status"></span>
        </h2> 
        <form id="form-channel-player" class="flex">
            <input id="input-channel" type="text" placeholder="Nom de la cha√Æne Twitch (ex: gotaga)" title="Nom de la cha√Æne Twitch √† regarder" class="action-input flex-grow">
            <button type="submit" id="btn-player-launch" class="btn-primary min-w-[80px]">‚ñ∂Ô∏è LANCER</button>
        </form>
        <div id="twitch-embed"></div>
        <div id="twitch-player-share" class="pt-3 border-t border-gray-700" style="border-color:var(--color-border-dark);"></div>
    </div>

    <div id="tabs-container">
        <div class="flex flex-wrap flex-tabs">
            <button class="tab-btn" data-tab-id="tab-followed" onclick="openTab('tab-followed')">üîë MON FIL SUIVI</button> 
            <button class="tab-btn" data-tab-id="tab-cible" onclick="openTab('tab-cible')">üéØ SCAN & RESULTATS</button>
            <button class="tab-btn" data-tab-id="tab-niche" onclick="openTab('tab-niche')">üìà OPTIMISATION NICHE</button>
            <button class="tab-btn" data-tab-id="tab-repurpose" onclick="openTab('tab-repurpose')">üöÄ REPURPOSING</button>
            <button class="tab-btn" data-tab-id="tab-growth" onclick="openTab('tab-growth')">üí∞ CROISSANCE</button>
            <button class="tab-btn" data-tab-id="tab-boost" onclick="openTab('tab-boost')">‚ö° BOOST</button>
            <button class="tab-btn" data-tab-id="tab-action" onclick="openTab('tab-action')" style="border-top: 3px solid var(--color-ai-action);">üî• DISRUPTION/ACTION</button>
        </div>

        <div id="tab-followed" class="tab-content">
            <h3 class="tab-heading text-pink"><span class="icon">üîë</span> Connexion & Mon Fil Suivi</h3>
            <div class="login-box">
                <h4 class="text-blue font-bold text-sm mb-2">Connexion Utilisateur Twitch (OAuth)</h4>
                <p id="login-status" class="text-yellow text-xs mb-4">Statut: V√©rification...</p>
                <button id="btn-twitch-login" class="btn-primary" style="background:#6441a5; width:100%; padding: 12px;">üîí SE CONNECTER VIA TWITCH</button>
            </div>
            <div class="mt-6 pt-5 border-t border-gray-700" style="border-color: var(--color-border-medium);">
                <h4 class="tab-heading text-pink"><span class="icon">üî¥</span> Vos Cha√Ænes Suivies LIVE</h4>
                <div id="followed-streams-list"><p style="color:#555; text-align:center; padding:10px;">Chargement du fil...</p></div>
            </div>
        </div>

        <div id="tab-cible" class="tab-content">
            <h3 class="tab-heading text-blue"><span class="icon">üî≠</span> Configuration & Scan</h3>
            <form id="form-target" class="flex gap-2 mb-2">
                <input id="input-target" type="text" placeholder="Jeu ou Pseudo" class="action-input">
                <button type="submit" id="btn-target" class="btn-secondary min-w-[80px]">üéØ CIBLER</button>
            </form>
            <div id="scan-result" class="ai-result-box"><p style="text-align:center; color:var(--color-text-dimmed); font-weight: bold;">Entrez un jeu ou un pseudo et cliquez sur CIBLER.</p></div>
        </div>

        <div id="tab-niche" class="tab-content">
            <h3 class="tab-heading text-green"><span class="icon">üìà</span> Analyse de Niche</h3>
            <form id="form-niche-analysis" class="flex gap-2 mb-2">
                <input id="input-niche-game" type="text" placeholder="Jeu √† Analyser (ex: Starfield)" class="action-input">
                <button type="submit" id="btn-niche-analyse" class="btn-primary min-w-[120px]" style="background:var(--color-ai-niche);">‚ú® ANALYSER</button>
            </form>
            <div id="niche-result-container" class="ai-result-box"><div id="niche-results" class="ai-content"><p style="text-align:center; color:var(--color-text-dimmed); font-weight: bold;">Les r√©sultats de l'analyse de niche IA appara√Ætront ici.</p></div></div>
        </div>
        
        <div id="tab-repurpose" class="tab-content">
            <h3 class="tab-heading text-purple"><span class="icon">‚úÇÔ∏è</span> Repurposing IA</h3>
            <form id="form-repurpose" class="flex gap-2 mb-2 flex-col">
                <input id="input-repurpose-channel" type="text" placeholder="Pseudo du Streamer" class="action-input">
                <button type="submit" id="btn-repurpose-analyse" class="btn-primary p-3" style="background:var(--color-ai-repurpose);">üöÄ ANALYSER VOD</button>
            </form>
            
            <div id="repurpose-vod-preview">
                <img id="vod-thumbnail" src="https://placehold.co/150x84/222/9933ff.png?text=VOD" alt="Miniature VOD">
                <div class="flex-1">
                    <div id="vod-title-display">Saisissez un pseudo pour analyser sa derni√®re VOD.</div>
                    <a id="vod-link" href="#" target="_blank" class="btn-secondary" style="background: var(--color-secondary-blue); padding: 5px 10px; font-size: 11px;">Voir la VOD compl√®te</a>
                </div>
            </div>

            <div id="repurpose-result-container" class="ai-result-box"><div id="repurpose-results" class="ai-content"><p style="text-align:center; color:var(--color-text-dimmed); font-weight: bold;">Les suggestions de contenu court appara√Ætront ici.</p></div></div>
        </div>

        <div id="tab-growth" class="tab-content">
            <h3 class="tab-heading text-yellow"><span class="icon">üí∞</span> Tableau de Bord Croissance</h3>
            <div class="login-box">
                <button id="btn-hype-games" class="btn-primary w-full p-3 mb-4" style="background:var(--color-ai-niche); color: var(--color-bg-dark);">üïπÔ∏è MEILLEURS JEUX HYPE DU MOMENT</button>
                
                <button id="btn-trend-detector" class="btn-primary w-full p-3" style="background:var(--color-ai-growth); color: var(--color-bg-dark);">üîÆ D√âTECTER LA PROCHAINE NICHE (IA)</button>
                
                <div id="ai-trend-critique-container" class="ai-result-box" style="border-color: var(--color-ai-growth); margin-top: 15px;"><p style="text-align:center; color:var(--color-text-dimmed); font-weight: bold;">Cliquez sur le bouton du dessus pour lancer l'analyse des tendances V/S.</p></div>
            </div>
             <div class="mt-6 pt-5 border-t border-gray-700" style="border-color: var(--color-border-medium);">
                <h4 class="tab-heading text-yellow" style="color:var(--color-ai-niche);"><span class="icon">üìà</span> Jeux en Tendance (Twitch)</h4>
                <div id="trending-games-list" class="flex flex-wrap gap-4 justify-center">
                    <p style="color:#555; text-align:center; padding:10px;">Cliquez sur "Jeux Hype" pour charger les r√©sultats.</p>
                </div>
            </div>
        </div>

        <div id="tab-boost" class="tab-content">
            <h3 class="tab-heading text-pink"><span class="icon">‚¨ÜÔ∏è</span> STREAM BOOST</h3>
            <div class="login-box">
                <form id="form-boost" class="flex gap-2">
                    <input id="input-boost" type="text" placeholder="Cha√Æne √† promouvoir" class="action-input">
                    <button type="submit" id="btn-boost" class="btn-primary min-w-[100px]">üì§ BOOST</button>
                </form>
                <div id="boost-results" class="ai-result-box" style="border-color: var(--color-primary-pink); margin-top: 15px;"><p style="text-align:center; color: var(--color-text-dimmed);">Entrez le nom de la cha√Æne et cliquez sur BOOST. (Cooldown de 3 heures)</p></div>
            </div>
        </div>
        
        <div id="tab-action" class="tab-content">
            <h3 class="tab-heading" style="color:var(--color-ai-action);"><span class="icon">üî•</span> DISRUPTION & AUTO-ACTION</h3>
            <div class="login-box">
                <form id="form-auto-action" class="flex flex-col gap-3">
                    <h4 class="text-sm font-bold" style="color:var(--color-ai-action);">S√©lectionnez l'Action Automatique:</h4>
                    <select id="select-action-type" class="action-input">
                        <option value="export_metrics">üìä EXPORT METRICS (Statistiques)</option>
                        <option value="random_raid">üöÄ RAID AL√âATOIRE</option> <option value="title_disruption">üìù SUGGESTION TITRE DISRUPTIF</option>
                    </select>
                    <input id="input-auto-action" type="text" placeholder="Entrez la cha√Æne/Jeu/Th√®me" class="action-input">
                    <button type="submit" id="btn-auto-action" class="btn-primary p-3" style="background:var(--color-ai-action);">üöÄ LANCER L'ACTION</button>
                </form>
                
                <div id="auto-action-results" class="ai-result-box" style="border-color: var(--color-ai-action); margin-top: 15px;">
                    <p style="text-align:center; color: var(--color-text-dimmed);">S√©lectionnez une action et un objectif, puis lancez.</p>
                </div>
                
                <div id="action-report-box" class="ai-result-box mt-3" style="display:none; border-color: var(--color-ai-action);">
                    <h5 style="color:var(--color-ai-action); font-size: 16px; margin-bottom: 10px; border-color:var(--color-ai-action);">Rapport d'Action / Metrics</h5>
                    <div class="grid grid-cols-3 gap-3 text-center"> 
                        <div><span id="metric-views" class="text-xl font-bold" style="color:var(--color-ai-action);">N/A</span><p class="text-xs text-gray-400">Vues Totales</p></div> 
                        <div><span id="metric-retention" class="text-xl font-bold" style="color:var(--color-ai-niche);">N/A</span><p class="text-xs text-gray-400">R√©tention (%)</p></div> 
                        <div><span id="metric-engagement" class="text-xl font-bold" style="color:var(--color-primary-pink);">N/A</span><p class="text-xs text-gray-400">Engagement</p></div> 
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="assistant-toggle-btn" class="assistant-btn" title="Ouvrir l'assistant IA">
        <i class="fas fa-robot"></i>
    </button>
    <div id="assistant-panel" class="assistant-panel">
        <div class="assistant-header">
            Assistant Niche AI <i class="fas fa-times cursor-pointer ml-auto" id="assistant-close-btn"></i>
        </div>
        <div id="assistant-messages" class="assistant-messages">
            <div class="msg bot">Bonjour ! Je suis l'assistant AI Hub. Demandez-moi des id√©es de contenu, de la critique ou des conseils en temps r√©el.</div>
        </div>
        <form id="assistant-form" class="p-3 border-t" style="border-color:var(--color-border-dark);">
            <div class="flex gap-2">
                <input id="assistant-input" type="text" placeholder="Votre question √† l'IA..." class="action-input flex-grow">
                <button type="submit" class="btn-primary min-w-[60px]" style="background:var(--color-secondary-blue);">Envoyer</button>
            </div>
        </form>
    </div>

</div>

<script src="https://player.twitch.tv/js/embed/v1.js"></script>
<script>
    const API_BASE = window.location.origin;
    const DEFAULT_CHANNEL = 'twitchdev';
    let twitchPlayer;
    let currentChannel = DEFAULT_CHANNEL;
    let currentVODId = null;
    let twitchUserConnected = false;
    let authChecked = false;

    // Utilitaires
    function hmsToSeconds(str) {
        const p = str.split(':'),
            s = 0,
            m = 1;
        while (p.length > 0) {
            s += m * parseInt(p.pop(), 10);
            m *= 60;
        }
        return s;
    }

    // --- 1. Initialisation du Lecteur Twitch ---
    window.launchPlayer = function(channel, videoID = null) {
        currentChannel = channel;
        currentVODId = videoID; // Stocker l'ID de la VOD
        
        // Mettre √† jour les URLs de partage
        addPlayerShareButtons(channel, videoID);

        // Mettre √† jour le statut et l'ic√¥ne du lecteur
        updatePlayerStatusDisplay(channel, videoID, !videoID && channel !== DEFAULT_CHANNEL && isChannelLive(channel));
        
        // Supprimer l'ancien lecteur s'il existe
        const embedDiv = document.getElementById('twitch-embed');
        embedDiv.innerHTML = '';
        
        const options = {
            width: '100%',
            height: '100%',
            channel: channel,
            parent: [window.location.hostname, 'localhost'],
            layout: 'video', 
            theme: 'dark'
        };
        
        if (videoID) {
            delete options.channel;
            options.video = videoID;
        }

        twitchPlayer = new Twitch.Player('twitch-embed', options);
        twitchPlayer.addEventListener(Twitch.Player.READY, () => {
             console.log(`Lecteur Twitch pr√™t pour ${channel}`);
             // Si c'est une VOD avec un timestamp, le chercher
             const targetTime = localStorage.getItem('vodSeekTime');
             if(targetTime) {
                 twitchPlayer.seek(parseInt(targetTime));
                 localStorage.removeItem('vodSeekTime');
             }
        });
        
        localStorage.setItem('activeChannel', channel);
    };

    // Fonction pour chercher dans une VOD (utilis√©e par le repurposing)
    window.seekVod = function(vodID, seconds) {
        if (!twitchPlayer || currentVODId !== vodID) {
             // Red√©marrer le lecteur sur la VOD si n√©cessaire, puis chercher
             localStorage.setItem('vodSeekTime', seconds); // Stocker le temps pour l'√©v√©nement READY
             window.launchPlayer(currentChannel, vodID);
        } else {
             twitchPlayer.seek(seconds);
        }
    }


    // --- 2. Mise √† jour de l'affichage du statut du lecteur ---
    function updatePlayerStatusDisplay(channelName, videoId, isLive) {
        const statusEl = document.getElementById('player-channel-status');
        const iconEl = document.getElementById('player-icon');
        if (videoId) {
            statusEl.innerHTML = `üìº VOD: ${channelName.toUpperCase()}`;
            statusEl.style.color = 'var(--color-ai-repurpose)';
            iconEl.innerHTML = '‚ñ∂Ô∏è';
        } else if (isLive) {
            statusEl.innerHTML = `üî¥ ${channelName.toUpperCase()} (LIVE)`;
            statusEl.style.color = '#ff0000';
            iconEl.innerHTML = 'üî•';
        } else {
            statusEl.innerHTML = `${channelName.toUpperCase()} (Hors ligne)`;
            statusEl.style.color = 'var(--color-text-dimmed)';
            iconEl.innerHTML = 'üé¨';
        }
    }

    // Une fonction bidon pour la d√©mo, car l'√©tat LIVE r√©el n'est pas facilement g√©r√© c√¥t√© client sans poll
    function isChannelLive(channel) {
         return channel === 'twitchdev' || channel === localStorage.getItem('activeChannel');
    }

    // --- ‚úÖ NOUVELLE LOGIQUE DE PARTAGE DU LECTEUR --- 
    function addPlayerShareButtons(channel, videoID) {
        const container = document.getElementById('twitch-player-share');
        container.innerHTML = ''; // Nettoyer
        
        const isLive = !videoID;
        const shareUrl = isLive ? `https://twitch.tv/${channel}` : `https://twitch.tv/${channel}/videos/${videoID}`;
        
        // Le bouton de partage VOD/Stream complet
        const fullLink = `<a href="${shareUrl}" target="_blank" class="btn-secondary py-1.5 px-3 rounded text-xs font-semibold mr-3 transition duration-200">
            ${isLive ? '<i class="fab fa-twitch mr-1"></i> Voir Stream' : '<i class="fas fa-video mr-1"></i> Voir VOD'}
        </a>`;
        
        container.innerHTML += `
            <div class="flex items-center gap-2">
                ${fullLink}
                <span style="color:var(--color-text-dimmed); font-size:12px;">Partager le ${isLive ? 'Stream' : 'Clip'}:</span>
                <button data-platform="twitter" data-share-url="${shareUrl}" data-channel="${channel}" class="share-player-btn bg-[#1DA1F2] hover:bg-[#1A91DA] text-white py-1.5 px-3 rounded text-xs font-semibold flex items-center transition duration-200" title="Partager sur X (Twitter)"> <i class="fab fa-twitter mr-1"></i> X </button>
                <button data-platform="reddit" data-share-url="${shareUrl}" data-channel="${channel}" class="share-player-btn bg-[#FF4500] hover:bg-[#E53D00] text-white py-1.5 px-3 rounded text-xs font-semibold flex items-center transition duration-200" title="Partager sur Reddit"> <i class="fab fa-reddit-alien mr-1"></i> Reddit </button>
                <button data-platform="discord" data-share-url="${shareUrl}" data-channel="${channel}" class="share-player-btn bg-[#5865F2] hover:bg-[#4752C4] text-white py-1.5 px-3 rounded text-xs font-semibold flex items-center transition duration-200" title="Copier le lien pour Discord"> <i class="fab fa-discord mr-1"></i> Discord </button>
                <button data-platform="whatsapp" data-share-url="${shareUrl}" data-channel="${channel}" class="share-player-btn bg-[#25D366] hover:bg-[#1DA853] text-white py-1.5 px-3 rounded text-xs font-semibold flex items-center transition duration-200" title="Partager sur WhatsApp"> <i class="fab fa-whatsapp mr-1"></i> WhatsApp </button>
                <button data-platform="copy" data-share-url="${shareUrl}" data-channel="${channel}" class="share-player-btn bg-gray-600 hover:bg-gray-500 text-white py-1.5 px-3 rounded text-xs font-semibold flex items-center transition duration-200" title="Copier le lien"> <i class="fas fa-copy mr-1"></i> Copier </button>
            </div>
        `;
    }

    /**
     * G√®re le partage d'un lien (Stream ou VOD) sur les r√©seaux sociaux.
     * @param {string} platform - Le r√©seau social (twitter, reddit, discord, whatsapp, telegram, copy).
     * @param {string} url - L'URL du Stream ou de la VOD √† partager.
     * @param {string} channelName - Le nom de la cha√Æne pour le message de partage.
     */
    function shareLinkContent(platform, url, channelName) {
        const title = encodeURIComponent(`üî¥ Regardez ${channelName} en direct !`);
        const message = encodeURIComponent(`Je regarde ${channelName} sur Twitch via le Streamer AI Hub. C'est le moment de nous rejoindre !`);
        let shareUrl = url;

        switch (platform) {
            case 'twitter':
                shareUrl = `https://twitter.com/intent/tweet?text=${message}&url=${encodeURIComponent(url)}`;
                break;
            case 'reddit':
                shareUrl = `https://www.reddit.com/submit?url=${encodeURIComponent(url)}&title=${title}`;
                break;
            case 'discord':
            case 'copy':
                navigator.clipboard.writeText(`${decodeURIComponent(message)}\n${url}`).then(() => {
                    alert('‚úÖ Le lien de stream a √©t√© copi√© dans votre presse-papiers pour Discord ! Collez-le dans votre canal.');
                }).catch(err => {
                    console.error('Erreur de copie:', err);
                });
                return;
            case 'whatsapp':
                shareUrl = `whatsapp://send?text=${message}%20${encodeURIComponent(url)}`;
                break;
            case 'telegram':
                shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${message}`;
                break;
            default:
                return;
        }

        window.open(shareUrl, '_blank');
    }
    
    // --- 3. Gestion de l'Authentification ---
    async function handleLogout() {
        await fetch(`${API_BASE}/twitch_logout`, { method: 'POST' });
        authChecked = false; // Forcer la re-v√©rification
        checkAuth();
    }

    async function checkAuth() {
        if (authChecked) return;
        authChecked = true;
        
        const loginStatus = document.getElementById('login-status');
        const loginButton = document.getElementById('btn-twitch-login');
        
        loginStatus.textContent = 'Statut: V√©rification...';
        loginButton.disabled = true;

        try {
            const res = await fetch(`${API_BASE}/twitch_user_status`);
            const data = await res.json();
            
            if (data.is_connected) {
                twitchUserConnected = true;
                loginStatus.innerHTML = `‚úÖ Connect√© en tant que <strong style="color:var(--color-secondary-blue)">${data.display_name || data.username}</strong>`;
                loginButton.textContent = 'üîí D√âCONNEXION';
                loginButton.style.background = '#e34a64';
                loginButton.onclick = handleLogout;
                await loadFollowedStreams();
            } else {
                twitchUserConnected = false;
                loginStatus.textContent = '‚ùå D√©connect√©. Veuillez vous connecter.';
                loginButton.textContent = 'üîí SE CONNECTER VIA TWITCH';
                loginButton.style.background = '#6441a5';
                loginButton.onclick = () => window.location.href = `${API_BASE}/twitch_auth_start`;
                document.getElementById('followed-streams-list').innerHTML = '<p style="text-align:center; color:var(--color-text-dimmed); padding:10px;">Connectez-vous pour voir votre fil suivi.</p>';
            }
        } catch(e) {
             loginStatus.innerHTML = `<p style="color:red;">‚ùå Erreur serveur: Impossible de v√©rifier l'√©tat.</p>`;
        } finally {
            loginButton.disabled = false;
        }
    }

    // --- 4. Chargement des Streams Suivis ---
    async function loadFollowedStreams() {
        if (!twitchUserConnected) return;
        
        const followedStreamsList = document.getElementById('followed-streams-list');
        followedStreamsList.innerHTML = '<p style="text-align:center; color:#555; padding:10px;">Chargement des streams LIVE...</p>';

        try {
            const res = await fetch(`${API_BASE}/followed_streams`);
            const data = await res.json();

            if (!res.ok) {
                 throw new Error(data.error || `Erreur serveur lors de la r√©cup√©ration du fil: Statut ${res.status}`);
            }
            if (!data.success) {
                 throw new Error(data.error || "√âchec de l'API serveur.");
            }

            if (data.streams.length === 0) {
                followedStreamsList.innerHTML = '<p style="text-align:center; color:var(--color-text-dimmed); padding:10px;">Aucune cha√Æne suivie n\'est actuellement en direct.</p>';
                return;
            }

            followedStreamsList.innerHTML = '';
            data.streams.forEach(stream => {
                const item = document.createElement('div');
                item.className = 'followed-stream-item';
                item.onclick = () => window.launchPlayer(stream.user_login);
                
                // Remplacement des placeholders pour les vignettes Twitch
                const thumbnailUrl = stream.thumbnail_url
                    .replace('{width}', '320')
                    .replace('{height}', '180');
                    
                item.innerHTML = `
                    <img src="${thumbnailUrl}" alt="${stream.user_name}" class="rounded-lg object-cover w-full h-20" style="min-height:90px;">
                    <strong style="color:var(--color-primary-pink); font-size: 13px; margin-top: 5px;" class="truncate">${stream.user_name}</strong>
                    <div class="flex justify-between text-xs mt-1">
                        <span class="text-gray-400 truncate">${stream.game_name}</span>
                        <span style="color:#ff0000; font-weight:bold;">${stream.viewer_count.toLocaleString('fr-FR')} vues</span>
                    </div>
                    <p class="text-xs text-white mt-1 truncate">${stream.title.substring(0, 50)}...</p>
                `;
                followedStreamsList.appendChild(item);
            });

        } catch (error) {
            let errorMessage = error.message;
            if (errorMessage.includes("Veuillez vous reconnecter via Twitch")) {
                errorMessage += " (Token expir√©, reconnectez-vous)";
                authChecked = false; // D√©clencher une nouvelle v√©rification
                checkAuth();
            }
            followedStreamsList.innerHTML = `<p style="color:red; text-align:center; padding:10px;">‚ùå Erreur de chargement du fil: ${errorMessage}</p>`;
        }
    }

    // --- 5. Logique des Onglets ---
    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        
        document.getElementById(tabId).classList.add('active');
        document.querySelector(`.tab-btn[data-tab-id="${tabId}"]`).classList.add('active');

        localStorage.setItem('activeTab', tabId);

        // Si l'onglet Croissance est actif et la liste est vide, la charger
        if (tabId === 'tab-growth' && document.getElementById('trending-games-list').children.length === 1 && document.getElementById('trending-games-list').textContent.includes('Hype')) {
            // Tentative de chargement auto des jeux en tendance
             // Le chargement se fait via le clic sur btn-hype-games. Laissez l'utilisateur cliquer pour √©viter un appel API inutile au chargement.
        }
    }


    // --- 6. GESTIONNAIRES D'√âV√âNEMENTS G√âN√âRAUX ---
    
    // Fonction d'appel IA g√©n√©rique
    async function callAI(type, query, targetElement, button) {
        targetElement.innerHTML = `<p style="text-align:center; color:var(--color-primary-pink);">ü§ñ L'IA est en train d'analyser...</p>`;
        button.disabled = true;
        try {
            const res = await fetch(`${API_BASE}/critique_ia`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type, query })
            });
            const data = await res.json();

            if (!res.ok) {
                targetElement.innerHTML = data.html_response || `<p style="color:red; padding:10px;">‚ùå Erreur serveur IA: Code ${res.status}. D√©tail: ${data.message || 'Probl√®me inconnu.'}</p>`;
                return;
            }
            if (data.success) {
                targetElement.innerHTML = data.html_response;
            } else {
                throw new Error(data.error || "√âchec de l'analyse IA.");
            }
        } catch (e) {
            targetElement.innerHTML = `<p style="color:red; padding:10px;">‚ùå Erreur: ${e.message}</p>`;
        } finally {
            button.disabled = false;
        }
    }

    // Fonction d'analyse de niche (appel√©e par le scan ou le bouton niche)
    window.analyzeGameNiche = function(game_name) {
        openTab('tab-niche');
        document.getElementById('input-niche-game').value = game_name;
        document.getElementById('btn-niche-analyse').click();
    }


    // --- 7. LOGIQUE DE L'ONGLET ACTION/DISRUPTION (CORRIG√â POUR RAID) --- 
    document.getElementById('form-auto-action').addEventListener('submit', async function(e) {
        e.preventDefault();
        const query = document.getElementById('input-auto-action').value.trim();
        const actionType = document.getElementById('select-action-type').value;
        const resultBox = document.getElementById('auto-action-results');
        const reportBox = document.getElementById('action-report-box');
        const btn = document.getElementById('btn-auto-action');

        if (!query) return;

        btn.disabled = true;
        btn.innerHTML = `<i class="fas fa-spinner fa-spin"></i> Traitement...`;
        resultBox.innerHTML = `<p style="text-align:center; color:var(--color-ai-action);">üöÄ Lancement de l'action ${actionType.toUpperCase()}...</p>`;
        reportBox.style.display = 'none';

        let endpoint;
        let method = 'POST';
        let body = null;
        const isRaidAction = actionType === 'random_raid';
        
        if (isRaidAction) {
            if (query.length < 2) {
                 resultBox.innerHTML = `<p style="color:red; text-align:center;">‚ùå Entrez un nom de jeu valide (minimum 2 caract√®res) pour lancer le raid.</p>`;
                 btn.disabled = false;
                 btn.innerHTML = `üöÄ LANCER L'ACTION`;
                 return;
            }
            endpoint = `${API_BASE}/random_raid_target?game_name=${encodeURIComponent(query)}`;
            method = 'GET';
        } else {
            endpoint = `${API_BASE}/auto_action`;
            body = JSON.stringify({ query, action_type: actionType });
        }

        try {
            const res = await fetch(endpoint, {
                method: method,
                headers: method === 'POST' ? { 'Content-Type': 'application/json' } : {},
                body: body
            });
            const data = await res.json();
            
            if (!res.ok) { 
                throw new Error(data.error || `Erreur serveur (HTTP ${res.status}).`);
            }

            if (data.success) {
                let htmlOutput = '';
                
                if (isRaidAction && data.raid_target) {
                    const target = data.raid_target;
                    htmlOutput = `
                        <div class="p-4 bg-[#0a0a0a] rounded-lg shadow-lg" style="border: 1px solid var(--color-ai-action);">
                            <h4 style="color:var(--color-ai-action); font-family: 'Orbitron', sans-serif;">üéâ CIBLE DE RAID AL√âATOIRE TROUV√âE !</h4>
                            <p class="text-white text-sm">
                                Streamer : <strong>${target.display_name}</strong> (Jeu: ${query})<br>
                                Vues Actuelles : <strong>${target.viewer_count.toLocaleString('fr-FR')}</strong>
                            </p>
                            <a href="https://twitch.tv/${target.user_login}" target="_blank" class="btn-primary py-2 px-4 rounded-lg font-semibold block text-center mt-3" style="background:var(--color-ai-action);">
                                <i class="fas fa-paper-plane mr-2"></i> Lancer le Raid vers ${target.display_name}
                            </a>
                            <p class="text-xs text-gray-400 mt-2">N'oubliez pas d'utiliser la commande /raid sur votre propre cha√Æne Twitch.</p>
                        </div>
                    `;
                } else if (data.html_response) {
                    // Autres actions IA
                    htmlOutput = data.html_response;
                }
                
                resultBox.innerHTML = htmlOutput || '<p style="color:var(--color-ai-niche); text-align:center;">‚úÖ Action termin√©e, pas de r√©ponse HTML sp√©cifique.</p>';

                // Mise √† jour des m√©triques si disponibles
                if (data.metrics && reportBox) {
                    document.getElementById('metric-views').textContent = data.metrics.views || 'N/A';
                    document.getElementById('metric-retention').textContent = data.metrics.retention || 'N/A';
                    document.getElementById('metric-engagement').textContent = data.metrics.engagement || 'N/A';
                    reportBox.style.display = 'block';
                }
                
            } else {
                 resultBox.innerHTML = `<p style="color:red; text-align:center;">‚ùå ${data.message || data.error || '√âchec de l\'action.'}</p>`;
            }

        } catch (error) {
            let errorMessage = error.message;
            if (errorMessage.includes("JSON") && errorMessage.includes("Unexpected token")) {
                errorMessage = "Erreur de format de l'API (pas de JSON). L'API est probablement HS.";
            } else if (errorMessage.includes("Failed to fetch")) {
                errorMessage = "√âchec de la connexion au serveur (r√©seau coup√© ou API non d√©marr√©e).";
            }
            
            resultBox.innerHTML = `<p style="color:var(--color-ai-action); font-weight:bold; text-align:center;">‚ùå Erreur: ${errorMessage}</p>`;
            reportBox.style.display = 'none';
        } finally {
            btn.disabled = false;
            btn.innerHTML = `üöÄ LANCER L'ACTION`;
        }
    });


    // --- 8. Initialisation et √âcouteur des Nouveaux Boutons de Partage ---
    document.addEventListener('DOMContentLoaded', function() {
        const lastChannel = localStorage.getItem('activeChannel') || DEFAULT_CHANNEL;
        window.launchPlayer(lastChannel); 

        const savedTab = localStorage.getItem('activeTab') || 'tab-followed';
        openTab(savedTab);
        
        checkAuth();
        
        // --- √âcouteur des Nouveaux Boutons de Partage du Player ---
        document.getElementById('twitch-player-share').addEventListener('click', function(e) {
            const btn = e.target.closest('.share-player-btn');
            if (!btn) return;
            
            const platform = btn.dataset.platform;
            const url = btn.dataset.shareUrl;
            const channel = btn.dataset.channel;

            if (url && channel) {
                shareLinkContent(platform, url, channel);
            }
        });
        
        // Formulaire de lancement du Player
        document.getElementById('form-channel-player').addEventListener('submit', function(e) {
            e.preventDefault();
            const channel = document.getElementById('input-channel').value.trim();
            if (channel) {
                window.launchPlayer(channel);
            }
        });
        
        // Assistant
        document.getElementById('assistant-toggle-btn').addEventListener('click', () => {
            document.getElementById('assistant-panel').style.display = 'flex';
        });
        document.getElementById('assistant-close-btn').addEventListener('click', () => {
            document.getElementById('assistant-panel').style.display = 'none';
        });
    });
    
</script>
</body>
</html>
