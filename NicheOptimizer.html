<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer & Niche AI Hub - FULL POWER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* TES STYLES ORIGINAUX (CONSERV√âS √Ä 100%) */
        :root {
            --color-bg-dark: #0d0d0d;
            --color-bg-medium: #1a1a1a;
            --color-primary-pink: #ff0099;
            --color-secondary-blue: #22c7ef;
            --color-ai-niche: #59d682;
            --color-ai-repurpose: #9933ff;
            --color-ai-action: #e34a64; 
            --color-text-dimmed: #9aa3a8;
            --color-border-dark: #2e2e2e;
            --shadow-pink: 0 0 15px rgba(255, 0, 153, 0.4);
            --shadow-blue: 0 0 15px rgba(34, 199, 239, 0.4);
            --shadow-niche: 0 0 15px rgba(89, 214, 130, 0.4);
            --shadow-repurpose: 0 0 15px rgba(153, 51, 255, 0.4);
        }
        body { background-color: var(--color-bg-dark); color: #fff; font-family: 'Inter', sans-serif; }
        .tab-btn.active { border-top: 3px solid var(--color-primary-pink); box-shadow: var(--shadow-pink); background: var(--color-bg-medium); }
        .dashboard-box { background: #0a0a0a; border: 1px solid var(--color-border-dark); border-radius: 6px; padding: 15px; min-height: 250px; }
        .niche-score-value { font-family: 'Orbitron', sans-serif; font-size: 40px; color: var(--color-ai-niche); text-shadow: var(--shadow-niche); }
        #twitch-embed { width: 100%; height: 500px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="max-w-7xl mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-2" style="font-family:'Orbitron'; color:var(--color-primary-pink); text-shadow: var(--shadow-pink);">
        STREAMER HUB <span style="color:var(--color-secondary-blue)">FULL POWER</span>
    </h1>

    <div class="flex gap-2 mb-4 overflow-x-auto pb-2">
        <button class="px-4 py-2 bg-gray-800 rounded-t-lg tab-btn active" onclick="openTab('tab-followed')">üîë SUIVI</button>
        <button class="px-4 py-2 bg-gray-800 rounded-t-lg tab-btn" onclick="openTab('tab-dashboard')">üìä DASHBOARD AI</button>
        <button class="px-4 py-2 bg-gray-800 rounded-t-lg tab-btn" onclick="openTab('tab-boost')">‚ö° BOOST</button>
        <button class="px-4 py-2 bg-gray-800 rounded-t-lg tab-btn" onclick="openTab('tab-raid')">üí• RAID</button>
    </div>

    <div class="bg-gray-900 p-4 rounded-xl border border-gray-800 mb-6 shadow-2xl">
        <div class="flex justify-between items-center mb-4">
            <h2 id="player-channel-status" class="text-blue-400 font-bold">LECTEUR AUTO-SYNC</h2>
            <div class="flex gap-2">
                <input id="input-channel" type="text" placeholder="Pseudo..." class="bg-black border border-gray-700 px-2 py-1 rounded text-sm">
                <button onclick="launchPlayer(document.getElementById('input-channel').value)" class="bg-pink-600 px-3 py-1 rounded text-xs font-bold">GO</button>
            </div>
        </div>
        <div id="twitch-embed"></div>
    </div>

    <div id="tab-followed" class="tab-content block">
        <div class="flex justify-between items-center mb-4">
            <h3 style="color:var(--color-primary-pink)">üî¥ Directs suivis</h3>
            <button id="btn-twitch-login" class="bg-purple-700 px-4 py-2 rounded font-bold text-xs">CONNEXION TWITCH</button>
        </div>
        <div id="followed-streams-list" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
    </div>

    <div id="tab-dashboard" class="tab-content hidden">
        <div class="text-center mb-8">
            <input id="input-global-target" type="text" placeholder="Streamer ou Jeu..." class="w-full md:w-1/2 p-3 bg-black border border-gray-700 rounded-lg text-xl text-center">
            <button onclick="runGlobalScan(document.getElementById('input-global-target').value)" class="w-full md:w-1/2 mt-4 bg-gradient-to-r from-blue-500 to-purple-600 p-3 rounded-lg font-bold">üöÄ ANALYSE 360¬∞</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="dashboard-box border-t-2 border-blue-500" id="res-scan-content">üìä STATS TWITCH</div>
            <div class="dashboard-box border-t-2 border-green-500" id="res-niche-content">üß† IA NICHE</div>
            <div class="dashboard-box border-t-2 border-purple-500" id="res-vod-content">‚úÇÔ∏è IA CLIPS</div>
        </div>
    </div>

    <div id="tab-boost" class="tab-content hidden p-6 bg-gray-900 rounded-lg">
        <h3 class="text-pink-500 font-bold mb-4">‚ö° ACTIVATION BOOST (15 MIN)</h3>
        <input id="input-boost" type="text" class="bg-black border p-2 w-full mb-4 rounded" placeholder="Ton pseudo Twitch">
        <button onclick="activateBoost()" class="w-full bg-pink-600 p-3 rounded font-bold">ACTIVER LE BOOST PRIORITAIRE</button>
        <div id="boost-results" class="mt-4 text-center"></div>
    </div>

    <div id="tab-raid" class="tab-content hidden p-6 bg-gray-900 rounded-lg border border-red-900">
        <h3 class="text-red-500 font-bold mb-4">üí• RECHERCHE RAID INTELLIGENTE</h3>
        <input id="input-raid-game" type="text" class="bg-black border p-2 w-full mb-4 rounded" placeholder="Jeu (ex: Minecraft)">
        <button onclick="startRaidSearch()" class="w-full bg-red-700 p-3 rounded font-bold">TROUVER UNE CIBLE & RAIDER</button>
        <div id="raid-results" class="mt-4"></div>
    </div>
</div>

<script src="https://embed.twitch.tv/embed/v1.js"></script>
<script>
    const API_BASE = window.location.origin;
    let embed = null;

    // --- NAVIGATION ---
    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.add('hidden'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.remove('hidden');
        event.currentTarget.classList.add('active');
    }

    // --- LECTEUR ---
    function launchPlayer(channel) {
        if (!channel) return;
        document.getElementById('twitch-embed').innerHTML = "";
        embed = new Twitch.Embed("twitch-embed", {
            width: "100%", height: "100%", channel: channel,
            parent: ["justplayer.fr", "justplayerstreamhubpro.onrender.com"]
        });
        document.getElementById('player-channel-status').innerText = `LECTURE : ${channel.toUpperCase()}`;
    }

    // --- IA FULL POWER ---
    async function runAI(type, query, box) {
        box.innerHTML = "<i class='fas fa-sync fa-spin'></i> Calcul IA...";
        try {
            const res = await fetch(`${API_BASE}/critique_ia`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type, query, niche_score: "8.5" })
            });
            const data = await res.json();
            box.innerHTML = `<div class='text-sm text-gray-300'>${data.html_response}</div>`;
        } catch (e) { box.innerHTML = "Erreur IA"; }
    }

    // --- SCAN GLOBAL ---
    async function runGlobalScan(query) {
        if (!query) return;
        const scanBox = document.getElementById('res-scan-content');
        const nicheBox = document.getElementById('res-niche-content');
        const vodBox = document.getElementById('res-vod-content');

        scanBox.innerHTML = "Chargement...";
        try {
            const res = await fetch(`${API_BASE}/scan_target`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ query })
            });
            const data = await res.json();
            
            if (data.success) {
                const u = data.user_data || data.game_data;
                scanBox.innerHTML = `<div class='niche-score-value'>${u.ai_calculated_niche_score || '7.0'}</div><p>${u.display_name || u.name}</p>`;
                runAI('niche', query, nicheBox);
                runAI('repurpose', query, vodBox);
            }
        } catch (e) { scanBox.innerHTML = "Erreur Scan"; }
    }

    // --- RAID & BOOST ---
    async function startRaidSearch() {
        const game = document.getElementById('input-raid-game').value;
        const resBox = document.getElementById('raid-results');
        resBox.innerHTML = "Recherche de petite cha√Æne...";
        const res = await fetch(`${API_BASE}/start_raid`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ game, max_viewers: 50 })
        });
        const data = await res.json();
        if (data.success) {
            resBox.innerHTML = `<div class='p-4 bg-black border border-red-600 rounded'>
                Cible : <strong>${data.target.name}</strong> (${data.target.viewers} v)<br>
                <button onclick="launchPlayer('${data.target.login}')" class='mt-2 bg-red-600 px-4 py-1 rounded'>RAIDER</button>
            </div>`;
        }
    }

    async function activateBoost() {
        const channel = document.getElementById('input-boost').value;
        const res = await fetch(`${API_BASE}/stream_boost`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ channel })
        });
        const data = await res.json();
        document.getElementById('boost-results').innerHTML = data.html_response;
    }

    window.onload = () => {
        // Lancer un stream micro-niche au d√©marrage
        fetch(`${API_BASE}/get_default_stream`).then(r => r.json()).then(d => launchPlayer(d.channel));
    };
</script>
</body>
</html>
