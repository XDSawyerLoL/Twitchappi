<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Twitch Streaming Suite - Futuristic Edition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Production Tailwind (precompiled) -->
<link href="https://unpkg.com/tailwindcss@^3/dist/tailwind.min.css" rel="stylesheet">

<style>
:root{
  --neon-blue:#22c7ef;
  --neon-pink:#ff0099;
}

/* Futuristic Neon */
*{transition:all .12s ease-out!important;}
.neon{
  box-shadow:0 0 10px var(--neon-blue),0 0 20px var(--neon-blue);
}
.neon:hover{
  box-shadow:0 0 20px var(--neon-pink),0 0 40px var(--neon-pink);
  transform:translateY(-3px);
}

/* Loader IA */
.ai-loader{
  width:42px;height:42px;
  border-radius:50%;
  border:4px solid var(--neon-blue);
  border-top-color:transparent;
  animation:spin .7s linear infinite, neonPulse 1.3s ease-in-out infinite;
  margin:18px auto;
}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes neonPulse{
  0%{box-shadow:0 0 6px var(--neon-blue);}
  50%{box-shadow:0 0 20px var(--neon-pink);}
  100%{box-shadow:0 0 6px var(--neon-blue);}
}

/* Panels glass */
.panel{
  backdrop-filter:blur(8px);
  -webkit-backdrop-filter:blur(8px);
  background:rgba(255,255,255,0.06);
  border:1px solid rgba(255,255,255,0.08);
  border-radius:14px;
  padding:20px;
}

/* Buttons */
.btn-primary{
  padding:10px 15px;
  border-radius:8px;
  font-weight:700;
  background:var(--neon-blue);
  color:black;
}
.btn-primary:hover{background:var(--neon-pink);color:white;}

.btn-secondary{
  padding: 8px 12px;
  border-radius:8px;
  font-weight:700;
  background:#1b1f24;
  color:white;
}
</style>
</head>

<body class="bg-[#0e1116] text-white">

<!-- ===================== NAV ===================== -->
<header class="p-4 flex justify-between items-center border-b border-gray-700">
  <h1 class="text-2xl font-bold neon p-3 rounded-lg">üéõÔ∏è JustPlayer Stream Hub ‚Äî Futuristic Edition</h1>
  <button id="btn-logout" class="btn-secondary">D√©connexion</button>
</header>

<div class="p-4 grid grid-cols-1 lg:grid-cols-2 gap-4">

<!-- ===================== PLAYER SECTION ===================== -->
<div class="panel">
  <h2 class="text-xl font-bold mb-3">üé• Player Twitch + Chat</h2>

  <div id="player-channel-status" class="mb-2 text-lg">Aucun channel s√©lectionn√©.</div>

  <div id="twitch-embed" class="rounded-lg overflow-hidden" style="height:550px;"></div>

  <div class="mt-4">
    <label class="font-bold">Chaine Twitch :</label>
    <input id="channel-input" class="text-black px-2 py-1 rounded" placeholder="nomduchannel">
    <button id="btn-load-channel" class="btn-primary neon ml-2">Charger</button>
  </div>
</div>

<!-- ===================== IA PANEL ===================== -->
<div class="panel">
  <h2 class="text-xl font-bold mb-3">ü§ñ IA Streaming Tools</h2>

  <!-- Scan Target -->
  <form id="form-target" class="mb-6">
    <label class="font-bold">Streamer √† analyser :</label>
    <input id="target-streamer" class="text-black px-2 py-1 rounded w-full" placeholder="ex: zerator">
    <button class="btn-primary neon w-full mt-2">üîç Scan IA</button>
  </form>

  <div id="target-result" class="mb-6"></div>

  <!-- Niche Analysis -->
  <form id="form-niche-analysis" class="mb-6">
    <label class="font-bold">Analyse ta niche :</label>
    <textarea id="niche-description" class="text-black px-2 py-1 rounded w-full" rows="4" placeholder="D√©cris ton contenu..."></textarea>
    <button class="btn-primary neon w-full mt-2">üìä Analyse IA</button>
  </form>

  <div id="niche-results" class="mb-6"></div>

  <!-- Repurpose -->
  <form id="form-repurpose" class="mb-6">
    <label class="font-bold">Transformer ton contenu :</label>
    <textarea id="repurpose-input" class="text-black px-2 py-1 rounded w-full" rows="4" placeholder="Colle ton texte..."></textarea>
    <button class="btn-primary neon w-full mt-2">‚ôªÔ∏è Repurposer</button>
  </form>

  <div id="repurpose-results" class="mb-6"></div>

  <!-- Trend Detector -->
  <button id="btn-trend-detector" class="btn-primary neon w-full">üìà D√©tecter Trends Twitch</button>

  <div id="trend-results" class="mt-4"></div>

</div>
</div>

<!-- Script Twitch -->
<script src="https://embed.twitch.tv/embed/v1.js"></script>

<script>
// ======================= CONFIG ===========================
const API_BASE = ""; // Render auto-resolve

let embed = null;

// ======================= PLAYER ===========================
function launchPlayer(channel){
    if(embed){
      document.getElementById("twitch-embed").innerHTML = "";
    }

    embed = new Twitch.Embed("twitch-embed", {
      width:"100%",
      height:550,
      channel:channel,
      layout:"video-and-chat",
      autoplay:false, // IMPORTANT
      parent:[
        window.location.hostname,
        "localhost",
        "127.0.0.1"
      ]
    });

    localStorage.setItem("activeChannel", channel);

    document.getElementById("player-channel-status").innerText =
      "Chargement du player pour " + channel + "‚Ä¶";
}

// Load Channel Btn
document.getElementById("btn-load-channel").addEventListener("click", ()=>{
  const ch = document.getElementById("channel-input").value.trim();
  if(!ch) return;
  launchPlayer(ch);
});

// ======================= LIVE PING (Polling render-friendly) ===========================
setInterval(async ()=>{
  const channel = localStorage.getItem("activeChannel");
  if(!channel) return;

  try{
    const r = await fetch(`/live_ping?channel=${encodeURIComponent(channel)}`);
    if(!r.ok) return;
    const d = await r.json();

    const el = document.getElementById("player-channel-status");
    if(d.live){
      el.innerText = `üî¥ EN LIVE ‚Äî ${channel.toUpperCase()}`;
      el.style.color = "#ff0099";
    } else {
      el.innerText = `‚ö´ Offline ‚Äî ${channel.toUpperCase()}`;
      el.style.color = "#9aa3a8";
    }
  }catch(e){}
},2000);


// ======================= IA FORMS ===========================
document.getElementById("form-target").addEventListener("submit", async(e)=>{
  e.preventDefault();
  const v = document.getElementById("target-streamer").value.trim();
  if(!v) return;

  const box = document.getElementById("target-result");
  box.innerHTML = `<div class="ai-loader"></div><p class="text-center mt-2">Analyse en cours‚Ä¶</p>`;

  const r = await fetch(`/critique_ia?target=${encodeURIComponent(v)}`);
  box.innerHTML = await r.text();
});


document.getElementById("form-niche-analysis").addEventListener("submit", async(e)=>{
  e.preventDefault();
  const v = document.getElementById("niche-description").value.trim();
  if(!v) return;

  const box = document.getElementById("niche-results");
  box.innerHTML = `<div class="ai-loader"></div>`;

  const r = await fetch(`/niche_analyse?text=${encodeURIComponent(v)}`);
  box.innerHTML = await r.text();
});


document.getElementById("form-repurpose").addEventListener("submit", async(e)=>{
  e.preventDefault();

  const v = document.getElementById("repurpose-input").value.trim();
  if(!v) return;

  const box = document.getElementById("repurpose-results");
  box.innerHTML = `<div class="ai-loader"></div>`;

  const r = await fetch(`/repurpose?text=${encodeURIComponent(v)}`);
  box.innerHTML = await r.text();
});


document.getElementById("btn-trend-detector").addEventListener("click", async()=>{
  const box = document.getElementById("trend-results");
  box.innerHTML = `<div class="ai-loader"></div>`;

  const r = await fetch(`/trend_detector`);
  box.innerHTML = await r.text();
});


// ======================= LOGOUT ===========================
document.getElementById("btn-logout").addEventListener("click",()=>{
  localStorage.removeItem("token");
  window.location.href = "/";
});

</script>
</body>
</html>
