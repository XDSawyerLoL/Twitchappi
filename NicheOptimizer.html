<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Vos metas et styles existants restent identiques -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Streamer Niche AI Hub - Ultimate Cockpit Dashboard">
    <title>Streamer Niche AI Hub - COCKPIT MASTER V37 UNCOMPRESSED</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://embed.twitch.tv/embed/v1.js"></script>
    
    <style>
        /* Vos styles CSS existants restent identiques */
        :root {
            --color-bg-dark: #0d0d0d;
            --color-bg-medium: #1a1a1a;
            --color-bg-light: #111;
            --color-primary-pink: #ff0099;
            --color-secondary-blue: #22c7ef;
            --color-time-gold: #ffd700;
            --color-ai-niche: #59d682;
            --color-ai-repurpose: #9933ff;
            --color-ai-growth: #ffcc00;
            --color-ai-action: #e34a64;
            --color-text-dimmed: #9aa3a8;
            --color-border-dark: #2e2e2e;
            --color-border-medium: #333;
            --shadow-pink: 0 0 15px rgba(255, 0, 153, 0.4);
            --shadow-blue: 0 0 15px rgba(34, 199, 239, 0.4);
            --shadow-action: 0 0 15px rgba(227, 74, 100, 0.4);
        }

        /* NOUVEAUX STYLES POUR LE TCHAT */
        .player-layout-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            background: var(--color-bg-light);
            padding: 8px;
            border-radius: 8px;
            border: 1px solid var(--color-border-medium);
        }
        .layout-btn {
            flex: 1;
            padding: 8px 12px;
            background: var(--color-bg-dark);
            color: var(--color-text-dimmed);
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
        }
        .layout-btn:hover {
            color: #fff;
            background: #232323;
        }
        .layout-btn.active {
            background: var(--color-secondary-blue);
            color: #fff;
            box-shadow: var(--shadow-blue);
        }
        .layout-btn.chat-only {
            background: var(--color-ai-niche) !important;
            box-shadow: 0 0 10px rgba(89, 214, 130, 0.4) !important;
        }

        /* Conteneurs séparés pour vidéo et chat */
        #twitch-video, #twitch-chat {
            width: 100%;
            height: 550px;
            border-radius: 8px;
            overflow: hidden;
            background: #000;
            border: 1px solid #222;
            display: none;
        }
        #twitch-video.active, #twitch-chat.active {
            display: block;
        }

        /* Vos autres styles restent identiques */
        body { background-color: var(--color-bg-dark); color: #fff; font-family: Inter, Arial, sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        /* ... reste de vos styles ... */
    </style>
</head>
<body>
    <div id="twitch-lucky-main">
        <!-- Vos onglets principaux existants -->
        <h1 class="text-3xl"><span class="h1-blue-accent">STREAMER</span> HUB V37 <span style="font-size:14px; vertical-align:middle; background:#222; padding:2px 6px; border-radius:4px;">MASTER</span></h1>
        <div class="subtitle-center">Cockpit Unifié - Données Réelles - Intelligence Artificielle - Rotation 3min</div>

        <!-- ZONE LECTEUR MODIFIÉE -->
        <div class="player-wrapper">
            <div class="player-header">
                <h2 class="player-title">
                    <span style="margin-right:8px;"><i class="fab fa-twitch"></i></span>
                    LECTEUR
                    <span id="player-channel-status" style="font-size:12px; color:#888; margin-left:15px; font-weight:normal;">En attente de connexion...</span>
                </h2>
                
                <!-- NOUVEAUX BOUTONS TCHAT -->
                <div class="player-layout-tabs">
                    <button class="layout-btn active" data-layout="video" onclick="switchPlayerLayout('video')">
                        <i class="fas fa-play mr-1"></i> Vidéo
                    </button>
                    <button class="layout-btn" data-layout="video-chat" onclick="switchPlayerLayout('video-chat')">
                        <i class="fas fa-comments mr-1"></i> Vidéo+Chat
                    </button>
                    <button class="layout-btn" data-layout="chat" onclick="switchPlayerLayout('chat')">
                        <i class="fas fa-comments mr-2"></i> Tchat
                    </button>
                </div>

                <div class="flex gap-2 items-center">
                    <button id="btn-prev-stream" class="btn-cycle" onclick="cycleStream('prev')" disabled title="Chaîne précédente">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <button id="btn-next-stream" class="btn-cycle" onclick="cycleStream('next')" disabled title="Chaîne suivante">
                        <i class="fas fa-arrow-right"></i>
                    </button>
                    <form id="mini-player-form" class="flex gap-2" onsubmit="event.preventDefault(); launchPlayer(document.getElementById('input-channel').value)">
                        <input id="input-channel" type="text" placeholder="Chaîne..." class="player-quick-input">
                        <button type="submit" class="btn-primary" style="padding: 5px 15px;">GO</button>
                    </form>
                </div>
            </div>

            <!-- NOUVEAUX CONTENEURS SÉPARÉS -->
            <div id="twitch-video" class="active"></div>
            <div id="twitch-video-chat"></div>
            <div id="twitch-chat"></div>
        </div>

        <!-- Reste de votre contenu existant (onglets dashboard, etc.) -->
        <div id="content-area">
            <!-- Vos onglets tab-followed, tab-dashboard, etc. restent identiques -->
        </div>
    </div>

    <script>
        // NOUVELLES VARIABLES GLOBALES
        let videoEmbed = null;
        let chatEmbed = null;
        let videoChatEmbed = null;
        let currentLayout = localStorage.getItem('playerLayout') || 'video-chat';

        // VOTRE FONCTION launchPlayer MODIFIÉE
        window.launchPlayer = function(channelName, videoId = null) {
            // Anti-reload si même contenu
            if (videoEmbed && !videoId && videoEmbed.getChannel() === channelName) return;
            if (videoChatEmbed && !videoId && videoChatEmbed.getChannel() === channelName) return;

            document.getElementById('input-channel').value = channelName;
            document.getElementById('player-channel-status').innerText = `Chargement ${channelName}...`;

            const parents = ['localhost', '127.0.0.1', 'justplayer.fr', 'justplayerstreamhubpro.onrender.com', window.location.hostname];
            const config = {
                width: '100%',
                height: '100%',
                parent: parents
            };

            if (videoId) {
                config.video = videoId;
            } else {
                config.channel = channelName;
            }

            // Initialisation des 3 embeds
            if (!videoEmbed) {
                videoEmbed = new Twitch.Embed('twitch-video', { ...config, layout: 'video' });
            } else {
                videoId ? videoEmbed.setVideo(videoId) : videoEmbed.setChannel(channelName);
            }

            if (!videoChatEmbed) {
                videoChatEmbed = new Twitch.Embed('twitch-video-chat', { ...config, layout: 'video-with-chat' });
            } else {
                videoId ? videoChatEmbed.setVideo(videoId) : videoChatEmbed.setChannel(channelName);
            }

            if (!chatEmbed) {
                chatEmbed = new Twitch.Embed('twitch-chat', { ...config, layout: 'chat-only' });
            } else {
                videoId ? chatEmbed.setVideo(videoId) : chatEmbed.setChannel(channelName);
            }

            // Applique le layout actuel
            switchPlayerLayout(currentLayout);

            document.getElementById('player-channel-status').innerText = `En direct: ${channelName}`;
        };

        // NOUVELLE FONCTION BASCULER LAYOUT
        function switchPlayerLayout(layout) {
            currentLayout = layout;
            localStorage.setItem('playerLayout', layout);

            // Met à jour les boutons
            document.querySelectorAll('.layout-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.layout === layout) {
                    btn.classList.add('active');
                    if (layout === 'chat') btn.classList.add('chat-only');
                } else {
                    btn.classList.remove('chat-only');
                }
            });

            // Affiche/masque les conteneurs
            document.getElementById('twitch-video').classList.toggle('active', layout === 'video');
            document.getElementById('twitch-video-chat').classList.toggle('active', layout === 'video-chat');
            document.getElementById('twitch-chat').classList.toggle('active', layout === 'chat');
        }

        // Restauration du layout au chargement
        document.addEventListener('DOMContentLoaded', () => {
            switchPlayerLayout(currentLayout);
        });

        // VOS AUTRES FONCTIONS RESTENT IDENTIQUES
        // (checkBoostAndPlay, cycleStream, openTab, etc.)
        const APIBASE = window.location.origin;
        const DEFAULTCHANNEL = 'twitch';
        const AUTOCYCLEDURATIONMS = 3 * 60 * 1000; // 3 MINUTES
        let autoCycleTimer = null;
        let boostTimeout = null;
        let isConnected = false;

        // ... reste de votre code JavaScript existant ...
    </script>
</body>
</html>
