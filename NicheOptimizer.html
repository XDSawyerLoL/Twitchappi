<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Niche Optimizer - Twitch AI Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #9146ff;
            --primary-dark: #772ce8;
            --secondary: #18181b;
            --surface: #0e0e10;
            --text: #efeff1;
            --text-secondary: #adadb8;
            --success: #31a24c;
            --error: #e74c3c;
            --warning: #f39c12;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--surface);
            color: var(--text);
            line-height: 1.6;
        }

        /* ==================== HEADER ==================== */
        header {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--primary) 100%);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            box-shadow: 0 4px 20px rgba(145, 70, 255, 0.3);
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            text-align: right;
            font-size: 0.9rem;
        }

        .user-name {
            font-weight: bold;
            color: var(--primary);
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(145, 70, 255, 0.4);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--text);
            border: 1px solid var(--primary);
        }

        .btn-secondary:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-danger {
            background-color: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        /* ==================== CONTAINER ==================== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .card {
            background-color: var(--secondary);
            border: 1px solid rgba(145, 70, 255, 0.2);
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(145, 70, 255, 0.2);
            transform: translateY(-4px);
        }

        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: var(--primary);
        }

        .card-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        /* ==================== TABS ==================== */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid rgba(145, 70, 255, 0.2);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 0.8rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            position: relative;
            bottom: -2px;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-btn:hover {
            color: var(--text);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ==================== FORM ==================== */
        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
        }

        input, textarea, select {
            width: 100%;
            padding: 0.8rem;
            background-color: var(--surface);
            color: var(--text);
            border: 1px solid rgba(145, 70, 255, 0.3);
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(145, 70, 255, 0.3);
        }

        /* ==================== LOADING & ALERTS ==================== */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(145, 70, 255, 0.3);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .alert {
            padding: 1rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            border-left: 4px solid;
        }

        .alert-success {
            background-color: rgba(49, 162, 76, 0.2);
            color: var(--success);
            border-left-color: var(--success);
        }

        .alert-error {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--error);
            border-left-color: var(--error);
        }

        .alert-info {
            background-color: rgba(145, 70, 255, 0.2);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        /* ==================== STATS GRID ==================== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: var(--secondary);
            border: 1px solid rgba(145, 70, 255, 0.2);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
        }

        /* ==================== CHAT/LIST ==================== */
        .chat-container {
            background-color: var(--secondary);
            border: 1px solid rgba(145, 70, 255, 0.2);
            border-radius: 10px;
            padding: 1.5rem;
            height: 500px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.8rem;
            background-color: rgba(145, 70, 255, 0.1);
            border-left: 3px solid var(--primary);
            border-radius: 4px;
        }

        .message-author {
            font-weight: bold;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .message-text {
            margin-top: 0.3rem;
            color: var(--text);
        }

        /* ==================== STREAM CARD ==================== */
        .stream-card {
            background-color: var(--secondary);
            border: 1px solid rgba(145, 70, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stream-card:hover {
            border-color: var(--primary);
            box-shadow: 0 8px 25px rgba(145, 70, 255, 0.2);
        }

        .stream-thumbnail {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: var(--surface);
        }

        .stream-info {
            padding: 1rem;
        }

        .stream-title {
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stream-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* ==================== FOOTER ==================== */
        footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            border-top: 1px solid rgba(145, 70, 255, 0.2);
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            header {
                flex-direction: column;
                gap: 1rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .stat-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- ==================== HEADER ==================== -->
    <header>
        <div class="logo">
            üéÆ Niche Optimizer
        </div>
        <div class="user-section">
            <div class="user-info" id="userInfo" style="display: none;">
                <div>Bienvenue</div>
                <div class="user-name" id="userName"></div>
            </div>
            <button class="btn btn-primary" id="loginBtn" onclick="loginTwitch()">Se connecter Twitch</button>
            <button class="btn btn-danger" id="logoutBtn" onclick="logoutTwitch()" style="display: none;">D√©connexion</button>
        </div>
    </header>

    <!-- ==================== MAIN CONTENT ==================== -->
    <div class="container">
        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="tab-btn" onclick="switchTab('scanner')">üîç Scanner</button>
            <button class="tab-btn" onclick="switchTab('raid')">‚ö° Raid</button>
            <button class="tab-btn" onclick="switchTab('planning')">üìÖ Planning</button>
            <button class="tab-btn" onclick="switchTab('chat')">üí¨ Chat Hub</button>
        </div>

        <!-- ==================== TAB: DASHBOARD ==================== -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 2rem; color: var(--primary);">üìä Statistiques Globales</h2>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="card-subtitle">Total Viewers</div>
                    <div class="stat-value" id="totalViewers">0</div>
                    <div class="card-subtitle">Estimation</div>
                </div>
                <div class="stat-card">
                    <div class="card-subtitle">Canaux Actifs</div>
                    <div class="stat-value" id="totalChannels">0</div>
                </div>
                <div class="stat-card">
                    <div class="card-subtitle">Top Game</div>
                    <div style="color: var(--primary); margin-top: 0.5rem;" id="topGame">N/A</div>
                </div>
            </div>

            <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--primary);">Top Jeux</h3>
            <div class="grid" id="topGamesContainer">
                <!-- Sera rempli par JS -->
            </div>

            <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--primary);">Langues Populaires</h3>
            <div class="grid" id="languagesContainer">
                <!-- Sera rempli par JS -->
            </div>

            <h3 style="margin-top: 2rem; margin-bottom: 1rem; color: var(--primary);">Stream par D√©faut</h3>
            <div class="card">
                <div id="defaultStreamInfo">Chargement...</div>
                <button class="btn btn-secondary" onclick="cycleStream('prev')" style="margin-top: 1rem;">‚Üê Pr√©c√©dent</button>
                <button class="btn btn-secondary" onclick="cycleStream('next')" style="margin-top: 1rem; margin-left: 0.5rem;">Suivant ‚Üí</button>
            </div>
        </div>

        <!-- ==================== TAB: SCANNER ==================== -->
        <div id="scanner" class="tab-content">
            <h2 style="margin-bottom: 2rem; color: var(--primary);">üîç Scanner Twitch</h2>

            <div class="grid">
                <div class="card">
                    <div class="card-title">Rechercher un Streamer</div>
                    <div class="form-group">
                        <label>Nom du Streamer ou Jeu</label>
                        <input type="text" id="scanQuery" placeholder="ex: Kamet0, League of Legends...">
                    </div>
                    <button class="btn btn-primary" onclick="scanTarget()">Scanner</button>
                    <div id="scanLoading" style="display: none; margin-top: 1rem;">
                        <div class="loading"></div> Analyse en cours...
                    </div>
                </div>
            </div>

            <div id="scanResults" style="margin-top: 2rem;">
                <!-- R√©sultats du scanner -->
            </div>

            <div id="iaResults" style="margin-top: 2rem;">
                <!-- R√©sultats IA -->
            </div>
        </div>

        <!-- ==================== TAB: RAID ==================== -->
        <div id="raid" class="tab-content">
            <h2 style="margin-bottom: 2rem; color: var(--primary);">‚ö° Raid Builder</h2>

            <div class="grid">
                <div class="card">
                    <div class="card-title">Configurer le Raid</div>
                    <div class="form-group">
                        <label>Jeu √† Raider</label>
                        <input type="text" id="raidGame" placeholder="ex: League of Legends, Valorant...">
                    </div>
                    <div class="form-group">
                        <label>Viewers Max √† Cibler</label>
                        <input type="number" id="maxViewers" placeholder="ex: 100" value="100">
                    </div>
                    <button class="btn btn-primary" onclick="startRaid()">üöÄ Lancer Raid</button>
                    <div id="raidLoading" style="display: none; margin-top: 1rem;">
                        <div class="loading"></div> Recherche de cible...
                    </div>
                </div>
            </div>

            <div id="raidResults" style="margin-top: 2rem;">
                <!-- R√©sultats du raid -->
            </div>
        </div>

        <!-- ==================== TAB: PLANNING ==================== -->
        <div id="planning" class="tab-content">
            <h2 style="margin-bottom: 2rem; color: var(--primary);">üìÖ Planning Optimal</h2>

            <div class="grid">
                <div class="card">
                    <div class="card-title">Analyser Planning</div>
                    <div class="form-group">
                        <label>Jeu √† Analyser</label>
                        <input type="text" id="planningGame" placeholder="ex: Elden Ring, Fortnite...">
                    </div>
                    <button class="btn btn-primary" onclick="analyzeSchedule()">üìä Analyser</button>
                    <div id="planningLoading" style="display: none; margin-top: 1rem;">
                        <div class="loading"></div> Analyse en cours...
                    </div>
                </div>
            </div>

            <div id="planningResults" style="margin-top: 2rem;">
                <!-- R√©sultats du planning -->
            </div>
        </div>

        <!-- ==================== TAB: CHAT HUB ==================== -->
        <div id="chat" class="tab-content">
            <h2 style="margin-bottom: 2rem; color: var(--primary);">üí¨ Chat Hub Community</h2>

            <div class="card">
                <div class="chat-container">
                    <div class="chat-messages" id="chatMessages">
                        <div class="message">
                            <div class="message-author">ü§ñ Syst√®me</div>
                            <div class="message-text">Bienvenue dans le Chat Hub ! Partagez vos strat√©gies et tips.</div>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <input type="text" id="chatInput" placeholder="√âcrivez votre message..." onkeypress="handleChatKey(event)">
                        <button class="btn btn-primary" onclick="sendChatMessage()" style="margin-top: 0.5rem; width: 100%;">Envoyer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== FOOTER ==================== -->
    <footer>
        <p>üéÆ Niche Optimizer v50 - Powered by Twitch API & Gemini AI</p>
        <p>¬© 2025 - Tous droits r√©serv√©s</p>
    </footer>

    <!-- ==================== SCRIPTS ==================== -->
    <script>
        // ==================== CONFIG ==================== 
        const API_BASE = window.location.origin;
        const CHAT_MESSAGES = [];

        // ==================== INIT ==================== 
        document.addEventListener('DOMContentLoaded', () => {
            checkUserStatus();
            loadDashboard();
            setInterval(loadDashboard, 5 * 60 * 1000); // Refresh toutes les 5 min
        });

        // ==================== AUTH ==================== 
        async function loginTwitch() {
            const popup = window.open(`${API_BASE}/twitch_auth_start`, 'twitch_auth', 'width=500,height=600');
            
            // V√©rifier la connexion toutes les 500ms
            const checkLogin = setInterval(async () => {
                if (popup && popup.closed) {
                    clearInterval(checkLogin);
                    await new Promise(r => setTimeout(r, 500));
                    checkUserStatus();
                }
            }, 500);
        }

        async function logoutTwitch() {
            const res = await fetch(`${API_BASE}/twitch_logout`, { method: 'POST' });
            if (res.ok) {
                checkUserStatus();
                location.reload(); // Rafra√Æchir la page
            }
        }

        async function checkUserStatus() {
            try {
                const res = await fetch(`${API_BASE}/twitch_user_status`);
                const data = await res.json();

                if (data.is_connected) {
                    document.getElementById('userInfo').style.display = 'block';
                    document.getElementById('userName').textContent = data.display_name;
                    document.getElementById('loginBtn').style.display = 'none';
                    document.getElementById('logoutBtn').style.display = 'block';
                } else {
                    document.getElementById('userInfo').style.display = 'none';
                    document.getElementById('loginBtn').style.display = 'block';
                    document.getElementById('logoutBtn').style.display = 'none';
                }
            } catch (e) {
                console.error('Erreur check status:', e);
            }
        }

        // ==================== TABS ==================== 
        function switchTab(tabName) {
            // Masquer tous les tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // D√©sactiver tous les boutons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Afficher le tab s√©lectionn√©
            document.getElementById(tabName).classList.add('active');

            // Activer le bouton
            event.target.classList.add('active');
        }

        // ==================== DASHBOARD ==================== 
        async function loadDashboard() {
            try {
                // Stats Global
                const statsRes = await fetch(`${API_BASE}/api/stats/global`);
                const stats = await statsRes.json();

                if (stats.success) {
                    document.getElementById('totalViewers').textContent = stats.total_viewers.toLocaleString();
                    document.getElementById('totalChannels').textContent = stats.total_channels;
                    document.getElementById('topGame').textContent = stats.top_game_name || 'N/A';
                }

                // Top Games
                const gamesRes = await fetch(`${API_BASE}/api/stats/top_games`);
                const games = await gamesRes.json();

                const gamesContainer = document.getElementById('topGamesContainer');
                gamesContainer.innerHTML = '';
                games.games.slice(0, 5).forEach(game => {
                    gamesContainer.innerHTML += `
                        <div class="stream-card">
                            <img src="${game.box_art_url}" alt="${game.name}" class="stream-thumbnail">
                            <div class="stream-info">
                                <div class="stream-title">${game.name}</div>
                            </div>
                        </div>
                    `;
                });

                // Languages
                const langRes = await fetch(`${API_BASE}/api/stats/languages`);
                const langs = await langRes.json();

                const langsContainer = document.getElementById('languagesContainer');
                langsContainer.innerHTML = '';
                langs.languages.forEach(lang => {
                    langsContainer.innerHTML += `
                        <div class="stat-card">
                            <div class="card-subtitle">${lang.name}</div>
                            <div class="stat-value">${lang.percent}</div>
                        </div>
                    `;
                });

                // Default Stream
                const streamRes = await fetch(`${API_BASE}/get_default_stream`);
                const stream = await streamRes.json();

                if (stream.success) {
                    document.getElementById('defaultStreamInfo').innerHTML = `
                        <div><strong>Canal:</strong> ${stream.channel}</div>
                        <div><strong>Mode:</strong> ${stream.mode}</div>
                        <div><strong>Viewers:</strong> ${stream.viewers || 'N/A'}</div>
                        <div style="color: var(--success); margin-top: 0.5rem;">${stream.message || ''}</div>
                    `;
                }
            } catch (e) {
                console.error('Erreur dashboard:', e);
            }
        }

        async function cycleStream(direction) {
            try {
                const res = await fetch(`${API_BASE}/cycle_stream`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ direction })
                });
                const data = await res.json();
                if (data.success) {
                    loadDashboard();
                }
            } catch (e) {
                console.error('Erreur cycle:', e);
            }
        }

        // ==================== SCANNER ==================== 
        async function scanTarget() {
            const query = document.getElementById('scanQuery').value;
            if (!query) {
                alert('Entrez un nom de streamer ou jeu');
                return;
            }

            document.getElementById('scanLoading').style.display = 'block';
            document.getElementById('scanResults').innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/scan_target`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });
                const data = await res.json();

                document.getElementById('scanLoading').style.display = 'none';

                if (data.success) {
                    let html = '';
                    if (data.type === 'user') {
                        const user = data.user_data;
                        html = `
                            <div class="card">
                                <h3>${user.display_name}</h3>
                                <img src="${user.profile_image_url}" style="width: 80px; height: 80px; border-radius: 50%; margin: 1rem 0;">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <p><strong>Login:</strong> ${user.login}</p>
                                    <p><strong>Bio:</strong> ${user.description}</p>
                                    <p><strong>Cr√©√©:</strong> ${user.created_at}</p>
                                    <p><strong>Jeu:</strong> ${user.game_name}</p>
                                    <p><strong>Titre:</strong> ${user.title}</p>
                                    <p><strong>Tags:</strong> ${user.tags}</p>
                                    <p><strong>Langue:</strong> ${user.language}</p>
                                    <p><strong>Views:</strong> ${user.view_count}</p>
                                    <p><strong>En direct:</strong> ${user.is_live ? '‚úÖ OUI' : '‚ùå NON'}</p>
                                    <p><strong>Viewers:</strong> ${user.viewer_count}</p>
                                    <p><strong>Score Niche:</strong> <span style="color: var(--success);">${user.ai_calculated_niche_score}</span></p>
                                </div>
                            </div>
                        `;
                    } else if (data.type === 'game') {
                        const game = data.game_data;
                        html = `
                            <div class="card">
                                <h3>${game.name}</h3>
                                <img src="${game.box_art_url}" style="width: 120px; height: 160px; margin: 1rem 0; border-radius: 6px;">
                                <div class="form-group" style="margin-bottom: 0;">
                                    <p><strong>Total Viewers:</strong> ${game.total_viewers.toLocaleString()}</p>
                                    <p><strong>Score Niche:</strong> <span style="color: var(--success);">${game.ai_calculated_niche_score}/5</span></p>
                                </div>
                            </div>
                        `;
                    }
                    document.getElementById('scanResults').innerHTML = html;

                    // Critique IA
                    const critRes = await fetch(`${API_BASE}/critique_ia`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type: 'niche', query })
                    });
                    const critData = await critRes.json();
                    if (critData.success) {
                        document.getElementById('iaResults').innerHTML = `
                            <div class="card">
                                <div class="card-title">Critique IA</div>
                                <div>${critData.html_response}</div>
                            </div>
                        `;
                    }
                } else {
                    document.getElementById('scanResults').innerHTML = '<div class="alert alert-error">‚ùå Pas de r√©sultats trouv√©s</div>';
                }
            } catch (e) {
                console.error('Erreur scan:', e);
                document.getElementById('scanLoading').style.display = 'none';
                document.getElementById('scanResults').innerHTML = '<div class="alert alert-error">‚ùå Erreur serveur</div>';
            }
        }

        // ==================== RAID ==================== 
        async function startRaid() {
            const game = document.getElementById('raidGame').value;
            const maxViewers = document.getElementById('maxViewers').value;

            if (!game) {
                alert('Entrez un jeu');
                return;
            }

            document.getElementById('raidLoading').style.display = 'block';
            document.getElementById('raidResults').innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/start_raid`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ game, max_viewers: maxViewers })
                });
                const data = await res.json();

                document.getElementById('raidLoading').style.display = 'none';

                if (data.success && data.target) {
                    const target = data.target;
                    document.getElementById('raidResults').innerHTML = `
                        <div class="card">
                            <h3>üéØ Cible Raid Trouv√©e!</h3>
                            <img src="${target.thumbnail_url}" style="width: 100%; height: auto; border-radius: 6px; margin: 1rem 0;">
                            <div class="form-group" style="margin-bottom: 0;">
                                <p><strong>Streamer:</strong> ${target.name}</p>
                                <p><strong>Login:</strong> ${target.login}</p>
                                <p><strong>Viewers:</strong> ${target.viewers}</p>
                                <p><strong>Jeu:</strong> ${target.game}</p>
                                <button class="btn btn-primary" onclick="goToTwitch('${target.login}')" style="margin-top: 1rem; width: 100%;">
                                    üéÆ Aller sur Twitch
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    document.getElementById('raidResults').innerHTML = '<div class="alert alert-error">‚ùå Aucune cible trouv√©e</div>';
                }
            } catch (e) {
                console.error('Erreur raid:', e);
                document.getElementById('raidLoading').style.display = 'none';
                document.getElementById('raidResults').innerHTML = '<div class="alert alert-error">‚ùå Erreur serveur</div>';
            }
        }

        function goToTwitch(login) {
            window.open(`https://twitch.tv/${login}`, '_blank');
        }

        // ==================== PLANNING ==================== 
        async function analyzeSchedule() {
            const game = document.getElementById('planningGame').value;
            if (!game) {
                alert('Entrez un jeu');
                return;
            }

            document.getElementById('planningLoading').style.display = 'block';
            document.getElementById('planningResults').innerHTML = '';

            try {
                const res = await fetch(`${API_BASE}/analyze_schedule`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ game })
                });
                const data = await res.json();

                document.getElementById('planningLoading').style.display = 'none';

                if (data.success) {
                    document.getElementById('planningResults').innerHTML = `
                        <div class="card">
                            <div class="card-title">üìä Analyse Planning - ${game}</div>
                            <div>${data.html_response}</div>
                        </div>
                    `;
                } else {
                    document.getElementById('planningResults').innerHTML = '<div class="alert alert-error">‚ùå Erreur analyse</div>';
                }
            } catch (e) {
                console.error('Erreur planning:', e);
                document.getElementById('planningLoading').style.display = 'none';
                document.getElementById('planningResults').innerHTML = '<div class="alert alert-error">‚ùå Erreur serveur</div>';
            }
        }

        // ==================== CHAT HUB ==================== 
        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();

            if (!message) return;

            const messagesDiv = document.getElementById('chatMessages');
            const messageEl = document.createElement('div');
            messageEl.className = 'message';
            messageEl.innerHTML = `
                <div class="message-author">üë§ Vous</div>
                <div class="message-text">${message}</div>
            `;

            messagesDiv.appendChild(messageEl);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
            input.value = '';

            // R√©ponse al√©atoire du syst√®me
            setTimeout(() => {
                const responses = [
                    '‚úÖ Message bien re√ßu!',
                    'üí¨ Merci pour ce partage!',
                    'üéÆ Super strat√©gie!',
                    'üëç D\'accord avec toi!',
                    'üî• Bien vu!'
                ];
                const respEl = document.createElement('div');
                respEl.className = 'message';
                respEl.innerHTML = `
                    <div class="message-author">ü§ñ Hub Bot</div>
                    <div class="message-text">${responses[Math.floor(Math.random() * responses.length)]}</div>
                `;
                messagesDiv.appendChild(respEl);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }, 500);
        }

        function handleChatKey(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }
    </script>
</body>
</html>
