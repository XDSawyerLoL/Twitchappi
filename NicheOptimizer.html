<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Streamer & Niche AI Hub - COCKPIT MODE (V15)</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* --- RESTAURATION DU CSS ORIGINAL --- */
        :root {
            --color-bg-dark: #0d0d0d; --color-bg-medium: #1a1a1a;
            --color-primary-pink: #ff0099; --color-secondary-blue: #22c7ef;
            --shadow-pink: 0 0 15px rgba(255, 0, 153, 0.4);
        }
        body { background-color: var(--color-bg-dark); color: #fff; font-family: 'Inter'; }
        
        /* EFFET ROSE SUR MINIATURES (RESTAURÃ‰) */
        .followed-stream-item {
            border: 2px solid transparent; transition: 0.3s; cursor: pointer; border-radius: 8px; overflow: hidden;
        }
        .followed-stream-item:hover {
            border-color: var(--color-primary-pink);
            box-shadow: var(--shadow-pink);
            transform: translateY(-5px);
        }

        .tab-btn { font-family: 'Orbitron'; padding: 12px; background: #111; color: #888; flex: 1; border-radius: 8px 8px 0 0; }
        .tab-btn.active { background: var(--color-bg-medium); color: #fff; border-top: 3px solid var(--color-primary-pink); box-shadow: var(--shadow-pink); }
        .tab-content { display: none; background: var(--color-bg-medium); padding: 20px; border: 1px solid #333; border-top:none; }
        .tab-content.active { display: block; }
        .dashboard-box { background: #0a0a0a; border: 1px solid #333; padding: 15px; border-top: 2px solid var(--color-secondary-blue); }
    </style>
</head>
<body class="p-4">

<h1 class="text-center font-['Orbitron'] text-3xl text-pink-500 mb-6">JUSTPLAYER HUB <span class="text-blue-400">V15</span></h1>

<div class="max-w-6xl mx-auto">
    <div class="bg-black rounded-xl p-4 border border-gray-800 mb-6 shadow-2xl">
        <div id="twitch-embed" style="height: 500px;"></div>
    </div>

    <div class="flex gap-1">
        <button onclick="openTab('tab-fav')" id="btn-tab-fav" class="tab-btn active">ðŸ”‘ FIL DE SUIVI</button>
        <button onclick="openTab('tab-dash')" id="btn-tab-dash" class="tab-btn">ðŸ“Š DASHBOARD 360Â°</button>
        <button onclick="openTab('tab-raid')" id="btn-tab-raid" class="tab-btn">ðŸ’¥ RAID BUILDER</button>
    </div>

    <div id="tab-fav" class="tab-content active">
        <div id="fav-list" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
    </div>

    <div id="tab-dash" class="tab-content">
        <div class="flex gap-2 mb-4">
            <input id="scan-in" type="text" class="bg-black border p-2 flex-1 rounded" placeholder="Streamer...">
            <button onclick="runScan()" class="bg-blue-600 px-6 rounded font-bold">SCANNER</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="dashboard-box" id="res-info">Profil...</div>
            <div class="dashboard-box" id="res-ai">Analyse IA...</div>
            <div class="dashboard-box" id="res-vod">DerniÃ¨re VOD...</div>
        </div>
    </div>

    <div id="tab-raid" class="tab-content">
        <input id="raid-game" type="text" class="bg-black border p-2 w-full mb-4" placeholder="Jeu pour le raid...">
        <button onclick="findRaid()" class="w-full bg-red-600 py-2 font-bold mb-4">CHERCHER CIBLES</button>
        <div id="raid-list" class="space-y-2"></div>
    </div>
</div>

<script src="https://embed.twitch.tv/embed/v1.js"></script>
<script>
    let player = null;

    // FIX PARENT JUSTPLAYER
    function launchPlayer(channel) {
        document.getElementById('twitch-embed').innerHTML = '';
        player = new Twitch.Embed("twitch-embed", {
            width: "100%", height: "100%", channel: channel,
            parent: ["localhost", window.location.hostname, "justplayer.fr"]
        });
    }

    async function runScan() {
        const query = document.getElementById('scan-in').value;
        const res = await fetch('/scan_target', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({query}) });
        const { data } = await res.json();
        if(data) {
            document.getElementById('res-info').innerHTML = `<img src="${data.profile_image_url}" class="w-20 mx-auto rounded-full"> <p class="text-center font-bold mt-2">${data.display_name}</p>`;
            const aiRes = await fetch('/critique_ia', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({query}) });
            const aiData = await aiRes.json();
            document.getElementById('res-ai').innerHTML = aiData.html_response;
        }
    }

    async function loadFavs() {
        const res = await fetch('/followed_streams');
        const data = await res.json();
        document.getElementById('fav-list').innerHTML = data.streams.map(s => `
            <div class="followed-stream-item" onclick="launchPlayer('${s.user_login}')">
                <img src="${s.thumbnail_url.replace('{width}','320').replace('{height}','180')}">
                <p class="p-2 text-xs font-bold">${s.user_name}</p>
            </div>
        `).join('');
    }

    function openTab(id) {
        document.querySelectorAll('.tab-content, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('btn-' + id).classList.add('active');
        if(id === 'tab-fav') loadFavs();
    }

    window.onload = () => { launchPlayer('twitch'); loadFavs(); };
</script>
</body>
</html>
