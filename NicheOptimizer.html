<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer Hub V47 - ONYX PRO</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://embed.twitch.tv/embed/v1.js"></script>

    <style>
        :root {
            --bg-body: #050507;
            --bg-card: rgba(20, 20, 23, 0.7);
            --border-subtle: rgba(255, 255, 255, 0.06);
            --accent: #6366f1; /* Indigo */
            --accent-glow: rgba(99, 102, 241, 0.15);
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
        }

        body { 
            background-color: var(--bg-body); color: var(--text-main); font-family: 'Inter', sans-serif; 
            height: 100vh; overflow: hidden; display: flex;
            background-image: radial-gradient(circle at 15% 15%, rgba(99, 102, 241, 0.08), transparent 40%),
                              radial-gradient(circle at 85% 85%, rgba(168, 85, 247, 0.08), transparent 40%);
        }

        /* --- SIDEBAR --- */
        .sidebar { width: 80px; height: 100%; border-right: 1px solid var(--border-subtle); display: flex; flex-direction: column; align-items: center; padding-top: 20px; background: rgba(0,0,0,0.2); backdrop-filter: blur(10px); z-index: 50; }
        .nav-item { width: 44px; height: 44px; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); cursor: pointer; transition: 0.3s; margin-bottom: 12px; position: relative; }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--accent); color: #fff; box-shadow: 0 4px 12px var(--accent-glow); }
        .nav-item.active::after { content:''; position: absolute; right: -22px; width: 4px; height: 20px; background: #fff; border-radius: 2px 0 0 2px; }

        /* --- MAIN CONTENT --- */
        .main-content { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        .top-bar { height: 60px; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; justify-content: space-between; padding: 0 30px; background: rgba(5,5,7,0.5); backdrop-filter: blur(10px); }
        .app-title { font-weight: 800; font-size: 14px; letter-spacing: 1px; color: #fff; }
        .status-badge { font-size: 10px; padding: 4px 10px; border-radius: 20px; background: rgba(16, 185, 129, 0.1); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.2); font-weight: 600; }

        .view-container { padding: 30px; overflow-y: auto; height: calc(100% - 60px); display: none; }
        .view-container.active { display: block; animation: fadeUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }

        /* --- GLASS CARDS --- */
        .glass-card { background: var(--bg-card); border: 1px solid var(--border-subtle); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; backdrop-filter: blur(20px); }
        .glass-card::before { content:''; position: absolute; top:0; left:0; width:100%; height:1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent); }

        /* --- SPLIT PLAYER --- */
        .split-player { display: flex; height: 700px; border: 1px solid var(--border-subtle); border-radius: 20px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.5); background: #000; }
        .video-area { flex-grow: 1; position: relative; background: #000; }
        .chat-area { width: 350px; min-width: 350px; background: #0e0e11; border-left: 1px solid #222; display: flex; flex-direction: column; }
        
        .chat-tabs { display: flex; border-bottom: 1px solid #222; background: #131316; }
        .chat-tab { flex: 1; padding: 12px; text-align: center; font-size: 11px; font-weight: 600; color: #666; cursor: pointer; transition: 0.2s; }
        .chat-tab:hover { color: #ccc; }
        .chat-tab.active { color: #fff; background: #1a1a1f; border-bottom: 2px solid var(--accent); }

        #chat-layers { flex-grow: 1; position: relative; }
        .layer { position: absolute; inset: 0; display: none; flex-direction: column; }
        .layer.active { display: flex; }
        
        /* HUB CHAT DESIGN */
        #hub-messages { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px; }
        .hub-msg { font-size: 13px; padding: 8px 12px; border-radius: 8px; background: rgba(255,255,255,0.03); color: #ddd; line-height: 1.4; border-left: 2px solid transparent; }
        .hub-msg.me { border-left-color: var(--accent); background: rgba(99, 102, 241, 0.05); align-self: flex-end; }
        .hub-msg strong { color: #fff; font-weight: 600; font-size: 11px; display: block; margin-bottom: 2px; }
        
        .chat-input-box { padding: 15px; border-top: 1px solid #222; background: #131316; }
        .stylish-input { width: 100%; background: #08080a; border: 1px solid #333; padding: 10px 15px; border-radius: 8px; color: #fff; font-size: 13px; outline: none; transition: 0.3s; }
        .stylish-input:focus { border-color: var(--accent); }

        /* DASHBOARD GRID */
        .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-label { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); margin-bottom: 5px; }
        .stat-value { font-size: 28px; font-weight: 700; color: #fff; }
        
        .btn-action { background: var(--accent); color: white; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600; transition: 0.3s; border: none; cursor: pointer; box-shadow: 0 4px 10px var(--accent-glow); }
        .btn-action:hover { transform: translateY(-2px); box-shadow: 0 8px 20px var(--accent-glow); }

        @keyframes fadeUp { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }
        iframe.full-frame { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div class="sidebar">
        <div class="nav-item active" onclick="switchView('dashboard')"><i class="fas fa-chart-pie"></i></div>
        <div class="nav-item" onclick="switchView('monitor')"><i class="fas fa-desktop"></i></div>
        <div class="nav-item" onclick="switchView('scanner')"><i class="fas fa-radar"></i></div>
        <div class="nav-item" onclick="switchView('tools')"><i class="fas fa-rocket"></i></div>
        <div class="nav-item" style="margin-top:auto;" onclick="loginMock()"><i class="fas fa-user-circle"></i></div>
    </div>

    <div class="main-content">
        <div class="top-bar">
            <div class="app-title">STREAMER <span style="color:var(--accent)">HUB</span> PRO</div>
            <div class="flex items-center gap-4">
                <span id="system-status" class="status-badge">SYSTEM ONLINE</span>
                <span id="user-display" class="text-xs font-bold text-gray-400">Invité</span>
            </div>
        </div>

        <div id="view-dashboard" class="view-container active">
            <div class="stats-grid">
                <div class="glass-card"><div class="stat-label">Total Views</div><div class="stat-value">1.4M</div></div>
                <div class="glass-card"><div class="stat-label">Followers</div><div class="stat-value">12.5K</div></div>
                <div class="glass-card"><div class="stat-label">Subscribers</div><div class="stat-value text-indigo-400">842</div></div>
                <div class="glass-card"><div class="stat-label">Hype Train</div><div class="stat-value text-green-400">LVL 5</div></div>
            </div>
            <div class="grid grid-cols-2 gap-6 h-96">
                <div class="glass-card flex flex-col"><div class="stat-label mb-4">Croissance Audience</div><canvas id="chart1" class="flex-grow"></canvas></div>
                <div class="glass-card flex flex-col"><div class="stat-label mb-4">Répartition Catégories</div><canvas id="chart2" class="flex-grow"></canvas></div>
            </div>
        </div>

        <div id="view-monitor" class="view-container">
            <div class="flex justify-between mb-4">
                <form onsubmit="event.preventDefault(); loadStream()" class="flex gap-2">
                    <input id="input-channel" type="text" placeholder="Chaine..." class="stylish-input" style="width:200px; padding:8px 12px;">
                    <button class="btn-action">GO</button>
                </form>
                <div class="text-xs text-gray-500 self-center">Parent Fix: Active</div>
            </div>

            <div class="split-player">
                <div class="video-area" id="video-embed"></div>
                <div class="chat-area">
                    <div class="chat-tabs">
                        <div class="chat-tab active" onclick="setChat('hub', this)">HUB SECURE</div>
                        <div class="chat-tab" onclick="setChat('twitch', this)">TWITCH</div>
                    </div>
                    <div id="chat-layers">
                        <div id="layer-hub" class="layer active">
                            <div id="hub-messages">
                                <div class="hub-msg" style="border-left-color: #10b981;"><strong>SYSTEM</strong>Connexion établie. Design Onyx chargé.</div>
                            </div>
                            <div class="chat-input-box">
                                <form onsubmit="handleChat(event)">
                                    <input id="hub-input" type="text" placeholder="Message crypté..." class="stylish-input">
                                </form>
                            </div>
                        </div>
                        <div id="layer-twitch" class="layer"><div id="twitch-chat-frame" style="height:100%"></div></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-scanner" class="view-container">
            <div class="glass-card text-center py-20">
                <i class="fas fa-satellite-dish text-6xl text-gray-700 mb-6"></i>
                <h2 class="text-xl font-bold mb-2">Scanner de Concurrence</h2>
                <p class="text-gray-500 mb-6">Analysez n'importe quel canal Twitch avec l'IA.</p>
                <button class="btn-action px-8">LANCER UN SCAN</button>
            </div>
        </div>

        <div id="view-tools" class="view-container">
            <div class="grid grid-cols-3 gap-6">
                <div class="glass-card hover:border-indigo-500 transition cursor-pointer">
                    <i class="fas fa-bolt text-yellow-400 text-2xl mb-4"></i>
                    <h3 class="font-bold">Boost Station</h3>
                    <p class="text-xs text-gray-500 mt-2">Forcez l'affichage sur le réseau.</p>
                </div>
                <div class="glass-card hover:border-pink-500 transition cursor-pointer">
                    <i class="fas fa-users text-pink-500 text-2xl mb-4"></i>
                    <h3 class="font-bold">Raid Commander</h3>
                    <p class="text-xs text-gray-500 mt-2">Trouvez la cible parfaite.</p>
                </div>
            </div>
        </div>
    </div>

<script type="module">
    // --- FIREBASE LOGIC (MODULE) ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, limit, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // ⬇️ VOS CLES ICI ⬇️
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID"
    };

    let db;
    let isFirebaseReady = false;

    try {
        if(firebaseConfig.projectId !== "YOUR_PROJECT_ID") {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            isFirebaseReady = true;
            console.log("Firebase OK");
            
            // Listen
            const q = query(collection(db, "hub_chat"), orderBy("createdAt", "asc"), limit(50));
            onSnapshot(q, (snapshot) => {
                const container = document.getElementById('hub-messages');
                container.innerHTML = '';
                snapshot.forEach(doc => window.renderMsg(doc.data()));
                container.scrollTop = container.scrollHeight;
            });
        }
    } catch(e) { console.log("Firebase non configuré, mode local actif."); }

    // Envoi Global
    window.sendToDb = async (msg) => {
        if(isFirebaseReady) {
            await addDoc(collection(db, "hub_chat"), { ...msg, createdAt: serverTimestamp() });
        } else {
            // Mode Local si pas de Firebase
            window.renderMsg(msg);
        }
    }
</script>

<script>
    // --- APP LOGIC ---
    const PARENTS = ["localhost", "127.0.0.1", "justplayer.fr", window.location.hostname].filter(Boolean);
    let currentUser = { name: "Moi", color: "#6366f1" };

    // Navigation
    window.switchView = (viewId) => {
        document.querySelectorAll('.view-container').forEach(el => el.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        event.currentTarget.classList.add('active');

        if(viewId === 'dashboard') loadCharts();
        if(viewId === 'monitor') loadStream(); // Charge le stream par défaut
    };

    // Player
    window.loadStream = () => {
        const chan = document.getElementById('input-channel').value || "kamet0";
        document.getElementById('input-channel').value = chan;
        document.getElementById('video-embed').innerHTML = '';
        new Twitch.Embed("video-embed", { width: "100%", height: "100%", layout: "video", channel: chan, parent: PARENTS });
        
        // Load Twitch Chat Iframe
        const pParams = [...new Set(PARENTS)].map(p => `parent=${p}`).join('&');
        document.getElementById('twitch-chat-frame').innerHTML = `<iframe class="full-frame" src="https://www.twitch.tv/embed/${chan}/chat?${pParams}&darkpopout"></iframe>`;
    };

    // Chat Tabs
    window.setChat = (mode, btn) => {
        document.querySelectorAll('.chat-tab').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.layer').forEach(l => l.classList.remove('active'));
        document.getElementById('layer-' + mode).classList.add('active');
    };

    // Chat Handle
    window.handleChat = (e) => {
        e.preventDefault();
        const input = document.getElementById('hub-input');
        const text = input.value.trim();
        if(!text) return;
        
        const msg = { user: currentUser.name, text: text, color: currentUser.color };
        if(window.sendToDb) window.sendToDb(msg); // Appel module ou fallback
        else window.renderMsg(msg);
        
        input.value = '';
    };

    window.renderMsg = (data) => {
        const box = document.getElementById('hub-messages');
        const isMe = data.user === currentUser.name;
        const div = document.createElement('div');
        div.className = `hub-msg ${isMe ? 'me' : ''}`;
        div.innerHTML = `<strong>${data.user}</strong>${data.text}`;
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    };

    // Mock Login
    window.loginMock = () => {
        const names = ["ProGamer", "StreamMaster", "Viper"];
        currentUser.name = names[Math.floor(Math.random()*names.length)];
        document.getElementById('user-display').innerText = currentUser.name;
        window.renderMsg({user:'SYSTEM', text:`Connecté en tant que ${currentUser.name}`});
    };

    // Charts
    window.loadCharts = () => {
        if(window.myChart1) return; // Déjà chargé
        const ctx1 = document.getElementById('chart1');
        window.myChart1 = new Chart(ctx1, {
            type: 'line',
            data: { labels: ['L','M','M','J','V','S','D'], datasets: [{ label: 'Audience', data: [120, 190, 300, 500, 200, 300, 450], borderColor: '#6366f1', backgroundColor: 'rgba(99, 102, 241, 0.1)', fill: true, tension: 0.4 }] },
            options: { plugins: {legend: {display:false}}, scales: { x:{display:false}, y:{display:false} } }
        });
        
        const ctx2 = document.getElementById('chart2');
        new Chart(ctx2, {
            type: 'doughnut',
            data: { labels: ['Jeu','Chat','IRL'], datasets: [{ data: [55, 25, 20], backgroundColor: ['#6366f1', '#a855f7', '#10b981'], borderWidth:0 }] },
            options: { plugins: {legend: {position:'right', labels:{color:'#94a3b8'}}} }
        });
    };

    // Auto Init
    window.onload = () => {
        loadCharts();
    };
</script>
</body>
</html>
