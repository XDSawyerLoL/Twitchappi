<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Streamer & Niche AI Hub - COCKPIT MODE (V15)</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        /* TOUTES VOS VARIABLES CSS CONSERV√âES */
        :root {
            --color-bg-dark: #0d0d0d; --color-bg-medium: #1a1a1a;
            --color-primary-pink: #ff0099; --color-secondary-blue: #22c7ef;
            --color-ai-niche: #59d682; --color-ai-action: #e34a64;
        }
        body { background-color: var(--color-bg-dark); color: #fff; font-family: 'Inter'; }

        /* EFFET HOVER ROSE MINIATURES */
        .followed-stream-item {
            border: 2px solid transparent; transition: 0.3s; cursor: pointer; border-radius: 8px; overflow: hidden;
        }
        .followed-stream-item:hover {
            border-color: var(--color-primary-pink);
            box-shadow: 0 0 15px rgba(255, 0, 153, 0.4);
            transform: translateY(-3px);
        }

        /* TABS STYLE */
        .tab-btn { font-family: 'Orbitron'; padding: 12px; background: #111; color: #888; flex: 1; border-radius: 8px 8px 0 0; border: 1px solid #333; }
        .tab-btn.active { background: var(--color-bg-medium); color: #fff; border-top: 3px solid var(--color-primary-pink); }
        .tab-content { display: none; background: var(--color-bg-medium); padding: 20px; border: 1px solid #333; border-top:none; border-radius: 0 0 8px 8px; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="p-4">

<div class="max-w-7xl mx-auto">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-['Orbitron'] text-pink-500 font-bold">COCKPIT V15</h1>
        <div id="golden-hour-ui" class="text-yellow-500 text-xs font-bold uppercase">Golden Hour: <span id="golden-val">--%</span></div>
        <button onclick="window.open('/twitch_auth_start','_blank','width=500,height=600')" class="bg-purple-600 px-4 py-2 rounded-full text-[10px] font-bold">AUTH TWITCH</button>
    </div>

    <div class="bg-black rounded-xl p-2 border border-gray-800 mb-6 shadow-2xl">
        <div id="twitch-embed" style="height: 500px;"></div>
    </div>

    <div class="flex gap-1 overflow-x-auto">
        <button onclick="openTab('tab-fav')" id="btn-tab-fav" class="tab-btn active">SUIVI</button>
        <button onclick="openTab('tab-dash')" id="btn-tab-dash" class="tab-btn text-blue-400">üìä DASHBOARD 360¬∞</button>
        <button onclick="openTab('tab-boost')" id="btn-tab-boost" class="tab-btn">‚ö° BOOST</button>
        <button onclick="openTab('tab-raid')" id="btn-tab-raid" class="tab-btn">üí• RAID</button>
        <button onclick="openTab('tab-csv')" id="btn-tab-csv" class="tab-btn">üìÅ EXPORT</button>
    </div>

    <div id="tab-fav" class="tab-content active">
        <div id="fav-list" class="grid grid-cols-2 md:grid-cols-5 gap-4"></div>
    </div>

    <div id="tab-dash" class="tab-content">
        <div class="flex gap-2 mb-4">
            <input id="scan-in" type="text" class="bg-black border p-2 flex-1 rounded" placeholder="Scanner un streamer...">
            <button onclick="runScan360()" class="bg-blue-600 px-6 rounded font-bold">LANCER SCAN</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div id="dash-profil" class="bg-black p-4 rounded border border-gray-800">Profil...</div>
            <div id="dash-ai" class="bg-black p-4 rounded border border-gray-800">IA...</div>
            <div id="dash-vod" class="bg-black p-4 rounded border border-gray-800 text-center">VOD...</div>
        </div>
    </div>

    <div id="tab-boost" class="tab-content text-center py-10">
        <h2 class="text-2xl font-['Orbitron'] mb-4">ENGINE BOOST</h2>
        <input id="boost-in" type="text" class="bg-black border p-3 rounded w-64 mb-4 text-center" placeholder="Pseudo">
        <button onclick="activateBoost()" class="block mx-auto bg-pink-600 px-10 py-3 rounded-full font-bold">BOOSTER MAINTENANT</button>
    </div>

    <div id="tab-raid" class="tab-content">
        <h2 class="font-['Orbitron'] mb-4 text-red-500">RAID BUILDER</h2>
        <input id="raid-game" type="text" class="bg-black border p-2 w-full mb-2" placeholder="Nom du jeu">
        <button id="btn-start-raid" class="w-full bg-red-600 py-3 font-bold">CHERCHER CIBLES RAID</button>
        <div id="raid-results" class="mt-4 space-y-2"></div>
    </div>

    <div id="tab-csv" class="tab-content">
        <button onclick="window.open('/export_csv')" class="bg-yellow-600 px-6 py-3 rounded font-bold">T√âL√âCHARGER CSV DERNIER SCAN</button>
    </div>
</div>

<script src="https://embed.twitch.tv/embed/v1.js"></script>
<script>
    // --- TOUTES VOS FONCTIONS JS CONSERV√âES (RAID, BOOST, ETC) ---
    function launchPlayer(channel) {
        document.getElementById('twitch-embed').innerHTML = '';
        new Twitch.Embed("twitch-embed", { width: "100%", height: "100%", channel: channel, parent: [window.location.hostname] });
    }

    async function runScan360() {
        const query = document.getElementById('scan-in').value;
        const res = await fetch('/scan_target', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({query}) });
        const { data } = await res.json();
        if(data) {
            document.getElementById('dash-profil').innerHTML = `<img src="${data.profile_image_url}" class="w-20 mx-auto rounded-full mb-2"> <p class="text-center font-bold">${data.display_name}</p>`;
            // Appel Gemini via votre route auto_action
            const aiRes = await fetch('/auto_action', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({action_type:'niche_critique', target_name: query}) });
            const aiData = await aiRes.json();
            document.getElementById('dash-ai').innerHTML = aiData.html_response;
        }
    }

    async function activateBoost() {
        const channel = document.getElementById('boost-in').value;
        await fetch('/stream_boost', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({channel}) });
        launchPlayer(channel);
    }

    function openTab(id) {
        document.querySelectorAll('.tab-content, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('btn-' + id).classList.add('active');
    }

    // Initialisation
    window.onload = async () => {
        const b = await fetch('/check_boost');
        const bData = await b.json();
        launchPlayer(bData.boosted || 'twitch');
    };
</script>
</body>
</html>
