<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Streamer Hub V60 - Ultimate">
    <title>Streamer & Niche AI Hub - COCKPIT V60 (CHAT ENABLED)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <script src="https://embed.twitch.tv/embed/v1.js"></script>
    <script src="/socket.io/socket.io.js"></script>

    <style>
        :root {
            --color-bg-dark: #0d0d0d; --color-bg-medium: #1a1a1a; --color-bg-light: #111;
            --color-primary-pink: #ff0099; --color-secondary-blue: #22c7ef; --color-time-gold: #ffd700;
            --color-ai-niche: #59d682; --color-ai-repurpose: #9933ff; --color-ai-growth: #ffcc00; --color-ai-action: #e34a64; 
            --color-text-dimmed: #9aa3a8; --color-border-dark: #2e2e2e; --color-border-medium: #333;
            --shadow-pink: 0 0 15px rgba(255, 0, 153, 0.4); --shadow-blue: 0 0 15px rgba(34, 199, 239, 0.4); --shadow-action: 0 0 15px rgba(227, 74, 100, 0.4);
        }
        body { background-color: var(--color-bg-dark); color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        #twitch-lucky-main { max-width: 1600px; margin: 20px auto; padding: 10px; } /* Largeur pour le Chat */
        
        h1 { font-family: 'Orbitron', sans-serif; font-size: 28px; color: var(--color-primary-pink); margin-bottom: 5px; text-align: center; text-shadow: 0 0 5px var(--color-primary-pink); }
        .h1-blue-accent { color: var(--color-secondary-blue); }
        .subtitle-center { color: var(--color-text-dimmed); font-size: 12px; margin-bottom: 25px; text-align: center; letter-spacing: 1px; text-transform: uppercase; }

        /* NAV */
        .tabs-nav-container { margin-bottom: 20px; }
        .flex-tabs { display: flex; gap: 5px; flex-wrap: wrap; }
        .tab-btn { font-family: 'Orbitron', sans-serif; padding: 15px 20px; background: var(--color-bg-light); border: 1px solid var(--color-border-medium); border-bottom: none; color: var(--color-text-dimmed); cursor: pointer; border-radius: 8px 8px 0 0; transition: all 0.3s ease; flex: 1; text-align: center; font-size: 12px; white-space: nowrap; font-weight: 600; }
        .tab-btn:hover { color: #fff; background: #232323; }
        .tab-btn.active { background: var(--color-bg-medium); color: #fff; border-top: 3px solid var(--color-primary-pink); font-weight: bold; box-shadow: var(--shadow-pink); z-index: 10; position: relative; }

        /* --- PLAYER SPLIT SCREEN (NOUVEAU V60) --- */
        .player-wrapper { margin-bottom: 25px; padding: 20px; background: var(--color-bg-medium); border-radius: 12px; border: 1px solid var(--color-border-dark); box-shadow: var(--shadow-blue); }
        .player-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--color-border-medium); padding-bottom: 10px; }
        .player-title { font-family: 'Orbitron', sans-serif; font-size: 20px; color: var(--color-secondary-blue); display: flex; align-items: center; gap: 10px; }
        
        .player-grid { display: grid; grid-template-columns: 1fr 350px; gap: 15px; height: 600px; }
        #twitch-embed { width: 100%; height: 100%; border-radius: 8px; overflow: hidden; background: #000; border: 1px solid #222; }
        
        /* CHAT BOX */
        .chat-box { background: #0a0a0a; border: 1px solid #333; border-radius: 8px; display: flex; flex-direction: column; overflow: hidden; }
        .chat-tabs { display: flex; border-bottom: 1px solid #333; background: #111; }
        .chat-tab { flex: 1; padding: 10px; font-size: 11px; font-weight: bold; text-align: center; cursor: pointer; color: #666; font-family: 'Orbitron'; transition: 0.2s; }
        .chat-tab.active { color: white; background: #1a1a1a; border-bottom: 2px solid var(--color-secondary-blue); }
        .chat-content { flex: 1; position: relative; }
        .chat-stream-frame { width: 100%; height: 100%; border: none; }
        
        #hub-ui { display: none; flex-direction: column; height: 100%; }
        #hub-msgs { flex: 1; overflow-y: auto; padding: 10px; font-size: 13px; font-family: 'Inter'; scrollbar-width: thin; scrollbar-color: #333 #000; }
        #hub-msgs div { margin-bottom: 6px; word-wrap: break-word; }
        #hub-input-area { padding: 10px; border-top: 1px solid #333; display: flex; gap: 5px; background: #111; }
        
        /* INPUTS */
        .player-quick-input { background: var(--color-bg-dark); border: 1px solid var(--color-border-medium); color: white; padding: 8px 12px; border-radius: 4px; font-size: 13px; width: 220px; transition: border-color 0.3s; }
        .player-quick-input:focus { border-color: var(--color-secondary-blue); outline: none; }
        .btn-cycle { background: var(--color-bg-dark); color: var(--color-secondary-blue); border: 1px solid var(--color-secondary-blue); padding: 8px 15px; border-radius: 4px; font-size: 12px; transition: 0.2s; cursor: pointer; }
        .btn-cycle:hover:not(:disabled) { background: var(--color-secondary-blue); color: var(--color-bg-dark); }
        .btn-primary { background: var(--color-primary-pink); color: #fff; border: 0; padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: 700; text-transform: uppercase; font-size: 12px; transition: all 0.2s; letter-spacing: 1px; }
        .btn-primary:hover:not(:disabled) { transform: scale(1.02); box-shadow: var(--shadow-pink); }

        /* DASHBOARD & TABS */
        .tab-content { display: none; background: var(--color-bg-medium); border: 1px solid var(--color-border-dark); border-radius: 10px; padding: 25px; min-height: 400px; }
        .tab-content.active { display: block; animation: fadeEffect 0.4s ease-in-out; }
        @keyframes fadeEffect { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .sub-tab-btn { transition: all 0.3s; padding-bottom: 8px; border-bottom: 2px solid transparent; cursor: pointer; margin-right: 20px; color: #888; font-weight: bold; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
        .sub-tab-btn:hover { color: #fff; }
        .active-sub { border-bottom: 2px solid var(--color-secondary-blue); color: white; }
        .hidden { display: none !important; }

        .dashboard-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 25px; }
        .dashboard-box { background: #0a0a0a; border: 1px solid var(--color-border-dark); border-radius: 8px; padding: 20px; min-height: 300px; display: flex; flex-direction: column; transition: transform 0.2s; }
        .box-stats { border-top: 3px solid var(--color-secondary-blue); box-shadow: var(--shadow-blue); }
        .box-niche { border-top: 3px solid var(--color-ai-niche); box-shadow: 0 0 10px rgba(89, 214, 130, 0.2); }
        .box-vod { border-top: 3px solid var(--color-ai-repurpose); box-shadow: 0 0 10px rgba(153, 51, 255, 0.2); }
        .dashboard-title { font-family: 'Orbitron', sans-serif; font-size: 16px; margin-bottom: 15px; border-bottom: 1px solid #333; padding-bottom: 10px; letter-spacing: 1px; }

        .kpi-card { background: #111; padding: 20px; border-radius: 8px; border-left: 4px solid #333; box-shadow: 0 4px 6px rgba(0,0,0,0.5); position: relative; }
        .kpi-value { font-size: 28px; font-weight: 800; color: white; font-family: 'Orbitron', sans-serif; line-height: 1.2; }
        .kpi-label { font-size: 11px; color: #888; text-transform: uppercase; margin-top: 5px; letter-spacing: 1px; }
        .loading-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; border-radius: 8px; display: none; z-index: 5; }

        .followed-stream-item { width: calc(20% - 12px); min-width: 160px; padding: 10px; background: var(--color-bg-light); border-radius: 8px; border: 1px solid var(--color-border-dark); cursor: pointer; transition: 0.3s; }
        .followed-stream-item:hover { transform: translateY(-5px); border-color: var(--color-primary-pink); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .followed-stream-item img { width: 100%; border-radius: 6px; margin-bottom: 8px; aspect-ratio: 16/9; object-fit: cover; }
        .action-input { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid var(--color-border-medium); background: var(--color-bg-dark); color: #fff; font-size: 14px; transition: 0.3s; }
        
        @media (max-width: 1024px) { .player-grid { grid-template-columns: 1fr; height: auto; } .chat-box { height: 400px; } .dashboard-grid { grid-template-columns: 1fr; } .followed-stream-item { width: calc(50% - 10px); } }
    </style>
</head>
<body>

<div id="twitch-lucky-main">
    <h1 class="text-3xl"><span class="h1-blue-accent">STREAMER</span> HUB V60 <span style="font-size:14px; vertical-align:middle; background:#222; padding:2px 6px; border-radius:4px;">ULTIMATE</span></h1>
    <div class="subtitle-center">Cockpit Unifi√© ‚Ä¢ Chat Global ‚Ä¢ Intelligence Artificielle ‚Ä¢ Rotation 3min</div>

    <div class="tabs-nav-container">
        <div class="flex flex-wrap flex-tabs">
            <button class="tab-btn active" data-tab-id="tab-followed" onclick="openTab('tab-followed')"><i class="fas fa-key mr-2"></i> MON FIL</button> 
            <button class="tab-btn" data-tab-id="tab-dashboard" onclick="openTab('tab-dashboard')" style="color:white; border-top: 3px solid var(--color-secondary-blue);"><i class="fas fa-chart-line mr-2"></i> DASHBOARD</button>
            <button class="tab-btn" data-tab-id="tab-time" onclick="openTab('tab-time')" style="border-top: 3px solid var(--color-time-gold);"><i class="fas fa-clock mr-2"></i> BEST TIME</button>
            <button class="tab-btn" data-tab-id="tab-boost" onclick="openTab('tab-boost')"><i class="fas fa-bolt mr-2"></i> BOOST</button>
            <button class="tab-btn" data-tab-id="tab-raid" onclick="openTab('tab-raid')" style="border-top: 3px solid var(--color-ai-action);"><i class="fas fa-users mr-2"></i> RAID</button>
        </div>
    </div>

    <div class="player-wrapper">
        <div class="player-header">
            <h2 class="player-title"><span style="margin-right:8px;"><i class="fab fa-twitch"></i></span> LECTEUR <span id="player-channel-status" style="font-size:12px; color:#888; margin-left:15px; font-weight:normal;">Chargement...</span></h2>
            <div class="flex gap-2 items-center">
                <button id="btn-prev-stream" class="btn-cycle" onclick="cycleStream('prev')"><i class="fas fa-arrow-left"></i></button>
                <button id="btn-next-stream" class="btn-cycle" onclick="cycleStream('next')"><i class="fas fa-arrow-right"></i></button>
                <form id="mini-player-form" class="flex gap-2" onsubmit="event.preventDefault(); launchPlayer(document.getElementById('input-channel').value)">
                    <input id="input-channel" type="text" placeholder="Cha√Æne..." class="player-quick-input">
                    <button type="submit" class="btn-primary" style="padding: 5px 15px;">GO</button>
                </form>
            </div>
        </div>
        
        <div class="player-grid">
            <div id="twitch-embed"></div>
            <div class="chat-box">
                <div class="chat-tabs">
                    <div class="chat-tab" onclick="switchChat('twitch')" id="tab-c-twitch">üü£ STREAM</div>
                    <div class="chat-tab active" onclick="switchChat('hub')" id="tab-c-hub">üåê HUB GLOBAL</div>
                </div>
                <div class="chat-content">
                    <iframe id="chat-frame" class="chat-stream-frame" style="display:none;"></iframe>
                    <div id="hub-ui">
                        <div id="hub-msgs">
                            <div style="color:#666; font-style:italic;">Bienvenue sur le Chat Global !</div>
                        </div>
                        <div id="hub-input-area">
                            <input type="text" id="hub-in" placeholder="Message..." style="flex:1; background:#000; color:white; border:1px solid #333; padding:5px; border-radius:4px;">
                            <button onclick="sendMsg()" class="btn-primary" style="padding:5px 10px;">‚û§</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="content-area">
        <div id="tab-followed" class="tab-content active">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 class="text-pink font-bold text-lg" style="color:var(--color-primary-pink);"><i class="fas fa-circle text-red-500 mr-2 animate-pulse"></i> Vos Cha√Ænes Suivies LIVE</h3>
                <button id="btn-twitch-login" class="btn-primary" style="background:#6441a5; font-size:10px;"><i class="fas fa-lock mr-1"></i> CONNEXION</button>
            </div>
            <div id="followed-streams-list" style="display:flex; flex-wrap:wrap; gap:15px;"></div>
        </div>
        <div id="tab-dashboard" class="tab-content">
            <div id="dashboard-sub-nav" class="flex gap-6 border-b border-gray-800 mb-8 overflow-x-auto pb-2 text-[11px] font-bold uppercase tracking-wider text-gray-400">
                <button onclick="showSubTab('overview', this)" class="sub-tab-btn active-sub">Overview</button>
                <button onclick="showSubTab('games', this)" class="sub-tab-btn" style="color:#60a5fa">üéÆ Games</button>
                <button onclick="showSubTab('languages', this)" class="sub-tab-btn" style="color:#f472b6">üåç Languages</button>
                <button onclick="showSubTab('scanner', this)" class="sub-tab-btn" style="color:var(--color-ai-niche);">üîç SCANNER</button>
            </div>

            <div id="sub-overview" class="sub-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card" style="border-left-color: var(--color-secondary-blue);">
                        <div class="loading-overlay" id="load-kpi-1"><i class="fas fa-spin fa-spinner text-white text-2xl"></i></div>
                        <div id="val-total-viewers" class="kpi-value">...</div><div class="kpi-label">Total Viewers</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--color-ai-repurpose);">
                        <div class="loading-overlay" id="load-kpi-2"><i class="fas fa-spin fa-spinner text-white text-2xl"></i></div>
                        <div id="val-total-channels" class="kpi-value">...</div><div class="kpi-label">Total Channels</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--color-ai-niche);">
                        <div class="loading-overlay" id="load-kpi-3"><i class="fas fa-spin fa-spinner text-white text-2xl"></i></div>
                        <div id="val-top-game" class="kpi-value truncate text-xl">...</div><div class="kpi-label">Top Cat√©gorie</div>
                    </div>
                    <div class="kpi-card" style="border-left-color: var(--color-primary-pink);">
                        <div id="val-uptime" class="kpi-value">En Ligne</div><div class="kpi-label">Serveur</div>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div class="bg-[#0a0a0a] p-6 rounded-xl border border-gray-800" style="height:350px;">
                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-6">üìà Tendance Viewers</h4><canvas id="liveStreamsChart"></canvas>
                    </div>
                    <div class="bg-[#0a0a0a] p-6 rounded-xl border border-gray-800" style="height:350px;">
                        <h4 class="text-xs font-bold text-gray-400 uppercase mb-6">üìä Canaux Actifs</h4><canvas id="yoyChannelsChart"></canvas>
                    </div>
                </div>
            </div>

            <div id="sub-games" class="sub-content hidden">
                <div id="games-list-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
            </div>
            <div id="sub-languages" class="sub-content hidden">
                <div id="languages-list-container" class="bg-[#0a0a0a] p-6 rounded-xl border border-gray-800 space-y-6"></div>
            </div>

            <div id="sub-scanner" class="sub-content hidden">
                <div style="text-align:center; margin-bottom:30px;">
                    <h3 class="text-blue-400 font-bold text-xl mb-3">SCANNER IA</h3>
                    <form id="form-global-scan" class="max-w-xl mx-auto">
                        <input id="input-global-target" type="text" placeholder="Streamer ou Jeu..." class="action-input" style="text-align:center;">
                        <button type="submit" class="btn-primary" style="width:100%; margin-top:10px;">LANCER</button>
                    </form>
                </div>
                <div class="dashboard-grid">
                    <div id="res-scan-content" class="dashboard-box box-stats"><p style="margin:auto; color:#666;">En attente...</p></div>
                    <div id="res-niche-content" class="dashboard-box box-niche"><p style="margin:auto; color:#666;">L'IA analyse...</p></div>
                    <div id="res-vod-content" class="dashboard-box box-vod"><p style="margin:auto; color:#666;">VOD...</p></div>
                </div>
            </div>
        </div>

        <div id="tab-time" class="tab-content">
            <h3 style="color:var(--color-time-gold); margin-bottom:15px; font-weight:bold;">OPTIMISATION HORAIRE</h3>
            <form id="form-schedule" class="flex gap-3"><input id="input-schedule-game" type="text" placeholder="Jeu..." class="action-input"><button type="submit" class="btn-primary">CALCULER</button></form>
            <div id="schedule-results" style="display:none; margin-top:20px; padding:20px; background:#111; border-radius:8px;">
                <div style="display:flex; gap:15px;"><img id="schedule-img" width="60"><div id="schedule-game-name" style="font-weight:bold;"></div></div>
                <div id="schedule-ai-content" style="margin-top:15px; color:#ddd;"></div>
            </div>
        </div>
        
        <div id="tab-boost" class="tab-content">
            <h3 style="color:var(--color-primary-pink); margin-bottom:15px; font-weight:bold;">STREAM BOOST</h3>
            <form id="form-boost" class="flex gap-3"><input id="input-boost" type="text" placeholder="Cha√Æne..." class="action-input"><button type="submit" class="btn-primary">ACTIVER</button></form>
            <div id="boost-results" style="margin-top:20px; color:#777; text-align:center;">En attente...</div>
        </div>

        <div id="tab-raid" class="tab-content">
            <h3 style="color:var(--color-ai-action); margin-bottom:15px; font-weight:bold;">RAID FINDER</h3>
            <form id="form-raid" class="flex gap-3">
                <input id="input-raid-game" type="text" placeholder="Jeu..." class="action-input">
                <select id="select-raid-viewers" class="action-input" style="width:auto;"><option value="100">Max 100</option></select>
                <button type="submit" class="btn-primary">CHERCHER</button>
            </form>
            <div id="raid-results" style="margin-top:20px;"></div>
        </div>
    </div>
</div>

<script>
    const API = window.location.origin;
    let embed, autoTimer, myPseudo = "Guest_" + Math.floor(Math.random()*1000);
    const socket = io(); // CONNEXION CHAT

    // --- LOGIQUE CHAT ---
    function switchChat(t) {
        document.getElementById('chat-frame').style.display = t==='twitch'?'block':'none';
        document.getElementById('hub-ui').style.display = t==='hub'?'flex':'none';
        document.getElementById('tab-c-twitch').className = t==='twitch'?'chat-tab active':'chat-tab';
        document.getElementById('tab-c-hub').className = t==='hub'?'chat-tab active':'chat-tab';
    }
    socket.on('chat_message', m => addMsg(m.user, m.text));
    socket.on('history', h => h.forEach(m => addMsg(m.user, m.text)));
    
    function sendMsg() {
        const i = document.getElementById('hub-in');
        if(!i.value) return;
        socket.emit('send_message', { user: myPseudo, text: i.value });
        i.value = "";
    }
    function addMsg(u, t) {
        const d = document.createElement('div');
        d.innerHTML = `<span style="color:${u===myPseudo?'#00ffcc':'#ff00ff'}; font-weight:bold;">${u}:</span> <span style="color:#ddd;">${t}</span>`;
        document.getElementById('hub-msgs').appendChild(d);
        document.getElementById('hub-msgs').scrollTop = 99999;
    }

    // --- PLAYER ---
    window.launchPlayer = function(c, vid=null) {
        document.getElementById('twitch-embed').innerHTML = "";
        const opts = { width: "100%", height: "100%", layout: "video", parent: ["localhost", "127.0.0.1", window.location.hostname] };
        if(vid) opts.video = vid; else opts.channel = c;
        embed = new Twitch.Embed("twitch-embed", opts);
        document.getElementById('chat-frame').src = `https://www.twitch.tv/embed/${c}/chat?parent=${window.location.hostname}&darkpopout`;
    }

    async function checkRot() {
        const d = await fetch(`${API}/get_default_stream`).then(r=>r.json());
        if(d.success) {
            launchPlayer(d.channel);
            document.getElementById('player-channel-status').innerText = d.message;
            if(d.mode !== 'BOOST') autoTimer = setInterval(() => cycle('next'), 180000);
        }
    }
    async function cycle(dir) { await fetch(`${API}/cycle_stream`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({direction:dir}) }); checkRot(); }

    // --- TABS & DASHBOARD ---
    function openTab(id) {
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.tab-btn').forEach(e=>e.classList.remove('active'));
        document.querySelector(`[data-tab-id="${id}"]`).classList.add('active');
        if(id === 'tab-dashboard') loadStats();
    }
    function showSubTab(n, el) {
        document.querySelectorAll('.sub-content').forEach(e=>e.classList.add('hidden'));
        document.getElementById('sub-'+n).classList.remove('hidden');
        if(n==='games') loadGames();
        if(n==='languages') loadLangs();
    }

    // --- CHARTS & DATA ---
    let chart1, chart2;
    async function loadStats() {
        const d = await fetch(`${API}/api/stats/global`).then(r=>r.json());
        if(!d.success) return;
        document.getElementById('val-total-viewers').innerText = d.total_viewers;
        document.getElementById('val-top-game').innerText = d.top_game_name;
        
        if(!chart1) chart1 = new Chart(document.getElementById('liveStreamsChart'), { type:'line', data: { labels: d.history.live.labels, datasets:[{ data:d.history.live.values, borderColor:'#22c7ef', backgroundColor:'rgba(34,199,239,0.1)', fill:true }] }, options:{plugins:{legend:{display:false}}, maintainAspectRatio:false} });
        if(!chart2) chart2 = new Chart(document.getElementById('yoyChannelsChart'), { type:'bar', data: { labels:['1','2','3'], datasets:[{ data:[10,25,15], backgroundColor:'#ff0099' }] }, options:{plugins:{legend:{display:false}}, maintainAspectRatio:false} });
    }

    async function loadGames() {
        const d = await fetch(`${API}/api/stats/top_games`).then(r=>r.json());
        document.getElementById('games-list-container').innerHTML = d.games.map(g => `<div class="flex items-center gap-3 bg-[#111] p-3 rounded"><img src="${g.box_art_url}" width="40"><div class="font-bold text-sm">${g.name}</div></div>`).join('');
    }

    // --- FORMS (SCAN, BOOST, RAID) ---
    document.getElementById('form-global-scan').addEventListener('submit', async(e)=>{
        e.preventDefault();
        const q = document.getElementById('input-global-target').value;
        const res = await fetch(`${API}/scan_target`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({query:q}) }).then(r=>r.json());
        if(res.success && res.type === 'user') {
            document.getElementById('res-scan-content').innerHTML = `<div class="text-center"><img src="${res.user_data.profile_image_url}" width="60" class="rounded-full mx-auto mb-2"><div class="font-bold">${res.user_data.display_name}</div></div>`;
            const ia = await fetch(`${API}/critique_ia`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({type:'niche', query:q}) }).then(r=>r.json());
            document.getElementById('res-niche-content').innerHTML = `<div class="text-xs p-2 overflow-y-auto h-full">${ia.html_response}</div>`;
        }
    });

    document.getElementById('form-boost').addEventListener('submit', async(e)=>{
        e.preventDefault();
        const c = document.getElementById('input-boost').value;
        const r = await fetch(`${API}/stream_boost`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({channel:c}) }).then(j=>j.json());
        document.getElementById('boost-results').innerText = r.html_response || "Erreur";
        checkRot();
    });

    // INIT
    switchChat('hub');
    checkRot();
    openTab('tab-followed');
</script>
</body>
</html>
