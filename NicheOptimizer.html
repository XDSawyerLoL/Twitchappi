<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Streamer & Niche AI Hub V6.6 - Corrig√©</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* --- VARIABLES CSS POUR FACILITER LA MAINTENANCE DES COULEURS --- */
        :root {
            --color-bg-dark: #0d0d0d;
            --color-bg-medium: #1a1a1a;
            --color-bg-light: #111;
            --color-primary-pink: #ff0099;
            --color-secondary-blue: #22c7ef;
            --color-ai-niche: #59d682;
            --color-ai-repurpose: #9933ff;
            --color-ai-growth: #ffcc00;
            --color-text-dimmed: #9aa3a8;
            --color-border-dark: #2e2e2e;
            --color-border-medium: #333;
        }

        /* Styles Globaux */
        body {
            background-color: var(--color-bg-dark);
            color: white;
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }

        /* Titres */
        h1, h2 { font-family: 'Orbitron', sans-serif; }
        .tab-heading {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--color-primary-pink);
            border-bottom: 2px solid var(--color-border-medium);
            padding-bottom: 0.5rem;
        }

        /* Boutons et Inputs */
        .btn-primary {
            background-color: var(--color-primary-pink);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        .btn-primary:hover { background-color: #e6008a; }

        input[type="text"], textarea {
            background-color: var(--color-bg-medium);
            border: 1px solid var(--color-border-dark);
            color: white;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
        }

        /* Barres de navigation d'onglets */
        .tab-nav {
            display: flex;
            background-color: var(--color-bg-medium);
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.5rem;
        }
        .tab-btn {
            flex-grow: 1;
            text-align: center;
            padding: 1rem;
            color: var(--color-text-dimmed);
            font-weight: 600;
            cursor: pointer;
            border-radius: 0.3rem;
            transition: all 0.2s;
        }
        .tab-btn:hover { background-color: #2e2e2e; color: white; }
        .tab-btn.active {
            background-color: var(--color-primary-pink);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 0, 153, 0.4);
        }

        /* Contenu des Onglets */
        .tab-content { display: none; padding: 1rem; background-color: var(--color-bg-light); border-radius: 0.5rem; }
        .tab-content.active { display: block; }
        
        .text-pink { color: var(--color-primary-pink); }
        .text-blue { color: var(--color-secondary-blue); }

        /* Styles sp√©cifiques au fil suivi */
        .followed-stream-item {
            display: flex;
            align-items: center;
            background-color: var(--color-bg-medium);
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .followed-stream-item:hover {
            background-color: #2e2e2e;
        }
        .streamer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            margin-right: 15px;
            object-fit: cover;
        }
        .stream-details { flex-grow: 1; }
        .stream-name { font-weight: 700; color: white; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .stream-meta { font-size: 0.8rem; color: var(--color-text-dimmed); }
        .stream-viewers { color: var(--color-primary-pink); font-weight: 600; margin-right: 10px; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-7xl mx-auto">
        <h1 class="text-4xl font-bold mb-6 text-center text-pink">Streamer & Niche AI Hub</h1>
        <p class="text-center text-gray-400 mb-8">Optimisez votre croissance sur Twitch avec l'intelligence artificielle et l'analyse de donn√©es.</p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="lg:col-span-2 bg-gray-900 rounded-xl p-4 shadow-lg" style="background-color: var(--color-bg-light);">
                <div class="aspect-video" id="twitch-embed">
                    </div>
                <div class="mt-4 flex justify-between items-center">
                    <span id="player-channel-status" class="text-lg font-bold text-blue">Cha√Æne: TWITCH</span>
                    <form id="form-channel-player" class="flex">
                        <input type="text" id="input-channel" placeholder="Changer de cha√Æne (ex: shroud)" class="mr-2 w-full max-w-xs">
                        <button type="submit" class="btn-primary">Go</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-1 bg-gray-900 rounded-xl p-6 shadow-lg" style="background-color: var(--color-bg-light);">
                <h2 class="text-2xl font-bold mb-4 text-center text-ai-growth" style="color: var(--color-ai-growth);">Outils Instantan√©s</h2>
                
                <div id="tab-boost" class="p-4 rounded-lg mb-4" style="background-color: var(--color-bg-medium);">
                    <h3 class="text-xl font-bold text-pink mb-3 flex items-center">
                        ‚ö° BOOST INSTANTAN√â
                        <span class="text-sm ml-auto text-gray-400">Cooldown 3H</span>
                    </h3>
                    <form id="form-boost">
                        <input type="text" id="input-boost" placeholder="Nom de la cha√Æne √† booster (ex: votre_pseudo)" class="mb-3">
                        <button type="submit" id="btn-boost" class="btn-primary w-full">BOOSTER (10 MINUTES)</button>
                    </form>
                    <div id="boost-message" class="mt-3 text-sm text-center">
                        </div>
                </div>

                <div class="space-y-3">
                    <a href="lucky_streamer_picker.html" class="block btn-primary text-center bg-ai-niche" style="background-color: var(--color-ai-niche);">
                        üé≤ PICKER AL√âATOIRE (Cible)
                    </a>
                    <a href="sniper_tool.html" class="block btn-primary text-center bg-ai-repurpose" style="background-color: var(--color-ai-repurpose);">
                        üéØ SNIPER TOOL (Anti-Host)
                    </a>
                </div>
            </div>
        </div>

        <div class="bg-gray-900 rounded-xl p-4 shadow-lg" style="background-color: var(--color-bg-light);">
            
            <div class="tab-nav">
                <button class="tab-btn active" data-tab-id="tab-followed" onclick="openTab('tab-followed')">üîë MON FIL SUIVI</button>
                <button class="tab-btn" data-tab-id="tab-scan" onclick="openTab('tab-scan')">üéØ SCAN & RESULTATS</button>
                <button class="tab-btn" data-tab-id="tab-growth" onclick="openTab('tab-growth')">üí∞ CROISSANCE IA</button>
            </div>

            <div id="tab-followed" class="tab-content active">
                <h2 class="tab-heading">Mon Fil Twitch en Direct</h2>
                <div class="flex justify-between items-center mb-4">
                    <p id="login-status" class="text-lg text-gray-400">Statut: V√©rification en cours...</p>
                    <button id="btn-twitch-login" class="btn-primary">Chargement...</button>
                </div>
                
                <div id="followed-streams-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 h-96 overflow-y-auto">
                    </div>
            </div>

            <div id="tab-scan" class="tab-content">
                <h2 class="tab-heading">Scanner un Jeu ou un Streamer</h2>
                <form id="form-target" class="flex space-x-3 mb-6">
                    <input type="text" id="input-target" placeholder="Entrez le nom du Jeu ou le Pseudo du Streamer √† analyser (ex: Minecraft)" class="flex-grow">
                    <button type="submit" id="btn-target" class="btn-primary bg-secondary-blue" style="background-color: var(--color-secondary-blue);">SCANNER</button>
                </form>

                <div id="scan-result-container">
                    <p id="scan-result-placeholder" class="text-center text-text-dimmed">Le r√©sultat du scan s'affichera ici.</p>
                    <div id="scan-result" class="hidden">
                        </div>
                </div>
            </div>

            <div id="tab-growth" class="tab-content">
                <h2 class="tab-heading">Analyse de Croissance par IA (Gemini)</h2>

                <div class="border p-4 rounded-lg mb-6" style="border-color: var(--color-ai-growth); background-color: #1a1a1a;">
                    <h3 class="text-xl font-bold mb-3" style="color: var(--color-ai-growth);">üîÆ D√©tection de la Prochaine Niche (Trend Detector)</h3>
                    <p class="text-gray-400 mb-4">L'IA scanne le Top 2000 des streams Twitch pour trouver le meilleur ratio spectateurs/streamers (V/S) pour votre croissance instantan√©e.</p>
                    <button id="btn-trend-detector" class="btn-primary" style="background-color: var(--color-ai-growth);">D√âTECTER LA PROCHAINE NICHE</button>
                    <div id="trend-results" class="mt-4">
                        </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border p-4 rounded-lg" style="border-color: var(--color-ai-niche); background-color: #1a1a1a;">
                        <h3 class="text-xl font-bold mb-3" style="color: var(--color-ai-niche);">üß≠ Analyse de Niche Sp√©cifique</h3>
                        <form id="form-niche-analysis">
                            <input type="text" id="input-niche-game" placeholder="Entrez le nom d'un jeu (ex: Overwatch 2)" class="mb-3">
                            <button type="submit" id="btn-niche-analyse" class="btn-primary w-full" style="background-color: var(--color-ai-niche);">ANALYSER LA NICHE</button>
                        </form>
                        <div id="niche-result-container" class="mt-4" style="display: none;">
                            <div id="niche-results" class="text-sm">
                                </div>
                        </div>
                    </div>

                    <div class="border p-4 rounded-lg" style="border-color: var(--color-ai-repurpose); background-color: #1a1a1a;">
                        <h3 class="text-xl font-bold mb-3" style="color: var(--color-ai-repurpose);">‚úÇÔ∏è Repurposing (TikTok, YouTube)</h3>
                        <form id="form-repurpose">
                            <input type="text" id="input-repurpose-channel" placeholder="Entrez le pseudo du streamer √† analyser" class="mb-3">
                            <button type="submit" id="btn-repurpose-analyse" class="btn-primary w-full" style="background-color: var(--color-ai-repurpose);">CRITIQUE & ID√âES</button>
                        </form>
                        <div id="repurpose-result-container" class="mt-4" style="display: none;">
                            <div id="repurpose-results" class="text-sm">
                                </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>

    <script src="https://embed.twitch.tv/embed/v1.js"></script>
    <script>
        // --- Configuration Globale ---
        const API_BASE = window.location.origin;
        const DEFAULT_CHANNEL = 'twitch'; 

        // --- Gestion des Onglets ---
        function openTab(tabId) {
            localStorage.setItem('activeTab', tabId);
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
                const targetBtn = document.querySelector(`.tab-btn[data-tab-id="${tabId}"]`);
                if (targetBtn) targetBtn.classList.add('active');
            }
        }

        // --- Lecteur Twitch ---
        let embed = null;
        const twitchEmbedContainer = document.getElementById('twitch-embed');
        const inputChannel = document.getElementById('input-channel');

        function launchPlayer(channelName) {
            if (!channelName) return;

            localStorage.setItem('activeChannel', channelName);
            inputChannel.value = channelName;

            twitchEmbedContainer.innerHTML = '';
            embed = new Twitch.Embed("twitch-embed", {
                width: "100%",
                height: 550, 
                channel: channelName,
                layout: "video-and-chat", 
                autoplay: true,
                parent: [window.location.hostname] 
            });
            document.getElementById('player-channel-status').textContent = `Cha√Æne: ${channelName.toUpperCase()}`;
        }

        function initializePlayer() {
            const storedChannel = localStorage.getItem('activeChannel');
            const channelToLoad = storedChannel || DEFAULT_CHANNEL;
            launchPlayer(channelToLoad);
        }
        
        document.getElementById('form-channel-player').addEventListener('submit', (e) => {
            e.preventDefault();
            const channel = inputChannel.value.trim().toLowerCase();
            if(channel) {
                launchPlayer(channel);
            }
        });

        // --- Authentification Twitch et Fil Suivi ---
        const btnLogin = document.getElementById('btn-twitch-login');
        const loginStatus = document.getElementById('login-status');
        const followedStreamsList = document.getElementById('followed-streams-list');
        let twitchUserConnected = false; 

        async function checkAuth() {
            try {
                const res = await fetch(`${API_BASE}/twitch_user_status`);
                if(res.ok) {
                    const data = await res.json();
                    if(data.is_connected) {
                        twitchUserConnected = true;
                        loginStatus.innerHTML = `‚úÖ Connect√© en tant que <strong style="color:var(--color-secondary-blue)">${data.username}</strong>`;
                        btnLogin.textContent = "üîí D√âCONNEXION";
                        btnLogin.style.background = "#e34a64"; 
                        loadFollowedStreams(); 
                    } else {
                        twitchUserConnected = false;
                        loginStatus.textContent = "Statut: D√©connect√©.";
                        btnLogin.textContent = "üîí SE CONNECTER VIA TWITCH";
                        btnLogin.style.background = "#6441a5"; 
                        followedStreamsList.innerHTML = '<p style="color:var(--color-ai-growth); text-align:center;">Veuillez vous connecter pour voir ceci.</p>';
                    }
                } else {
                    twitchUserConnected = false;
                    loginStatus.innerHTML = `‚ùå Erreur API (${res.status}). Veuillez v√©rifier le serveur backend.`;
                    followedStreamsList.innerHTML = '<p style="color:red; text-align:center;">Erreur de connexion au service Twitch.</p>';
                }
            } catch(e) {
                console.error("Erreur check auth:", e);
                twitchUserConnected = false;
                loginStatus.innerHTML = `‚ùå Erreur technique: ${e.message}.`;
                followedStreamsList.innerHTML = `<p style="color:red; text-align:center;">Erreur API: ${e.message}</p>`;
            }
        }

        btnLogin.addEventListener('click', () => {
            if(twitchUserConnected) {
                // Utilise la route POST pour la d√©connexion
                fetch(`${API_BASE}/twitch_logout`, { method: 'POST' }).then(() => {
                    window.location.reload(); 
                });
            } else {
                window.location.href = `${API_BASE}/twitch_auth_start`;
            }
        });

        async function loadFollowedStreams() {
            if(!twitchUserConnected) {
                followedStreamsList.innerHTML = '<p style="color:var(--color-ai-growth); text-align:center;">Veuillez vous connecter pour voir ceci.</p>';
                return;
            }
            
            followedStreamsList.innerHTML = '<p style="text-align:center; color:#555;">Chargement des streams en direct...</p>';
            
            try {
                const res = await fetch(`${API_BASE}/followed_streams`);
                
                if(res.ok) {
                    const data = await res.json();
                    
                    if(data.data && data.data.length > 0) {
                        followedStreamsList.innerHTML = ''; 
                        data.data.forEach(stream => {
                            const div = document.createElement('div');
                            div.className = 'followed-stream-item';
                            
                            const imageUrl = stream.thumbnail_url 
                                            ? stream.thumbnail_url.replace('{width}', '320').replace('{height}', '180') 
                                            : stream.profile_image_url || 'https://static-cdn.jtvnw.net/jtv_user_pictures/default_profile.png'; 

                            div.innerHTML = `
                                <img src="${imageUrl}" alt="Preview de ${stream.user_name}" class="streamer-avatar">
                                <div class="stream-details">
                                    <span class="stream-name" title="${stream.user_name}">${stream.user_name}</span>
                                    <div class="stream-meta">
                                        <span class="stream-viewers">üî¥ ${stream.viewer_count} spectateurs</span>
                                        <span class="stream-game" title="${stream.game_name}">${stream.game_name}</span>
                                    </div>
                                </div>
                            `;

                            div.onclick = () => {
                                launchPlayer(stream.user_name);
                            };
                            followedStreamsList.appendChild(div);
                        });
                    } else {
                        followedStreamsList.innerHTML = '<p style="text-align:center;">Aucun stream en direct parmi vos cha√Ænes suivies.</p>';
                    }
                } else {
                    followedStreamsList.innerHTML = `<p style="color:red; text-align:center;">Erreur chargement du fil (Statut: ${res.status}).</p>`;
                }
            } catch(e) {
                followedStreamsList.innerHTML = `<p style="color:red; text-align:center;">Erreur API: ${e.message}</p>`;
            }
        }


        // --- Logique de Scan Cible (CORRIG√âE: Envoi de 'query' au lieu de 'target') ---
        document.getElementById('form-target').addEventListener('submit', async (e) => {
            e.preventDefault();
            const target = document.getElementById('input-target').value.trim();
            const resultBox = document.getElementById('scan-result');
            const placeholder = document.getElementById('scan-result-placeholder');
            const btn = document.getElementById('btn-target');

            if (!target) {
                placeholder.textContent = "Veuillez entrer un Jeu ou un Pseudo pour lancer le scan.";
                placeholder.classList.remove('hidden');
                resultBox.classList.add('hidden');
                return;
            }

            placeholder.classList.add('hidden');
            resultBox.classList.remove('hidden');
            resultBox.innerHTML = '<p style="text-align:center; color:var(--color-ai-growth);">üöÄ Scan de la cible en cours pour ' + target + '... (Appel API r√©el)</p>';
            btn.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/scan_target`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ query: target }) // <-- CORRIG√â
                });

                if(res.ok) {
                    const data = await res.json();
                    
                    if (data.type === 'game') {
                        const gameData = data.game_data;
                        let streamsList = gameData.streams.map(s => `
                            <li>${s.user_name} (${s.viewer_count} spectateurs) - ${s.title}</li>
                        `).join('');

                        resultBox.innerHTML = `
                            <div class="p-4 border border-blue-500 rounded-lg mt-4" style="border-color:var(--color-secondary-blue);">
                                <h4 class="text-blue tab-heading">R√©sultat du Scan de Jeu: ${gameData.name}</h4>
                                <div class="flex items-center mb-4">
                                    <img src="${gameData.box_art_url}" alt="${gameData.name}" class="w-20 h-auto rounded mr-4">
                                    <div>
                                        <p><strong>Total Spectateurs:</strong> ${gameData.total_viewers}</p>
                                        <p><strong>Total Streamers:</strong> ${gameData.total_streamers}</p>
                                        <p><strong>Ratio V/S (Moyenne):</strong> <span class="text-pink">${gameData.avg_viewers_per_streamer}</span></p>
                                    </div>
                                </div>
                                <h5 class="font-bold mt-3 text-pink">Top 10 Streams Actuels:</h5>
                                <ul class="list-disc ml-5 text-sm">${streamsList}</ul>
                            </div>
                        `;

                    } else if (data.type === 'user') {
                        const userData = data.user_data;
                        resultBox.innerHTML = `
                            <div class="p-4 border border-blue-500 rounded-lg mt-4" style="border-color:var(--color-secondary-blue);">
                                <h4 class="text-blue tab-heading">R√©sultat du Scan d'Utilisateur: ${userData.display_name}</h4>
                                <div class="flex items-center mb-4">
                                    <img src="${userData.profile_image_url}" alt="${userData.display_name}" class="w-20 h-20 rounded-full mr-4">
                                    <div>
                                        <p><strong>Statut:</strong> ${userData.is_live ? '<span class="text-pink">üî¥ EN DIRECT</span>' : 'HORS LIGNE'}</p>
                                        <p><strong>Description:</strong> ${userData.description || 'Non fournie.'}</p>
                                        ${userData.is_live ? `<p><strong>Jeu:</strong> ${userData.stream_details.game_name} (${userData.stream_details.viewer_count} viewers)</p>` : ''}
                                    </div>
                                </div>
                                <button class="btn-primary mt-2" onclick="launchPlayer('${userData.login}')">Regarder le Stream</button>
                            </div>
                        `;
                    } else if (data.type === 'none') {
                        resultBox.innerHTML = `<p style="color:red; text-align:center;">${data.message}</p>`;
                    } else {
                        resultBox.innerHTML = `<p style="color:red; text-align:center;">Format de r√©ponse API inattendu. Le backend ne renvoie pas un type connu.</p>`;
                    }

                } else {
                    let errorMsg = `Erreur lors de l'appel au service de Scan (Statut: ${res.status}).`;
                    const errorData = await res.json();
                    if (errorData && errorData.error) {
                        errorMsg = `Erreur Backend: ${errorData.error}`;
                    }
                    resultBox.innerHTML = `<p style="color:red; text-align:center; font-weight: bold;">${errorMsg}</p>`;
                }
            } catch(e) {
                resultBox.innerHTML = `<p style="color:red; text-align:center;">Erreur de connexion au service de Scan: ${e.message}</p>`;
            } finally {
                btn.disabled = false;
            }
        });


        // --- Logique d'interaction IA ---
        
        // 1. Analyse de Niche (CORRIG√â: Envoi de 'query' au lieu de 'game')
        document.getElementById('form-niche-analysis').addEventListener('submit', async (e) => {
            e.preventDefault();
            const game = document.getElementById('input-niche-game').value.trim();
            const resultBox = document.getElementById('niche-results');
            const container = document.getElementById('niche-result-container');
            const btn = document.getElementById('btn-niche-analyse');

            if (!game) return;

            container.style.display = 'block';
            resultBox.innerHTML = '<p style="color:var(--color-ai-niche);">Analyse IA de niche en cours pour ' + game + '... (Appel API r√©el)</p>';
            btn.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/critique_ia`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ query: game, type: 'niche' }) // <-- CORRIG√â
                });

                if(res.ok) {
                    const data = await res.json();
                    resultBox.innerHTML = data.html_critique || data.error || '<p>R√©ponse IA re√ßue, mais le format est inattendu.</p>';
                } else {
                    const errorData = await res.json();
                    resultBox.innerHTML = `<p style="color:red;">Erreur de l'API IA: ${res.status}. ${errorData.error || ''}</p>`;
                }
            } catch(e) {
                resultBox.innerHTML = `<p style="color:red;">Erreur de connexion au service IA: ${e.message}</p>`;
            } finally {
                btn.disabled = false;
            }
        });

        // 2. Repurposing (CORRIG√â: Envoi de 'query' au lieu de 'channel')
        document.getElementById('form-repurpose').addEventListener('submit', async (e) => {
            e.preventDefault();
            const channel = document.getElementById('input-repurpose-channel').value.trim();
            const resultBox = document.getElementById('repurpose-results');
            const container = document.getElementById('repurpose-result-container');
            const btn = document.getElementById('btn-repurpose-analyse');

            if (!channel) return;

            container.style.display = 'block';
            resultBox.innerHTML = `<p style="color:var(--color-ai-repurpose);">Analyse de VOD pour ${channel} en cours... (Appel API r√©el)</p>`;
            btn.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/critique_ia`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ query: channel, type: 'repurpose' }) // <-- CORRIG√â
                });

                if(res.ok) {
                    const data = await res.json();
                    resultBox.innerHTML = data.html_critique || data.error || '<p>R√©ponse IA re√ßue, mais le format est inattendu.</p>';
                } else {
                    const errorData = await res.json();
                    resultBox.innerHTML = `<p style="color:red;">Erreur de l'API Repurposing: ${res.status}. ${errorData.error || ''}</p>`;
                }
            } catch(e) {
                resultBox.innerHTML = `<p style="color:red;">Erreur de connexion au service Repurposing: ${e.message}</p>`;
            } finally {
                btn.disabled = false;
            }
        });

        // 3. Trend Detector
        document.getElementById('btn-trend-detector').addEventListener('click', async () => {
            const resultBox = document.getElementById('trend-results');
            const container = document.getElementById('trend-results');
            const btn = document.getElementById('btn-trend-detector');

            container.style.display = 'block';
            resultBox.innerHTML = `<p style="color:var(--color-ai-growth);">D√©tection des tendances en cours... (Appel API r√©el)</p>`;
            btn.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/critique_ia`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ type: 'trend' })
                });

                if(res.ok) {
                    const data = await res.json();
                    resultBox.innerHTML = data.html_critique || data.error || '<p>R√©ponse IA re√ßue, mais le format est inattendu.</p>';
                } else {
                    const errorData = await res.json();
                    resultBox.innerHTML = `<p style="color:red;">Erreur de l'API Trend: ${res.status}. ${errorData.error || ''}</p>`;
                }
            } catch(e) {
                resultBox.innerHTML = `<p style="color:red;">Erreur de connexion au service Trend: ${e.message}</p>`;
            } finally {
                btn.disabled = false;
            }
        });

        // --- NOUVELLE LOGIQUE : Stream Boost (Avec Cooldown) ---
        document.getElementById('form-boost').addEventListener('submit', async (e) => {
            e.preventDefault();
            const channel = document.getElementById('input-boost').value.trim();
            const resultContainer = document.getElementById('tab-boost');
            const btn = document.getElementById('btn-boost');

            if (!channel) {
                alert("Veuillez entrer une cha√Æne √† booster.");
                return;
            }

            let messagePlaceholder = resultContainer.querySelector('#boost-message');
            if (!messagePlaceholder) {
                messagePlaceholder = document.createElement('div');
                messagePlaceholder.id = 'boost-message';
                messagePlaceholder.style.marginTop = '15px';
                resultContainer.appendChild(messagePlaceholder);
            }

            messagePlaceholder.innerHTML = `<p style="color:var(--color-ai-growth);">üì§ Boost en cours de v√©rification pour ${channel}...</p>`;
            btn.disabled = true;

            try {
                const res = await fetch(`${API_BASE}/stream_boost`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ channel: channel })
                });

                const data = await res.json();
                
                if (res.ok) {
                    messagePlaceholder.innerHTML = data.html_response;
                } else {
                    messagePlaceholder.innerHTML = `<p style="color:red; font-weight:bold;">${data.error || 'Erreur inconnue du Boost.'}</p>`;
                }
            } catch(e) {
                messagePlaceholder.innerHTML = `<p style="color:red;">Erreur de connexion au service Boost: ${e.message}</p>`;
            } finally {
                btn.disabled = false;
            }
        });

        // --- Initialisation au chargement de la page ---
        document.addEventListener('DOMContentLoaded', function() {
            initializePlayer();
            const savedTab = localStorage.getItem('activeTab') || 'tab-followed';
            openTab(savedTab);
            checkAuth();
        });
    </script>
</body>
</html>
