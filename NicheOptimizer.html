<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STREAMER HUB V4.8</title>
</head>
<body style="background:#0a0a0a; margin:0; padding:0;">

    <!-- Conteneur principal de l'application -->
    <div id="twitch-lucky-main" style="all:initial;display:block;max-width:1100px;margin:20px auto;padding:10px;">
        <style>
            /* Importation des polices pour le corps du document principal */
            @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Inter:wght@400;600;700&display=swap');
        </style>

        <h1 style="font-family:Orbitron;font-size:26px;color:#ff0099;margin-bottom:2px;text-align:center;">
            STREAMER HUB V4.8
        </h1>
        <div style="color:#9aa3a8;font-size:12px;margin-bottom:15px;text-align:center;">Lecteur VidÃ©o + Chat â€¢ Boost â€¢ Scanner IA AvancÃ©</div>

        <!-- Section Lecteur Twitch -->
        <div class="player-wrapper" style="margin-bottom:20px;padding:15px;background:#1a1a1a;border-radius:10px;border:1px solid #2e2e2e;box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);">
            <h2 style="font-family:Orbitron;font-size:18px;color:#22c7ef;margin:0 0 10px;"><span style="margin-right:6px;">ğŸ¬</span> LECTEUR</h2>
            
            <form id="form-channel-player" style="display:flex;gap:8px;margin-bottom:15px;">
                <input id="input-channel" type="text" value="gotaga" placeholder="Nom de la chaÃ®ne Twitch (ex: gotaga)" style="flex-grow:1;padding:10px;border-radius:6px;border:1px solid #333;background:#0d0d0d;color:#fff;font-size:13px;">
                <button type="submit" id="btn-player-launch" style="cursor:pointer;border:0;padding:8px 12px;border-radius:6px;font-weight:600;transition:all 0.2s ease;letter-spacing:0.3px;text-transform:uppercase;font-size:12px;background:#22c7ef;color:#00161d;min-width:100px;">
                    â–¶ï¸ LANCER
                </button>
            </form>

            <div id="twitch-embed" style="width:100%;height:450px;border-radius:8px;box-shadow: 0 0 10px rgba(34, 199, 239, 0.2);"></div>
        </div>
        
        <!-- Host pour l'interface Shadow DOM (Actions Hub) -->
        <div id="ui-host"></div>
    </div>

    <script>
        // Le code JavaScript complet de votre application
        document.addEventListener('DOMContentLoaded', function() {
        (async function(){

        /* ============================ 1. CONFIG ============================ */
        const API_BASE = "https://twitch-random-api.onrender.com";Â 
        const [BOOST_URL, GAME_ID_URL, CRITIQUE_URL, DETAILS_URL, DIAGNOSTIC_URL] = [
        Â  Â  API_BASE + "/boost", API_BASE + "/gameid", API_BASE + "/critique_ia", API_BASE + "/details", API_BASE + "/diagnostic_titre"
        ];
        const TARGET_HISTORY_KEY = 'twitch_target_history';
        let player = null, currentGameId = null, currentGameName = null, lastStreamerData = null, currentTargetName = null;

        /* ============================ 2. HELPERS & HISTORY ============================ */
        // NOTE: J'ai remplacÃ© localStorage par un simulateur pour la dÃ©mo, mais vous devez utiliser Firestore pour la persistance si cette app Ã©tait hÃ©bergÃ©e ici.
        // Puisque vous allez l'hÃ©berger vous-mÃªme sur Render, on garde localStorage comme dans votre version originale.
        function getHistory() {
        Â  Â  try {
        Â  Â  Â  Â  const history = JSON.parse(localStorage.getItem(TARGET_HISTORY_KEY) || '[]');
        Â  Â  Â  Â  return Array.isArray(history) ? history : [];
        Â  Â  } catch {
        Â  Â  Â  Â  return [];
        Â  Â  }
        }
        function addTargetToHistory(name, type) {
        Â  Â  const history = getHistory();
        Â  Â  const newItem = { name: name, type: type, key: `${type}:${name}` };
        Â  Â  const newHistory = history.filter(item => item.key !== newItem.key);
        Â  Â  newHistory.unshift(newItem);
        Â  Â  localStorage.setItem(TARGET_HISTORY_KEY, JSON.stringify(newHistory.slice(0, 5)));
        }
        function initHistory() {
        Â  Â  const historySelect = $("#select-history");
        Â  Â  if (!historySelect) return;
        Â  Â  historySelect.innerHTML = '<option value="">-- Charger une cible rÃ©cente --</option>';
        Â  Â  getHistory().forEach(item => {
        Â  Â  Â  Â  const option = document.createElement('option');
        Â  Â  Â  Â  option.value = item.name;
        Â  Â  Â  Â  option.textContent = `[${item.type.toUpperCase()}] ${item.name}`;
        Â  Â  Â  Â  historySelect.appendChild(option);
        Â  Â  });
        Â  Â  historySelect.addEventListener('change', (e) => {
        Â  Â  Â  Â  const selectedName = e.target.value;
        Â  Â  Â  Â  if (selectedName) {
        Â  Â  Â  Â  Â  Â  $("#input-target").value = selectedName;
        Â  Â  Â  Â  Â  Â  $("#form-target").dispatchEvent(new Event('submit', { cancelable: true }));
        Â  Â  Â  Â  }
        Â  Â  });
        }

        /* ============================ 3. SHADOW DOM SETUP ============================ */
        const host = document.getElementById("ui-host");
        const shadow = host.attachShadow({mode:"open"});
        const $ = sel => shadow.querySelector(sel);

        // Minification et compression du CSS (votre CSS original)
        const css = document.createElement("style");
        css.textContent = `
        :host{font-family:'Inter',Arial,sans-serif;color:#fff;display:block}.grid{display:block}.card{background:#1a1a1a;border:1px solid #2e2e2e;padding:15px;border-radius:10px;margin-bottom:15px;box-shadow:0 3px 10px rgba(0,0,0,.3)}h2{font-family:'Orbitron',sans-serif;font-size:20px;margin:0 0 10px;display:flex;align-items:center;justify-content:center}h3{font-size:14px;font-weight:700;margin:12px 0 8px;padding-bottom:3px;border-bottom:1px dashed #333}.h2-pink{color:#ff0099}button{cursor:pointer;border:0;padding:8px 12px;border-radius:6px;font-weight:600;transition:all .2s ease;letter-spacing:.3px;text-transform:uppercase;font-size:12px}.btn-primary{background:#ff0099;color:#fff;box-shadow:0 0 6px rgba(255,0,153,.4)}.btn-primary:hover{background:#E6008A;transform:translateY(-1px)}.btn-secondary{background:#22c7ef;color:#00161d;box-shadow:0 0 6px rgba(34,199,239,.4)}.btn-secondary:hover{background:#1AC;transform:translateY(-1px)}input,select{width:100%;padding:10px;border-radius:6px;border:1px solid #333;background:#0d0d0d;color:#fff;flex-grow:1;font-size:13px}input:focus,select:focus{border-color:#ff0099;outline:none}.result{margin-top:10px;padding:10px;border-radius:6px;background:#0a0a0a;border:1px solid #444}.hidden{display:none}.muted{color:#9aa3a8;font-size:11px}.success{color:#59d682}.error{color:#e34a64}.info{color:#22c7ef}.flex-gap-8{display:flex;gap:8px;align-items:stretch}.critique{margin-top:10px;padding:10px;border-left:3px solid #ff0099;background:#111;font-size:12px;white-space:pre-wrap}.critique-loading{text-align:center;color:#ff0099;font-weight:600;padding:8px 0}.icon{margin-right:6px;font-size:18px}.streamer-status-live{color:#59d682;font-weight:700}.streamer-status-offline{color:#e34a64;font-weight:700}.stat-chip{display:inline-block;background:#333;color:#fff;padding:4px 8px;border-radius:4px;font-size:11px;font-weight:600;margin-right:5px;margin-bottom:5px}
        `;
        shadow.appendChild(css);

        // HTML de l'Action Hub compressÃ© (votre HTML original)
        const ui = document.createElement("div");
        ui.innerHTML = `
        Â  Â  <div class="grid"><div class="card"><h2 style="color:#ff0099;"><span class="icon">âš¡</span> ACTIONS HUB</h2>
        Â  Â  <h3 style="color:#ff0099;"><span class="icon" style="margin-right:0;">â¬†ï¸</span> Boost VisibilitÃ©</h3>
        Â  Â  <form id="form-boost"><div class="flex-gap-8"><input id="input-boost" type="text" placeholder="ChaÃ®ne Ã  promouvoir">
        Â  Â  <button type="submit" class="btn-primary" style="min-width:80px;">ğŸ“¤ BOOST</button></div></form>
        Â  Â  <div id="boost-msg" class="muted" style="margin-top:5px;">Nom de chaÃ®ne requis pour l'activation.</div>
        Â  Â  <hr style="border-color:#333;margin:15px 0;">
        Â  Â  <h3 style="color:#22c7ef;"><span class="icon" style="margin-right:0;">ğŸ”­</span> Cible / Analyse IA</h3>
        Â  Â  <div id="target-selection-container" style="margin-bottom:10px;"><select id="select-history" style="margin-bottom: 10px;"><option value="">-- Charger une cible rÃ©cente --</option></select>
        Â  Â  <form id="form-target" class="flex-gap-8"><input id="input-target" type="text" placeholder="Jeu (ex: Elden Ring) ou Pseudo">
        Â  Â  <button type="submit" id="btn-target" class="btn-secondary" style="min-width:80px;">ğŸ¯ CIBLER</button></form></div>
        Â  Â  <div id="target-status" class="muted" style="margin-top:5px;">Statut: Entrez un jeu ou un pseudo ci-dessus.</div>
        Â  Â  <div id="scan-ia-actions" class="hidden" style="margin-top:10px; padding: 10px; background: #0a0a0a; border-radius: 6px; border: 1px solid #222;">
        Â  Â  <h4 style="color: #ff0099; font-size: 13px; margin: 0 0 8px;">Cible: <span id="current-target-name" style="color: #fff;"></span></h4>
        Â  Â  <div class="flex-gap-8"><button id="btn-scan-random" class="btn-secondary" style="flex:1;"><span id="scan-label">SCANNER LA CATÃ‰GORIE</span></button></div></div>
        Â  Â  <div id="scan-result" class="result hidden"></div></div></div>
        `;
        shadow.appendChild(ui);
        initHistory();


        /* ============================ 4. LECTEUR TWITCH ============================ */
        async function loadTwitchSDK(){
        Â  Â  if (window.Twitch && window.Twitch.Embed) return;
        Â  Â  return new Promise(resolve=>{
        Â  Â  Â  Â  const s = document.createElement("script");
        Â  Â  Â  Â  s.src = "https://embed.twitch.tv/embed/v1.js";
        Â  Â  Â  Â  s.onload = ()=>resolve(); s.onerror = ()=>resolve();
        Â  Â  Â  Â  document.head.appendChild(s);
        Â  Â  });
        }
        async function loadPlayer(channel){
        Â  Â  await loadTwitchSDK();
        Â  Â  const embedContainer = document.getElementById("twitch-embed");
        Â  Â  if (!window.Twitch || !window.Twitch.Embed){
        Â  Â  Â  Â  embedContainer.innerHTML = "<div style='color:#fff;padding:20px;background:#000;text-align:center;'>âš ï¸ Erreur: SDK Twitch introuvable ou bloquÃ©.</div>"; return;
        Â  Â  }
        Â  Â  if (!player){
        Â  Â  Â  Â  player = new Twitch.Embed("twitch-embed", {
        Â  Â  Â  Â  Â  Â  width:"100%", height:"100%", channel, layout:"video-with-chat", autoplay:true, parent:[window.location.hostname]
        Â  Â  Â  Â  });
        Â  Â  } else { try { player.setChannel(channel); } catch(e){} }
        }
        loadPlayer("gotaga");
        document.getElementById("form-channel-player").addEventListener("submit", e=>{
        Â  Â  e.preventDefault();
        Â  Â  const channelName = document.getElementById("input-channel").value.trim();
        Â  Â  if(channelName) loadPlayer(channelName);
        });


        /* ============================ 5. API HANDLERS (CORRECTED) ============================ */
        // 5.1 Critiques IA (Fonction unique pour ComplÃ¨te et Diagnostic)
        async function fetchCritiqueIA(streamerData, url, msg) {
        Â  Â  const critiqueContainer = $("#critique-container");
        Â  Â  const [btnCritique, btnDiagnostic] = [$("#btn-critique-ia"), $("#btn-critique-diag")];
        Â  Â  critiqueContainer.innerHTML = `<div class="critique-loading">âŸ³ ${msg} en cours...</div>`;
        Â  Â  btnCritique.disabled = btnDiagnostic.disabled = true;

        Â  Â  try {
        Â  Â  Â  Â  const isDiagnostic = (url === DIAGNOSTIC_URL);
        Â  Â  Â  Â  // PrÃ©paration du payload pour le Diagnostic Titre/Tags
        Â  Â  Â  Â  const payload = isDiagnostic ? {Â 
        Â  Â  Â  Â  Â  Â  title: streamerData.title || '',Â 
        Â  Â  Â  Â  Â  Â  tags: streamerData.tags ? streamerData.tags.join(', ') : '',Â 
        Â  Â  Â  Â  Â  Â  game_name: streamerData.game_name || ''Â 
        Â  Â  Â  Â  } : streamerData;

        Â  Â  Â  Â  const res = await fetch(url, {Â 
        Â  Â  Â  Â  Â  Â  method: "POST",Â 
        Â  Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },Â 
        Â  Â  Â  Â  Â  Â  body: JSON.stringify(payload)Â 
        Â  Â  Â  Â  });

        Â  Â  Â  Â  const data = await res.json();
        Â  Â  Â  Â Â 
        Â  Â  Â  Â  if (res.ok && (data.critique || data.diagnostic)) {
        Â  Â  Â  Â  Â  Â  const resultText = data.critique || data.diagnostic;
        Â  Â  Â  Â  Â  Â  const title = isDiagnostic ? `ğŸ’¡ Diagnostic Optimisation` : `Score IA: ${streamerData.avg_score}/5.0`;
        Â  Â  Â  Â  Â  Â  const color = isDiagnostic ? '#22c7ef' : '#ff0099';

        Â  Â  Â  Â  Â  Â  critiqueContainer.innerHTML = `<div class="critique" style="border-left-color:${color};">
        Â  Â  Â  Â  Â  Â  Â  Â  <strong>${title}:</strong><br>${resultText}
        Â  Â  Â  Â  Â  Â  </div>`;
        Â  Â  Â  Â  } else {
        Â  Â  Â  Â  Â  Â  // Tentative de rÃ©cupÃ©rer un message d'erreur du corps de la rÃ©ponse JSON
        Â  Â  Â  Â  Â  Â  let apiError = data.message || data.error || data.critique || data.diagnostic;
        Â  Â  Â  Â  Â  Â  let errorMessage = apiError || `Erreur HTTP ${res.status}. Le serveur API (Render) est-il en veille ou la route API est-elle incorrecte ?`;
        Â  Â  Â  Â  Â  Â Â 
        Â  Â  Â  Â  Â  Â  critiqueContainer.innerHTML = `<div class="critique error"><strong>${msg} :</strong> ${errorMessage}</div>`;
        Â  Â  Â  Â  }
        Â  Â  } catch (e) {
        Â  Â  Â  Â  // Erreur de connexion rÃ©seau pure (DNS, CORS, Timeout)
        Â  Â  Â  Â  critiqueContainer.innerHTML = `<div class="critique error"><strong>${msg} :</strong> âŒ Ã‰chec de la connexion rÃ©seau. (Serveur Render inaccessible ou route ${url} introuvable).</div>`;
        Â  Â  } finally {
        Â  Â  Â  Â  btnCritique.disabled = btnDiagnostic.disabled = false;
        Â  Â  }
        }
        // 5.2 Boost
        $("#form-boost").addEventListener("submit", async e=>{
        Â  Â  e.preventDefault();
        Â  Â  const name = $("#input-boost").value.trim();
        Â  Â  const boostMsg = $("#boost-msg");
        Â  Â  if (!name) return boostMsg.textContent = "Nom requis";
        Â  Â  boostMsg.textContent = "âŸ³ Envoi du Boost..."; $("#input-boost").disabled = true;
        Â  Â  try {
        Â  Â  Â  Â  const res = await fetch(BOOST_URL,{method:"POST", headers:{ "Content-Type":"application/json"}, body:JSON.stringify({channelName:name,userId:crypto.randomUUID()})});
        Â  Â  Â  Â  const data = res.ok ? await res.json().catch(()=>({message:"âœ… SuccÃ¨s"})) : {message:"âŒ Erreur Serveur"};
        Â  Â  Â  Â  boostMsg.className = "success";
        Â  Â  Â  Â  boostMsg.textContent = data.message || `âœ… Boost appliquÃ© Ã  ${name}`;
        Â  Â  }
        Â  Â  catch { boostMsg.className = "error"; boostMsg.textContent = "âš ï¸ Ã‰chec de la connexion Ã  l'API Boost."; }
        Â  Â  $("#input-boost").disabled = false; $("#input-boost").value = "";
        });
        // 5.3 Ciblage (Jeu ou Pseudo)
        $("#form-target").addEventListener("submit", async e => {
        Â  Â  e.preventDefault();
        Â  Â  const targetInput = $("#input-target").value.trim();
        Â  Â  const [targetStatus, actionsBox, scanLabel, btnTarget] = [$("#target-status"), $("#scan-ia-actions"), $("#scan-label"), $("#btn-target")];
        Â  Â  currentGameId = currentGameName = currentTargetName = null;
        Â  Â  actionsBox.classList.add("hidden"); $("#scan-result").classList.add("hidden");
        Â  Â  targetStatus.className = "muted"; targetStatus.textContent = "Statut: Entrez un jeu ou un pseudo ci-dessus.";
        Â  Â  if (!targetInput) return;
        Â  Â  targetStatus.textContent = `âŸ³ Recherche de '${targetInput}'...`; btnTarget.disabled = true;

        Â  Â  try {
        Â  Â  Â  Â  const res = await fetch(`${GAME_ID_URL}?name=${encodeURIComponent(targetInput)}`);
        Â  Â  Â  Â  if (res.ok) { // JEU
        Â  Â  Â  Â  Â  Â  const data = await res.json();
        Â  Â  Â  Â  Â  Â  [currentGameId, currentGameName] = [data.game_id, data.name];
        Â  Â  Â  Â  Â  Â  targetStatus.className = "success"; targetStatus.textContent = `âœ… Cible dÃ©finie: JEU '${currentGameName}'`;
        Â  Â  Â  Â  Â  Â  $("#current-target-name").textContent = `Jeu: ${currentGameName}`; scanLabel.textContent = "SCANNER LA CATÃ‰GORIE";
        Â  Â  Â  Â  Â  Â  actionsBox.classList.remove("hidden"); addTargetToHistory(currentGameName, 'jeu');
        Â  Â  Â  Â  } else if (res.status === 404) { // PSEUDO
        Â  Â  Â  Â  Â  Â  currentTargetName = targetInput;
        Â  Â  Â  Â  Â  Â  targetStatus.className = "info"; targetStatus.textContent = `âš ï¸ Jeu non trouvÃ©. Cible dÃ©finie: PSEUDO '${currentTargetName}'`;
        Â  Â  Â  Â  Â  Â  $("#current-target-name").textContent = `Streamer: ${currentTargetName}`; scanLabel.textContent = "SCAN GENERAL (TROUVER UN PARTENAIRE)";
        Â  Â  Â  Â  Â  Â  actionsBox.classList.remove("hidden"); await fetchTargetDetails(currentTargetName);
        Â  Â  Â  Â  Â  Â  addTargetToHistory(currentTargetName, 'pseudo');
        Â  Â  Â  Â  } else {
        Â  Â  Â  Â  Â  Â  targetStatus.className = "error"; targetStatus.textContent = `âŒ Erreur API: HTTP ${res.status}.`;
        Â  Â  Â  Â  }
        Â  Â  } catch (e) { targetStatus.className = "error"; targetStatus.textContent = "âš ï¸ Erreur rÃ©seau lors du ciblage.";
        Â  Â  } finally { btnTarget.disabled = false; initHistory(); }
        });

        // 5.4 Analyse CiblÃ©e (dÃ©tails + render)
        async function fetchTargetDetails(targetName) {
        Â  Â  const box = $("#scan-result"); box.classList.remove("hidden");
        Â  Â  box.innerHTML = `<div class="critique-loading">âŸ³ RÃ©cupÃ©ration des donnÃ©es de ${targetName}...</div>`;
        Â  Â  try {
        Â  Â  Â  Â  const res = await fetch(`${DETAILS_URL}?login=${encodeURIComponent(targetName)}`, {cache:'no-store'});
        Â  Â  Â  Â  if (!res.ok) throw new Error(`Streamer introuvable sur Twitch.`);
        Â  Â  Â  Â  const s = (await res.json()).streamer; lastStreamerData = s;Â 
        Â  Â  Â  Â  box.innerHTML = `
        Â  Â  Â  Â  Â  Â  <div style="background:#111;padding:12px;border-radius:6px;margin-bottom:10px;">
        Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700;color:#ff0099;font-size:16px;margin-bottom:4px;">${s.username}Â 
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="${s.is_live ? 'streamer-status-live' : 'streamer-status-offline'}" style="font-size:11px;">(${s.is_live ? 'EN DIRECT' : 'HORS LIGNE'})</span>
        Â  Â  Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:13px;color:#cdd5da;font-style:italic;">"${s.title || "Titre non disponible."}"</div>
        Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top:10px;">
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-chip" style="background:#22c7ef;">JEU: ${s.game_name || 'Non DÃ©fini'}</span>
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-chip">FOLLOWERS: ${s.follower_count}</span>
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-chip">VIEWERS: ${s.viewer_count}</span>
        Â  Â  Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  <div class="flex-gap-8" style="margin-top:10px;"><button id="scan-watch" class="btn-secondary" style="flex:1;">â–¶ï¸ REGARDER</button></div>
        Â  Â  Â  Â  Â  Â  <div class="flex-gap-8" style="margin-top:8px;">
        Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-critique-ia" class="btn-primary" style="flex:1;">ğŸ§  CRITIQUE IA (ComplÃ¨te)</button>
        Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-critique-diag" class="btn-secondary" style="flex:1; background: #9933ff;">ğŸ“ DIAGNOSTIC TITRE/TAGS</button>
        Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  <div id="critique-container"></div>
        Â  Â  Â  Â  `;
        Â  Â  Â  Â  box.querySelector("#scan-watch").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  document.getElementById("input-channel").value = s.username; loadPlayer(s.username);
        Â  Â  Â  Â  Â  Â  document.getElementById("twitch-lucky-main").scrollIntoView({behavior: 'smooth', block: 'start'});
        Â  Â  Â  Â  });
        Â  Â  Â  Â  box.querySelector("#btn-critique-ia").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  fetchCritiqueIA(lastStreamerData, CRITIQUE_URL, 'Analyse IA ComplÃ¨te');
        Â  Â  Â  Â  });
        Â  Â  Â  Â  box.querySelector("#btn-critique-diag").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  fetchCritiqueIA(lastStreamerData, DIAGNOSTIC_URL, 'Diagnostic Titre/Tags');
        Â  Â  Â  Â  });
        Â  Â  } catch (e) { box.innerHTML = `<div class="critique error"><strong>Analyse CiblÃ©e :</strong> ${e.message}</div>`; }
        }

        // 5.5 Scanner (Random ou par Jeu)
        $("#btn-scan-random").addEventListener("click", async ()=>{
        Â  Â  const [btn, msg, box] = [$("#btn-scan-random"), $("#target-status"), $("#scan-result")];
        Â  Â  let [scanUrl, criteriaText] = [`${API_BASE}/random`, `Streamers FR en direct, toutes tailles`];
        Â  Â  if (currentGameId) { scanUrl += `?game_id=${currentGameId}`; criteriaText = `Streamers FR en direct sur ${currentGameName}`; }
        Â  Â  msg.className = "info"; msg.textContent = `âŸ³ Scan en cours... (CritÃ¨res: ${criteriaText})`;
        Â  Â  btn.disabled = true; box.classList.add("hidden"); box.innerHTML = "";

        Â  Â  try {
        Â  Â  Â  Â  const res = await fetch(scanUrl,{cache:'no-store'});
        Â  Â  Â  Â  if (!res.ok) throw new Error(`Erreur de connexion (HTTP ${res.status}). Le serveur API externe est en veille.`);
        Â  Â  Â  Â  const s = (await res.json()).streamer || (await res.json());Â 
        Â  Â  Â  Â  if (!s.username) throw new Error("Pas de streamer trouvÃ© avec les critÃ¨res.");
        Â  Â  Â  Â  lastStreamerData = s;Â 
        Â  Â  Â  Â  msg.textContent = `âœ… Streamer FR trouvÃ© ! (Jeu: ${s.game_name || 'Non spÃ©cifiÃ©'})`; msg.className = "success";
        Â  Â  Â  Â Â 
        Â  Â  Â  Â  // Rendu des rÃ©sultats du scan (identique au ciblÃ©)
        Â  Â  Â  Â  box.innerHTML = `
        Â  Â  Â  Â  Â  Â  Â <div style="background:#111;padding:12px;border-radius:6px;margin-bottom:10px;">
        Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-weight:700;color:#ff0099;font-size:16px;margin-bottom:4px;">${s.username}Â 
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="streamer-status-live" style="font-size:11px;">(EN DIRECT)</span>
        Â  Â  Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:13px;color:#cdd5da;font-style:italic;">"${s.title || "Titre non disponible."}"</div>
        Â  Â  Â  Â  Â  Â  Â  Â  <div style="margin-top:10px;">
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-chip" style="background:#22c7ef;">JEU: ${s.game_name || 'Non DÃ©fini'}</span>
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-chip">FOLLOWERS: ${s.follower_count}</span>
        Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="stat-chip">VIEWERS: ${s.viewer_count}</span>
        Â  Â  Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  <div class="flex-gap-8" style="margin-top:10px;"><button id="scan-watch" class="btn-secondary" style="flex:1;">â–¶ï¸ REGARDER</button></div>
        Â  Â  Â  Â  Â  Â  <div class="flex-gap-8" style="margin-top:8px;">
        Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-critique-ia" class="btn-primary" style="flex:1;">ğŸ§  CRITIQUE IA (ComplÃ¨te)</button>
        Â  Â  Â  Â  Â  Â  Â  Â  <button id="btn-critique-diag" class="btn-secondary" style="flex:1; background: #9933ff;">ğŸ“ DIAGNOSTIC TITRE/TAGS</button>
        Â  Â  Â  Â  Â  Â  </div>
        Â  Â  Â  Â  Â  Â  <div id="critique-container"></div>
        Â  Â  Â  Â  `;
        Â  Â  Â  Â  box.classList.remove("hidden");

        Â  Â  Â  Â  box.querySelector("#scan-watch").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  document.getElementById("input-channel").value = s.username; loadPlayer(s.username);
        Â  Â  Â  Â  Â  Â  document.getElementById("twitch-lucky-main").scrollIntoView({behavior: 'smooth', block: 'start'});
        Â  Â  Â  Â  });
        Â  Â  Â  Â  box.querySelector("#btn-critique-ia").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  fetchCritiqueIA(lastStreamerData, CRITIQUE_URL, 'Analyse IA ComplÃ¨te');
        Â  Â  Â  Â  });
        Â  Â  Â  Â  box.querySelector("#btn-critique-diag").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  fetchCritiqueIA(lastStreamerData, DIAGNOSTIC_URL, 'Diagnostic Titre/Tags');
        Â  Â  Â  Â  });
        Â  Â  }
        Â  Â  catch(e){
        Â  Â  Â  Â  msg.textContent = `âŒ Ã‰chec du Scan: ${e.message || "Erreur inconnue"}`; msg.className = "error";
        Â  Â  Â  Â  box.innerHTML = `<div style="font-weight:700;color:#22c7ef;font-size:16px;">ğŸš¨ Nom non trouvÃ© (SimulÃ©)</div>
        Â  Â  Â  Â  Â  Â  <div style="color:#ff78b3;font-weight:700;margin-top:5px;font-size:13px;">Impossible de trouver une chaÃ®ne.</div>
        Â  Â  Â  Â  Â  Â  <button id="scan-fallback" class="btn-secondary" style="margin-top:8px;width:100%;">REGARDER EXEMPLE</button>`;
        Â  Â  Â  Â  box.classList.remove("hidden");
        Â  Â  Â  Â  box.querySelector("#scan-fallback").addEventListener("click",()=>{
        Â  Â  Â  Â  Â  Â  document.getElementById("input-channel").value = "twitch_example_channel"; loadPlayer("twitch_example_channel");
        Â  Â  Â  Â  Â  Â  document.getElementById("twitch-lucky-main").scrollIntoView({behavior: 'smooth', block: 'start'});
        Â  Â  Â  Â  });
        Â  Â  }
        Â  Â  btn.disabled = false;
        });

        })();
        });
    </script>
</body>
</html>
